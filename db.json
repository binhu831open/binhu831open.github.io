{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/local-search.js","path":"js/local-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/anime.min.js","path":"lib/anime.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/all.min.css","path":"lib/font-awesome/css/all.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","path":"lib/font-awesome/webfonts/fa-brands-400.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","path":"lib/font-awesome/webfonts/fa-regular-400.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","path":"lib/font-awesome/webfonts/fa-solid-900.woff2","modified":1,"renderable":1}],"Cache":[{"_id":"source/_posts/OS-SMS.md","hash":"4833429a5fd4b7333cbc19b8c6437cf643829f0a","modified":1676817197608},{"_id":"source/_posts/Oracle-ACL.md","hash":"5746bfe5d4d7286f59fdaea0b3e3a3b24519a88a","modified":1676817062609},{"_id":"source/_posts/Oracle-Broker.md","hash":"1b918acf06a35a28ee8e41717db6c1fd2417fbb3","modified":1678604712670},{"_id":"source/_posts/Oracle-Check-URL.md","hash":"899dc71a2b0739a7f91ab55cc451231bd54c894f","modified":1678604753392},{"_id":"source/_posts/Oracle-DW.md","hash":"fe3a67d191416f0c8ae4cb05b8f36736cd24c4a8","modified":1676816988996},{"_id":"source/_posts/Oracle-EM.md","hash":"b3c6bb6aa7f654ec653e622adf021e52b43ea83b","modified":1678604340427},{"_id":"source/_posts/Oracle-ORA-1861.md","hash":"180e110bad009fc03953116b958835fc7b3acb04","modified":1677769560230},{"_id":"source/_posts/Oracle-Zip.md","hash":"62dd6b361dbe50b3e687d7558fe6abbfa3262159","modified":1676817129254},{"_id":"source/_posts/Oracle11g-unwrap.md","hash":"1e19e3c4148e2171f229b221e95a075fe8584436","modified":1676817136677},{"_id":"source/_posts/ProxySQL.md","hash":"e8970d1503213e59e83bf0e031aaeb7127b2eedd","modified":1676817203094},{"_id":"source/_posts/Oracle19c-Rman-Restore-Table.md","hash":"88f846e81b93ce92e2586f7c9c38dee3c51128a4","modified":1676817192798},{"_id":"source/_posts/lab-info.md","hash":"82b2b232554edb36187bc448be0b45141d1fb984","modified":1676817101200},{"_id":"source/_posts/hexo雜記.md","hash":"e6dfc02a1484b89e0cfaf6711a6e7c4ae2528a3e","modified":1676817070766},{"_id":"source/_posts/SQL-FailOver-Cluster.md","hash":"ad4340f4c221a6cd06630b4de0978d0c76a4b8d7","modified":1677331705453},{"_id":"source/_posts/mariadb-multiple-install.md","hash":"e0118d4e97b0329f1404da3d311667875af7e328","modified":1676817108281},{"_id":"source/_posts/oracle19c-auto-index.md","hash":"6dbc2f3ed7e3941cb4f464f3f770db8b3c177d89","modified":1676817178875},{"_id":"source/_posts/rman-info.md","hash":"cbc303619ce960f7c15e3d687d99d581ca27d1af","modified":1676202319008},{"_id":"source/_posts/sqlldr-hdsize.md","hash":"0c3a9fe516675b5e095500af4091951b62627bda","modified":1676302896662},{"_id":"source/_posts/script-ftp-restart.md","hash":"004a7543ebc183efb71a0a3ee201e55199717512","modified":1681628368016},{"_id":"source/_posts/windows-update.md","hash":"afd7f5da1f60a36cc9cc13ca6572ab6de8863a2f","modified":1676302914435},{"_id":"source/tags/index.md","hash":"030b07e13968791dc502110b2345a78fd9ef1b76","modified":1675786052218},{"_id":"source/categories/index.md","hash":"16572d621d4331da6a52e72a4592541b22c7b3f5","modified":1675785702031},{"_id":"source/about/index.md","hash":"098baa81937effa9ade1ff8d1ca9b4c180b3605d","modified":1675786264641},{"_id":"themes/next/.editorconfig","hash":"731c650ddad6eb0fc7c3d4a91cad1698fe7ad311","modified":1675611764727},{"_id":"themes/next/.gitattributes","hash":"3e00e1fb043438cd820d94ee3dc9ffb6718996f3","modified":1675611764727},{"_id":"themes/next/.eslintrc.json","hash":"d3c11de434171d55d70daadd3914bc33544b74b8","modified":1675611764727},{"_id":"themes/next/.gitignore","hash":"83418530da80e6a78501e1d62a89c3bf5cbaec3d","modified":1675611764733},{"_id":"themes/next/.stylintrc","hash":"6259e2a0b65d46865ab89564b88fc67638668295","modified":1675611764733},{"_id":"themes/next/LICENSE.md","hash":"0a9c7399f102b4eb0a6950dd31264be421557c7d","modified":1675611764734},{"_id":"themes/next/.travis.yml","hash":"379f31a140ce41e441442add6f673bf397d863ea","modified":1675611764733},{"_id":"themes/next/README.md","hash":"7d56751b580d042559b2acf904fca4b42bcb30a7","modified":1675611764734},{"_id":"themes/next/_config.yml","hash":"140a8d11c97e4e10243c430495cef466cf669f2e","modified":1676191493292},{"_id":"themes/next/crowdin.yml","hash":"4a53f5985e545c635cb56b2a57ed290cb8cf8942","modified":1675611764735},{"_id":"themes/next/gulpfile.js","hash":"0c76a1ac610ee8cbe8e2cc9cca1c925ffd0edf98","modified":1675611764743},{"_id":"themes/next/package.json","hash":"b099e7cea4406e209130410d13de87988ba37b2a","modified":1675611764774},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"778b7e052993ed59f21ed266ba7119ee2e5253fb","modified":1675611764728},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"5ddde54fb50d11dc08cec899a3588addb56aa386","modified":1675611764728},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"d2f8e6b65783e31787feb05d2ccea86151f53f35","modified":1675611764730},{"_id":"themes/next/.github/config.yml","hash":"df3d970700e6b409edc3d23be8d553db78d5ba3f","modified":1675611764731},{"_id":"themes/next/.github/issue-close-app.yml","hash":"b14756e65546eb9ecc9d4393f0c9a84a3dac1824","modified":1675611764731},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"533fbe6b2f87d7e7ec6949063bb7ea7eb4fbe52d","modified":1675611764731},{"_id":"themes/next/.github/lock.yml","hash":"3ce3d0a26030a1cd52b273cc6a6d444d7c8d85c2","modified":1675611764731},{"_id":"themes/next/.github/mergeable.yml","hash":"1c1cb77a62df1e3654b151c2da34b4a10d351170","modified":1675611764732},{"_id":"themes/next/.github/release-drafter.yml","hash":"09c3352b2d643acdc6839601ceb38abc38ab97c5","modified":1675611764732},{"_id":"themes/next/.github/stale.yml","hash":"590b65aca710e0fba75d3cf5361a64d13b6b0f63","modified":1675611764732},{"_id":"themes/next/.github/support.yml","hash":"7ce2722d6904c31a086444c422dc49b6aa310651","modified":1675611764732},{"_id":"themes/next/docs/AGPL3.md","hash":"f463f95b169d64983f59fa6f3e4b6760290a0e6b","modified":1675611764735},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"60c7e9ef0c578deebad43e9395c958fa61096baf","modified":1675611764736},{"_id":"themes/next/docs/AUTHORS.md","hash":"cde7cc095ac31b421a573042cf61060f90d9ad0d","modified":1675611764736},{"_id":"themes/next/docs/DATA-FILES.md","hash":"980fb8d37701f7fd96b30bb911519de3bbb473d1","modified":1675611764736},{"_id":"themes/next/docs/INSTALLATION.md","hash":"07ea00bee149a1bdc9073e903ee6b411e9f2f818","modified":1675611764737},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"6cc663db5e99fd86bb993c10d446ad26ada88e58","modified":1675611764737},{"_id":"themes/next/docs/LICENSE.txt","hash":"ae5ad07e4f4106bad55535dba042221539e6c7f9","modified":1675611764737},{"_id":"themes/next/docs/MATH.md","hash":"f56946053ade0915ff7efa74d43c38b8dd9e63bb","modified":1675611764737},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"1e86d32063b490d204baa9d45d8d3cb22c24a37d","modified":1675611764738},{"_id":"themes/next/languages/ar.yml","hash":"abcf220bd615cec0dd50e4d98da56580169d77e1","modified":1675611764743},{"_id":"themes/next/languages/de.yml","hash":"15078b7ede1b084e8a6a15d271f0db9c325bd698","modified":1675611764743},{"_id":"themes/next/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1675611764744},{"_id":"themes/next/languages/en.yml","hash":"dbb64776f9c001c54d0058256c415a9a0724ed5d","modified":1675611764744},{"_id":"themes/next/languages/es.yml","hash":"f064c793d56a5e0f20cda93b6f0e355044efc7d8","modified":1675611764744},{"_id":"themes/next/languages/fa.yml","hash":"6c0a7d5bcc26eb45a9f3e02f13117c668e77fffd","modified":1675611764745},{"_id":"themes/next/languages/fr.yml","hash":"3e2f89d4bb4441d33ecc7b5a4ee114f627603391","modified":1675611764745},{"_id":"themes/next/languages/hu.yml","hash":"0ea89ffaefd02a10494995f05a2a59d5e5679a28","modified":1675611764745},{"_id":"themes/next/languages/id.yml","hash":"7599bb0ecf278beb8fde3d17bfc148a3241aef82","modified":1675611764745},{"_id":"themes/next/languages/it.yml","hash":"46222f468e66789e9ba13095809eb5e5b63edf30","modified":1675611764746},{"_id":"themes/next/languages/ja.yml","hash":"bf279d0eb1911806d01a12f27261fbc76a3bb3f9","modified":1675611764746},{"_id":"themes/next/languages/ko.yml","hash":"af4be6cb394abd4e2e9a728418897d2ed4cc5315","modified":1675611764746},{"_id":"themes/next/languages/nl.yml","hash":"9749cf90b250e631dd550a4f32ada3bb20f66dd0","modified":1675611764747},{"_id":"themes/next/languages/pt-BR.yml","hash":"69aa3bef5710b61dc9a0f3b3a8f52f88c4d08c00","modified":1675611764747},{"_id":"themes/next/languages/pt.yml","hash":"f6606dd0b916a465c233f24bd9a70adce34dc8d6","modified":1675611764747},{"_id":"themes/next/languages/ru.yml","hash":"012abc694cf9de281a0610f95f79c594f0a16562","modified":1675611764748},{"_id":"themes/next/languages/tr.yml","hash":"c4e9ab7e047ae13a19f147c6bec163c3ba2c6898","modified":1675611764748},{"_id":"themes/next/languages/uk.yml","hash":"69ef00b1b8225920fcefff6a6b6f2f3aad00b4ce","modified":1675611764748},{"_id":"themes/next/languages/vi.yml","hash":"6a578cc28773bd764f4418110500478f185d6efa","modified":1675611764748},{"_id":"themes/next/languages/zh-CN.yml","hash":"81d73e21402dad729053a3041390435f43136a68","modified":1675611764749},{"_id":"themes/next/languages/zh-HK.yml","hash":"92ccee40c234626bf0142152949811ebe39fcef2","modified":1675611764749},{"_id":"themes/next/languages/zh-TW.yml","hash":"cf0740648725983fb88409d6501876f8b79db41d","modified":1675611764749},{"_id":"themes/next/layout/_layout.swig","hash":"9554bd0f5c5a0438aa7b64065be5561c374d260e","modified":1675611764750},{"_id":"themes/next/layout/archive.swig","hash":"d9bca77f6dcfef71e300a294f731bead11ce199f","modified":1675611764772},{"_id":"themes/next/layout/category.swig","hash":"c546b017a956faaa5f5643c7c8a363af7ac9d6b9","modified":1675611764772},{"_id":"themes/next/layout/index.swig","hash":"8dfd96fb6f833dd5d037de800813105654e8e8e6","modified":1675611764773},{"_id":"themes/next/layout/page.swig","hash":"357d916694d4c9a0fd1140fa56d3d17e067d8b52","modified":1675611764773},{"_id":"themes/next/layout/post.swig","hash":"5f0b5ba2e0a5b763be5e7e96611865e33bba24d7","modified":1675611764773},{"_id":"themes/next/scripts/renderer.js","hash":"e3658eea97b1183ee2e9f676231e53f7994741f6","modified":1675611764781},{"_id":"themes/next/layout/tag.swig","hash":"d44ff8755727f6532e86fc9fc8dc631200ffe161","modified":1675611764774},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"e67146befddec3a0dc47dc80d1109070c71d5d04","modified":1675611764729},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.md","hash":"d5aa1a3323639a36bcd9a401484b67537043cd3c","modified":1675611764729},{"_id":"themes/next/.github/ISSUE_TEMPLATE/question.md","hash":"59275aa0582f793fee7be67904dcf52ad33a7181","modified":1675611764730},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"6beeca0f45a429cd932b6e648617f548ff64c27c","modified":1675611764729},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"54e6a067ed95268eab6be2ba040a7e9b1907928e","modified":1675611764738},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"a9cfe5ac9ef727a8650b2b6584482751a26b1460","modified":1675611764739},{"_id":"themes/next/docs/ru/README.md","hash":"1e5ddb26ad6f931f8c06ce2120f257ff38b74fdf","modified":1675611764739},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"cb8e39c377fc4a14aaf133b4d1338a48560e9e65","modified":1675611764739},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"3202be9a8d31986caac640e7a4c7ce22e99917eb","modified":1675611764740},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7e6f227f2aaf30f400d4c065650a4e3d0d61b9e1","modified":1675611764740},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"611f2930c2b281b80543531b1bf33d082531456a","modified":1675611764740},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"2d868cd271d78b08775e28c5b976de8836da4455","modified":1675611764741},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"716111dd36d276f463c707dfcc9937fea2a1cf7a","modified":1675611764741},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"50ab381c27611d5bf97bb3907b5ca9998f28187d","modified":1675611764742},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"0d46f9f50cf2e4183970adce705d1041155b0d37","modified":1675611764742},{"_id":"themes/next/docs/zh-CN/README.md","hash":"8f7c0d0b766024152591d4ccfac715c8e18b37f3","modified":1675611764742},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"b3201934b966bc731eaf8a4dad4ba4bdcd300c10","modified":1675611764743},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"30ade8c806d7826cc50a4a3e46a9e6213fddf333","modified":1675611764750},{"_id":"themes/next/layout/_macro/post.swig","hash":"c3fd56bac90ce45a0c79ddfe68beb223ad0d72b4","modified":1675611764750},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"5bffdb1448caca7db7b1f84e1693e6657a106d50","modified":1675611764751},{"_id":"themes/next/layout/_partials/comments.swig","hash":"379e916a23d955551ee5d9266f6affe6f1d3e2f7","modified":1676183738212},{"_id":"themes/next/layout/_partials/footer.swig","hash":"e031914c98f082d918ece4c35fdd0a5be1c4e845","modified":1675611764751},{"_id":"themes/next/layout/_partials/languages.swig","hash":"c3ea82604a5853fb44c5f4e4663cbe912aa5dcf8","modified":1675611764754},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"2de77d533c91532a8a4052000244d0c1693370df","modified":1675611764755},{"_id":"themes/next/layout/_partials/widgets.swig","hash":"5392dcbb504266f0f61d5b8219914068ef9cdc25","modified":1675611764758},{"_id":"themes/next/layout/_scripts/index.swig","hash":"1822eaf55bbb4bec88871c324fc18ad95580ccb4","modified":1675611764759},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"7b9e0f776a5be6c3f95bc7f394e1424ba02ba93b","modified":1675611764759},{"_id":"themes/next/layout/_scripts/pjax.swig","hash":"ccff5a773644d33ff22f6b45b6734f52b048f22b","modified":1675611764760},{"_id":"themes/next/layout/_scripts/three.swig","hash":"6b092c6d882b2dfa5273e1b3f60b244cb7c29fcd","modified":1675611764761},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"244ca2d74ee0d497c87572c6a26b43c62a952673","modified":1675611764762},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"28b0a7e843ec4365db1963646659a153753cd746","modified":1675611764763},{"_id":"themes/next/layout/_third-party/index.swig","hash":"c6b63cbc80938e6e09578b8c67e01adf13a9e3bd","modified":1675611764767},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"5ae5adcd6f63ed98b2071e4f7e5e38c4d7d24e1b","modified":1675611764768},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"269102fc5e46bd1ce75abdcce161f0570ae70e2f","modified":1675611764769},{"_id":"themes/next/scripts/events/index.js","hash":"5c355f10fe8c948a7f7cd28bd8120adb7595ebde","modified":1675611764775},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"ad321db012cea520066deb0639335e9bc0dcc343","modified":1675611764778},{"_id":"themes/next/scripts/filters/front-matter.js","hash":"305d03c1e45782988809298c3e3b3c5d5ee438aa","modified":1675611764778},{"_id":"themes/next/scripts/filters/locals.js","hash":"a5e7d05d3bd2ae6dcffad5a8ea0f72c6e55dbd02","modified":1675611764779},{"_id":"themes/next/scripts/filters/minify.js","hash":"21196a48cb127bf476ce598f25f24e8a53ef50c2","modified":1675611764779},{"_id":"themes/next/scripts/filters/post.js","hash":"57f2d817578dd97e206942604365e936a49854de","modified":1675611764779},{"_id":"themes/next/scripts/helpers/engine.js","hash":"eb6b8bbc1dce4846cd5e0fac0452dbff56d07b5d","modified":1675611764780},{"_id":"themes/next/scripts/helpers/font.js","hash":"8fb1c0fc745df28e20b96222974402aab6d13a79","modified":1675611764780},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"b8d7ddfa4baa9b8d6b9066a634aa81c6243beec9","modified":1675611764780},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"4044129368d0e2811859a9661cad8ab47118bc32","modified":1675611764780},{"_id":"themes/next/scripts/tags/button.js","hash":"bb0e8abbc0a6d5b3a1a75a23976f2ac3075aab31","modified":1675611764781},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"840536754121e0da5968f5ad235f29200fc5d769","modified":1675611764781},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"e2d0184bc4a557e1017395b80ff46880078d8537","modified":1675611764782},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"93ccd3f99d3cb42674f29183c756df63acb5d7f8","modified":1675611764782},{"_id":"themes/next/scripts/tags/label.js","hash":"fc83f4e1be2c34e81cb79938f4f99973eba1ea60","modified":1675611764782},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"81134494ff0134c0dae1b3815caf6606fccd4e46","modified":1675611764783},{"_id":"themes/next/scripts/tags/note.js","hash":"1fdf4f95810fdb983bfd5ad4c4f13fedd4ea2f8d","modified":1675611764783},{"_id":"themes/next/scripts/tags/pdf.js","hash":"37b53661ad00a01a2ca7d2e4a5ad3a926073f8e2","modified":1675611764783},{"_id":"themes/next/scripts/tags/tabs.js","hash":"c70a4a66fd0c28c98ccb6c5d5f398972e5574d28","modified":1675611764783},{"_id":"themes/next/scripts/tags/video.js","hash":"944293fec96e568d9b09bc1280d5dbc9ee1bbd17","modified":1675611764784},{"_id":"themes/next/source/css/_colors.styl","hash":"11aef31a8e76f0f332a274a8bfd4537b73d4f88f","modified":1675611764784},{"_id":"themes/next/source/css/_mixins.styl","hash":"072a3fa473c19b20ccd7536a656cda044dbdae0a","modified":1675611764806},{"_id":"themes/next/source/css/main.styl","hash":"815ef30987d02f3d76dbe4b5ee3a72135a152678","modified":1675611764815},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1675611764815},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1675611764815},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1675611764816},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1675611764816},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1675611764817},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1675611764817},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1675611764817},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1675611764817},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1675611764818},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1675611764818},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1675611764818},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1675611764819},{"_id":"themes/next/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1675611764819},{"_id":"themes/next/source/js/bookmark.js","hash":"9f05fd3672789311dc0cf5b37e40dc654cb04a2a","modified":1675611764820},{"_id":"themes/next/source/js/algolia-search.js","hash":"6a813410e33824d7acc65a369a2983912bb3420c","modified":1675611764819},{"_id":"themes/next/source/js/local-search.js","hash":"cfa6a0f3f9c2bc759ee507668a21f4e8f250f42a","modified":1675611764820},{"_id":"themes/next/source/js/motion.js","hash":"d5aa1a08cdf3c8d1d8d550fb1801274cc41e5874","modified":1675611764820},{"_id":"themes/next/source/js/next-boot.js","hash":"250d8dcd6322e69e3fbadd0f3e37081c97b47c52","modified":1675611764821},{"_id":"themes/next/source/js/utils.js","hash":"26a82e46fdcadc7c3c2c56a7267284b61a26f7f3","modified":1675611764822},{"_id":"themes/next/source/lib/anime.min.js","hash":"960be51132134acd65c2017cc8a5d69cb419a0cd","modified":1675611764823},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"7d638e413f2548fc990c4a467dd03de6c81fc960","modified":1675611764752},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"90cce9f407e9490756ba99580e3eb09f55b05eaa","modified":1675611764752},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"0dd316f153c492c0a03bd0273d50fa322bc81f11","modified":1675611764753},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"91056a6c98cca63ff8cc6956e531ee3faf4b8ad9","modified":1675611764752},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"bed6cc2b48cf2655036ba39c9bae73a295228a4d","modified":1675611764754},{"_id":"themes/next/layout/_partials/header/menu-item.swig","hash":"4baa86ca631168fc6388d27f4b1b501b40c877a8","modified":1675611764753},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"90d3eaba6fbe69bee465ddd67c467fd2c0239dc4","modified":1675611764753},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"91c0addb33006619faa4c32e5d66874e25f1e9b3","modified":1675611764754},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"8d4e3dd0d3631ce0b21bc15c259f6ac886de631d","modified":1675611764755},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"f2eb455c8bf13533427254f0c9b4b17b2498168b","modified":1675611764755},{"_id":"themes/next/layout/_partials/post/post-followme.swig","hash":"d8f785c062c6b0763a778bd4a252e6f5fee0e432","modified":1675611764756},{"_id":"themes/next/layout/_partials/post/post-footer.swig","hash":"ce712c110b5ce8aacba7a86b0558ff89700675c9","modified":1675611764756},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"bc7b047a6246df07767373644b1637d91c3a88b1","modified":1675611764756},{"_id":"themes/next/layout/_partials/post/post-reward.swig","hash":"f349a226e5370075bb6924e60da8b0170c7cfcc1","modified":1675611764757},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"98fd1f5df044f4534e1d4ca9ab092ba5761739a9","modified":1675611764757},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"a6c761d5193cb6f22e9422dbbcf209e05471b0ed","modified":1675611764757},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"128f7d679bb4d53b29203d598d217f029a66dee7","modified":1675611764758},{"_id":"themes/next/layout/_partials/sidebar/site-overview.swig","hash":"7b2ef5db9615267a24b884388925de1e9b447c1f","modified":1675611764758},{"_id":"themes/next/layout/_scripts/pages/schedule.swig","hash":"34c05e9d73b0f081db70990c296b6d6a0f8ea2ca","modified":1675611764759},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"34495d408e8467555afee489500b8aad98c52079","modified":1675611764760},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"0b44f400ec00d2b5add5ee96c11d22465c432376","modified":1675611764761},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"34495d408e8467555afee489500b8aad98c52079","modified":1675611764761},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"0b44f400ec00d2b5add5ee96c11d22465c432376","modified":1675611764760},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"84adaadd83ce447fa9da2cff19006334c9fcbff9","modified":1675611764762},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"b8819bd056f8a580c5556d4415836a906ed5d7a4","modified":1675611764763},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"91c2cb900c76224c5814eeb842d1d5f517f9bf05","modified":1675611764763},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"85b60e222712ca3b2c4dc2039de2dc36b8d82940","modified":1675611764763},{"_id":"themes/next/layout/_third-party/chat/chatra.swig","hash":"2642e8aef5afbe23a2a76efdc955dab2ee04ed48","modified":1675611764764},{"_id":"themes/next/layout/_third-party/chat/tidio.swig","hash":"fb94ee487d75e484e59b7fba96e989f699ff8a83","modified":1675611764765},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"9298e6d6c4a62a0862fc0f4060ed99779d7b68cb","modified":1675611764765},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"1b29b99fa921f12c25d3dc95facdf84ef7bb1b5c","modified":1675611764766},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"a42f97eda3748583bac2253c47fe5dfa54f07b8f","modified":1675611764766},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"606ad14a29320157df9b8f33738282c51bb393d9","modified":1675611764766},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"3d91899ca079e84d95087b882526d291e6f53918","modified":1675611764767},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"ae2707d6e47582bb470c075649ec7bad86a6d5a9","modified":1675611764767},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"59df21fcfe9d0ada8cee3188cb1075529c1c3eb8","modified":1675611764768},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"276f523e414d4aa7f350a8f2fd3df8a3d8ea9656","modified":1675611764768},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"1f34b2d3c753a3589ab6c462880bd4eb7df09914","modified":1675611764768},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.swig","hash":"d2f0e4c598410ec33785abe302c7ea7492bb791a","modified":1675611764770},{"_id":"themes/next/layout/_third-party/statistics/cnzz-analytics.swig","hash":"53a0760c75d5aaabb3ce8e8aa8e003510d59807f","modified":1675611764770},{"_id":"themes/next/layout/_third-party/statistics/firestore.swig","hash":"01d94354d07e72cad47100482068b6be69fcc033","modified":1675611764771},{"_id":"themes/next/layout/_third-party/statistics/index.swig","hash":"964cd6bac668cf6d211a2624fbef3948cfdece55","modified":1675611764771},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.swig","hash":"c171ea94e9afbba97f06856904264da331559463","modified":1675611764771},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"fd726aad77a57b288f07d6998ec29291c67c7cbb","modified":1675611764769},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"58296a5c1883f26464c2a5ccf734c19f5fbf395a","modified":1675611764769},{"_id":"themes/next/layout/_third-party/search/swiftype.swig","hash":"aa6ab95b8b76611694613defb4bf25003d1b927f","modified":1675611764770},{"_id":"themes/next/layout/_third-party/tags/mermaid.swig","hash":"619338ddacf01e3df812e66a997e778f672f4726","modified":1675611764772},{"_id":"themes/next/layout/_third-party/tags/pdf.swig","hash":"5a223b60406cee7438cfe3a5e41d1284425aa7a5","modified":1675611764772},{"_id":"themes/next/scripts/events/lib/config.js","hash":"aefe3b38a22bc155d485e39187f23e4f2ee5680a","modified":1675611764775},{"_id":"themes/next/scripts/events/lib/injects-point.js","hash":"08496b71c9939718e7955704d219e44d7109247b","modified":1675611764775},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"e73f697bb160b223fdde783237148be5f41c1d78","modified":1675611764776},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"2f22f48f7370470cef78561a47c2a47c78035385","modified":1675611764776},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"0c3bea89d64bc12c1bbe6f208a83773c6fb5375a","modified":1675611764777},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"713056d33dbcd8e9748205c5680b456c21174f4e","modified":1675611764776},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"3a80559df0b670ccb065ea9d3bb587d0b61be3a4","modified":1675611764777},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"67cf90d9a2428c14eb113a64bdd213c22a019aef","modified":1675611764777},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"323a47df6ded894944a2647db44556d6163e67c4","modified":1675611764777},{"_id":"themes/next/scripts/filters/comment/valine.js","hash":"851359f5ff90f733a9bd7fe677edbee8b8ac714c","modified":1675611764778},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"a4f3153ac76a7ffdf6cc70f52f1b2cc218ed393e","modified":1675611764778},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"8714037517cdbac6ccf3cc219ef19fa52691893f","modified":1676189056268},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"5980abbbbeacd8541121f436fa414d24ad5e97c2","modified":1675611764812},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"4e33774b1fe6d0a51f3a428c54c5e600e83bf154","modified":1675611764814},{"_id":"themes/next/source/css/_variables/base.styl","hash":"ad680efdfb2f86546182bf3f59886efbcf3c1b2d","modified":1675611764814},{"_id":"themes/next/source/js/schemes/muse.js","hash":"a18559a9c332199efad0100cf84bb0c23fc0f17a","modified":1675611764821},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"c22b58af3327236ec54d5706501aa5a20e15012e","modified":1675611764814},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"b85a6e2af1387fe64b51e7cd3e2da8616e6f5a3f","modified":1675611764822},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1675611764826},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1675611764826},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"510a6f0ba7485dd54ce347cca890ab52c4957081","modified":1675611764785},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"d17236df3b4d6def1e4e81133ef4729c390de3ac","modified":1675611764785},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"0534b329d279a6f255112b3305ff92c810f31724","modified":1675611764785},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"c52648a7b09f9fe37858f5694fcc1ffc709ad147","modified":1675611764791},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"a2ee16cac29a82cfce26804c160286fcbee94161","modified":1675611764795},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"7a95c27762e1303bf06ee808c63f616cb192fcaf","modified":1675611764795},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"5540c9259cb7895a5f10a289c7937e5470a7c134","modified":1675611764800},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"45f4badac6ec45cf24355f6157aece1d4d3f1134","modified":1675611764800},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"4b068d0d898f4e624937503f0e1428993050bd65","modified":1675611764800},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"6d740699fb6a7640647a8fd77c4ea4992d8d6437","modified":1675611764802},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"b619f39e18398422e0ac4999d8f042a5eaebe9cd","modified":1675611764802},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"43045d115f8fe95732c446aa45bf1c97609ff2a5","modified":1675611764802},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"f317d2e3886e94f5fbb8781c2e68edd19669ff58","modified":1675611764803},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"20e0e3e3eba384930c022e21511214d244b4c9e7","modified":1675611764805},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"e342b8f8e11a3a6aa5a029912c9778c25bf5d135","modified":1675611764806},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"b9e87d32da24264bda247c1526afe140c858b0ef","modified":1675611764807},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"12b265f82840f27112ca2b1be497677f20f87545","modified":1675611764807},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"716e8b0f056bf6393e6bc6969ac84598ab8e7a6f","modified":1675611764807},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"e1c29b81a32273a0dedd926cda199a71aea72624","modified":1675611764808},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"8674bd88df076a1dfe4023ed6750ded1f5b00223","modified":1675611764808},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"c5142739e01e9f25c8b32b2209af85c787bb2b42","modified":1675611764808},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"49c76bc723d3952abb613d9d68398ed7305da999","modified":1675611764809},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"4b7f057dbb53efd7cbe7eac7835a793ab3cbb135","modified":1675611764809},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"9898323ee5a7ac2a5d4f633c653112280beb2643","modified":1675611764809},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"2d3e05015796a790abd9d68957a5c698c0c9f9b6","modified":1675611764809},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"25c2a7930da14f023329df20f38df2728057fb4d","modified":1675611764810},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"558794fced306339b98dc2b0ee7f0576802f1355","modified":1675611764810},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"5de34e1d8a290751641ae456c942410852d5e809","modified":1675611764810},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"0a9f0d9eb042595502d200fb8c65efb0e6c89aa9","modified":1675611764810},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"dc9318992ce2eb086ebaa2fe56b325e56d24098b","modified":1675611764811},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"b69ac38b9da8c9c1b7de696fdeea7f9d7705213a","modified":1675611764811},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"25c2a7930da14f023329df20f38df2728057fb4d","modified":1675611764812},{"_id":"themes/next/source/lib/font-awesome/css/all.min.css","hash":"82e34d28f8a1169b20b60101d5bb0446deba3514","modified":1675611764823},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1675611764825},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"236a039b0900f4267de566b46f62314ad967d30f","modified":1675611764786},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"18edddb2ffb3f85a68e4367f81e06c461e07bc25","modified":1675611764786},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"6cf78a379bb656cc0abb4ab80fcae60152ce41ad","modified":1675611764786},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"f6f05f02d50f742c84ee5122016c0563a8bb2cf9","modified":1675611764787},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"97974c231b4659b8aa5e9321c4d54db5c816d0db","modified":1675611764787},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"a52f8cae599099231866298ed831fdf76c9b6717","modified":1675611764788},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"9af620eba5ccceea21a0e3bc69f6f1fa7637c2f3","modified":1675611764788},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"70b3eb9d36543ab92796ac163544e9cf51b7c1e6","modified":1675611764788},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"97dec98d0403097d66822f1c90b50b2890c84698","modified":1675611764788},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"57b9a179675f1536e017cba457b6ac575e397c4f","modified":1675611764789},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"0dfb97703a519d9438f64f9e41ab1dd37381f733","modified":1675611764789},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"93ba8172c0d2c37d738e6dbd44fcd5a2e23b92f3","modified":1675611764789},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"66fc406796b6efe6cea76550573b7a632112406a","modified":1675611764790},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"2c24829d95c742eb9e8316ebf2fbe9f2c168b59a","modified":1675611764789},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"09dda2667628d1f91b2e37d8fc6df1413f961b64","modified":1675611764790},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5cc9e7394c927065c688cba5edd6e0a27587f1d8","modified":1675611764790},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"b266d2ce5e2b117be01537889e839a69004dc0bb","modified":1675611764790},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"fcd64c23d17775b3635325f6758b648d932e79b5","modified":1675611764791},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"b87f4a06c0db893df4f756f24be182e1a4751f24","modified":1675611764791},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"d83102771df652769e51ddfd041cf5f4ca1a041d","modified":1675611764791},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"8ed7a9d5dfac592de703421b543978095129aa5b","modified":1675611764792},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"1f6b0d3ab227697ca115e57fd61122ea7950e19d","modified":1675611764792},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"bad99f4cccb93b3cefe990a2c85124e60698d32e","modified":1675611764792},{"_id":"themes/next/source/css/_common/outline/footer/footer.styl","hash":"7eeb22c5696f8e0c95161dc57703973cf81c8c12","modified":1675611764793},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"b4f4bae437d4f994af93cf142494ffcd86bae46b","modified":1675611764793},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"b31c86d1a4f89837f9187bed646bda96b2cd286c","modified":1675611764793},{"_id":"themes/next/source/css/_common/outline/header/headerband.styl","hash":"6d5f26646e2914474f295de8bf6dc327d4acd529","modified":1675611764794},{"_id":"themes/next/source/css/_common/outline/header/header.styl","hash":"300058ca12e81013e77ba01fe66ac210525768b6","modified":1675611764794},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"7a3a56b10ab714c0e2ed240d0939deeecdcad167","modified":1675611764794},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"3d16ac0f4ccaeed868c246d4d49bde543d1f62cb","modified":1675611764794},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"b8c816fba0a9b4a35fbae03ba5b1b2da96ba2687","modified":1675611764795},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"49722d555a2edb18094bb2cb3d7336dd72051b93","modified":1675611764796},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"357f825f0a649b2e28cba1481d4c9a0cb402e43a","modified":1675611764797},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"096f908c08ce553e482aadfd3e767a0145191093","modified":1675611764797},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"525242ce9e912c4adfe5134347c67dbdb9e98e3d","modified":1675611764798},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"12f7eaf6b56624cbc411528562d6bb848ff97039","modified":1675611764798},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"b11b04737a1a0fea3bd9f0081d96ee6c015358d4","modified":1675611764798},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"098b4bdf49c7300490f959386d5d1185a32543f6","modified":1675611764799},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"fa0a2ea57b7b4ce75b5d18c264af2d92ea3192f9","modified":1675611764798},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar.styl","hash":"5d540f683018745a5ed1d6f635df28ea610c1244","modified":1675611764799},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"67a1fcb33535122d41acd24f1f49cf02c89b88fa","modified":1675611764799},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"4079e616fbf36112dec0674c1e0713d1d9769068","modified":1675611764801},{"_id":"themes/next/source/css/_common/scaffolding/highlight/diff.styl","hash":"83bd737f663a8461e66985af8ddbfc0a731fc939","modified":1675611764801},{"_id":"themes/next/source/css/_common/scaffolding/highlight/highlight.styl","hash":"80488259271bcfe38031f4c2e902463daba9336b","modified":1675611764801},{"_id":"themes/next/source/css/_common/scaffolding/highlight/theme.styl","hash":"c911045b2ce9a66e38d9dd30c7ed078abbc10cbf","modified":1675611764802},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"ceacfa6218f6084c71a230b086e5d2708d29927e","modified":1675611764803},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"aca7bb220fc14ef2a8f96282d2a95a96a9238d46","modified":1675611764804},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"8b7aafb911850c73074cdb6cc87abe4ac8c12e99","modified":1675611764804},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"adaf0f580fccf4158169eeaf534a18005b39a760","modified":1675611764804},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"03a5bcecc0b12231462ef6ffe432fa77ee71beff","modified":1675611764805},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"3256e39f281f06751a1c0145d9806a0e56d68170","modified":1675611764805},{"_id":"themes/next/source/css/_common/scaffolding/tags/tags.styl","hash":"51d46fa3c7c6b691c61a2c2b0ac005c97cfbf72b","modified":1675611764805},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1675611764824},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1675611764825},{"_id":"public/search.xml","hash":"787796560b0944ccee0d84110767ad03444926f5","modified":1681629188155},{"_id":"public/about/index.html","hash":"fabdcf634c77a88a4fca4ddacffca3a75cca2d1a","modified":1681629188155},{"_id":"public/categories/index.html","hash":"4f5ab0c89dcb1dd43c170b8344680bb3651fba08","modified":1681629188155},{"_id":"public/tags/index.html","hash":"b7e7d3b31b108ae60f1980de2ec6224027141357","modified":1681629188155},{"_id":"public/2023/03/12/Oracle-Broker/index.html","hash":"5844e323469e7b0176619d28ac8f4e50385bf2a1","modified":1681629188155},{"_id":"public/2023/03/12/Oracle-EM/index.html","hash":"c02da8cddc97ce19ba17da023424156c3934858d","modified":1681629188155},{"_id":"public/2023/03/02/Oracle-ORA-1861/index.html","hash":"5792a48834ff36fffa5a8b4e3d4906e0d67b1747","modified":1681629188155},{"_id":"public/2023/02/15/lab-info/index.html","hash":"1f5297126df78ec6557349e40bed4f72cb0e7a25","modified":1681629188155},{"_id":"public/2023/02/13/windows-update/index.html","hash":"0827d0abd9b8b8a0e5c64da2b3d5cc68dbc43a07","modified":1681629188155},{"_id":"public/2023/02/12/Oracle19c-Rman-Restore-Table/index.html","hash":"f14643aff74d714e740f6cbf3654106de5c84d80","modified":1681629188155},{"_id":"public/2023/02/11/hexo雜記/index.html","hash":"a9d36fcc0c570fc5d979898260e2f516bdbb0395","modified":1681629188155},{"_id":"public/2023/02/07/ProxySQL/index.html","hash":"54d1026e00fffef7fff510f81637007224046a75","modified":1681629188155},{"_id":"public/2023/02/07/mariadb-multiple-install/index.html","hash":"540e7fd928674da89e73f2ba71d147ca3475a06b","modified":1681629188155},{"_id":"public/2023/04/16/script-ftp-restart/index.html","hash":"77112903988e3b005caaed15091b8121620f3ba7","modified":1681629188155},{"_id":"public/2023/02/19/SQL-FailOver-Cluster/index.html","hash":"45fa9e826851eb9f1c222b74b3f15d0bc757c2c2","modified":1681629188155},{"_id":"public/2023/02/18/Oracle-DW/index.html","hash":"459bb6a87d9f6789b2843debd357116f3b4a3bdd","modified":1681629188155},{"_id":"public/2023/02/14/Oracle11g-unwrap/index.html","hash":"bd8dce631571fe5681f43f809ccb5c5ab8108968","modified":1681629188155},{"_id":"public/2023/02/12/oracle19c-auto-index/index.html","hash":"8e355e2c1617330a4f938d89d861a16f2800a492","modified":1681629188155},{"_id":"public/2023/02/12/sqlldr-hdsize/index.html","hash":"d6cda25ee2bc18657dc25bf1e21bab786a0305ce","modified":1681629188155},{"_id":"public/2023/02/12/rman-info/index.html","hash":"37eb86c8cb950b453ef99f3b3cc0c94f9ecfb71d","modified":1681629188155},{"_id":"public/2023/02/11/OS-SMS/index.html","hash":"167d2db0d1c5db1a7a3c979658c01612143ecc55","modified":1681629188155},{"_id":"public/2023/02/11/Oracle-Check-URL/index.html","hash":"0e6f5abe1fc5a38a375423f17846b276d6205894","modified":1681629188155},{"_id":"public/2023/02/11/Oracle-Zip/index.html","hash":"4abe16138277338e9dcade644010c25423fc37f7","modified":1681629188155},{"_id":"public/2023/02/11/Oracle-ACL/index.html","hash":"e99126076a6b068775bd80f758705b88d4dbdec1","modified":1681629188155},{"_id":"public/archives/index.html","hash":"caa253a663c5e8781c1e6555240fd71325a6b52a","modified":1681629188155},{"_id":"public/archives/2023/03/index.html","hash":"9c3194eb3db09e3a567be4159e1c7df2a2a63bc0","modified":1681629188155},{"_id":"public/archives/2023/04/index.html","hash":"0dfa98badc5796c569a94ef0f9df00a4352260e3","modified":1681629188155},{"_id":"public/categories/OS/index.html","hash":"5c17f30746359dc9b7b2493f3f4250bbdb270118","modified":1681629188155},{"_id":"public/categories/Oracle/index.html","hash":"b097f482d62432177a1ee0b2e613dd46782cb2fe","modified":1681629188155},{"_id":"public/categories/Oracle11g/index.html","hash":"40ca2a8e3ee482885d521f9c9ffea835d3e5c4b8","modified":1681629188155},{"_id":"public/categories/MariaDB/index.html","hash":"4faa0816379349350db16e318637de696fc512cd","modified":1681629188155},{"_id":"public/categories/Hexo/index.html","hash":"f2eb1795a92748e985526f6097056eb08c4aa712","modified":1681629188155},{"_id":"public/categories/Oracle19c/index.html","hash":"9b5a5d372f7c28c449f1985286a913b8cbfb8f8a","modified":1681629188155},{"_id":"public/categories/HA/index.html","hash":"0227b6f17ad3108010524a03fc88b0f967c3f651","modified":1681629188155},{"_id":"public/categories/MSSQL/index.html","hash":"fa40996a1cced6cb6effded144891c2e5bb0758a","modified":1681629188155},{"_id":"public/categories/Windows/index.html","hash":"83a14122f80f909cd00f01857501c0101c42f860","modified":1681629188155},{"_id":"public/tags/Monitor/index.html","hash":"df16ecd7907456c0e570e44135c21e198e6b1e30","modified":1681629188155},{"_id":"public/tags/Script/index.html","hash":"b8178ece1630afdaa081499a8fbcf418b583b13b","modified":1681629188155},{"_id":"public/tags/ACL/index.html","hash":"0cd65918af3d3b3b366f5e02d0649c2155a5229a","modified":1681629188155},{"_id":"public/tags/Email/index.html","hash":"cc3b3034beaefac5d15d5f6a72a956099ae89779","modified":1681629188155},{"_id":"public/tags/Install/index.html","hash":"c50774cddd5a32066e35d6002bf48d529d13bb24","modified":1681629188155},{"_id":"public/tags/PerformanceTuning/index.html","hash":"e6278323713f404cd03a9f22ee41c92682d4fdd6","modified":1681629188155},{"_id":"public/tags/ORA/index.html","hash":"25e8747a54ad91c86fe8e5f608b6e3e862092ea2","modified":1681629188155},{"_id":"public/tags/Zip/index.html","hash":"4ae5861136bad132ec9160c4a99890367d238829","modified":1681629188155},{"_id":"public/tags/Rman/index.html","hash":"44af56543bdc515943fa9978a725e36c2fa4a9ed","modified":1681629188155},{"_id":"public/tags/Hexo/index.html","hash":"0e7e946642e8f91c48888a51b5510f5cf250aaee","modified":1681629188155},{"_id":"public/archives/2023/index.html","hash":"2e0e8c9e13839b179586c5f4da211a14ee63dc6a","modified":1681629188155},{"_id":"public/archives/2023/02/index.html","hash":"198f03617b25134681d22945d4b69b826d5d89db","modified":1681629188155},{"_id":"public/index.html","hash":"2c3c8d7f7d08f8a893d865db30dee9ff89436394","modified":1681629188155},{"_id":"public/page/2/index.html","hash":"45daf42fe84297f2ff8cc22bb5680946ba91e017","modified":1681629188155},{"_id":"public/page/3/index.html","hash":"673c1e5ea10a6215129d9091e64e807078cf98d8","modified":1681629188155},{"_id":"public/page/4/index.html","hash":"9c5623e25f3bc2f33e78ec3d993f8e85d8d392af","modified":1681629188155},{"_id":"public/page/5/index.html","hash":"b97b5bcd48936e8cbbec9d4234cdd5f90930bf32","modified":1681629188155},{"_id":"public/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1681629188155},{"_id":"public/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1681629188155},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1681629188155},{"_id":"public/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1681629188155},{"_id":"public/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1681629188155},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1681629188155},{"_id":"public/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1681629188155},{"_id":"public/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1681629188155},{"_id":"public/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1681629188155},{"_id":"public/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1681629188155},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1681629188155},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1681629188155},{"_id":"public/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1681629188155},{"_id":"public/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1681629188155},{"_id":"public/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1681629188155},{"_id":"public/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1681629188155},{"_id":"public/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1681629188155},{"_id":"public/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1681629188155},{"_id":"public/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1681629188155},{"_id":"public/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1681629188155},{"_id":"public/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1681629188155},{"_id":"public/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1681629188155},{"_id":"public/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1681629188155},{"_id":"public/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1681629188155},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1681629188155},{"_id":"public/css/main.css","hash":"9ade5f8725af18de34ea1a4db3e7add2710ed47a","modified":1681629188155},{"_id":"public/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1681629188155},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1681629188155},{"_id":"public/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1681629188155}],"Category":[{"name":"OS","_id":"clgj2lm6n0007rcu35sev9b5k"},{"name":"Oracle","_id":"clgj2lm6p000brcu31q85bhcz"},{"name":"Oracle11g","_id":"clgj2lm6y000xrcu35in62u4y"},{"name":"MariaDB","_id":"clgj2lm73001jrcu36cfmbuyb"},{"name":"Hexo","_id":"clgj2lm75001vrcu3bgfdbols"},{"name":"Oracle19c","_id":"clgj2lm750020rcu31fw47clg"},{"name":"HA","_id":"clgj2lm760026rcu3ej5qb1bx"},{"name":"MSSQL","_id":"clgj2lm78002jrcu31nzugv4m"},{"name":"Windows","_id":"clgj2lm7b002wrcu3fafh3x81"}],"Data":[],"Page":[{"title":"關於","date":"2023-02-07T15:33:03.000Z","type":"about","layout":"about","comments":0,"_content":"\n\n\n讓我想想要寫什鬼東西","source":"about/index.md","raw":"---\ntitle: 關於\ndate: 2023-02-07 23:33:03\ntype: \"about\"\nlayout: \"about\"\ncomments: false\n---\n\n\n\n讓我想想要寫什鬼東西","updated":"2023-02-07T16:11:04.641Z","path":"about/index.html","_id":"clgj2lm6d0000rcu36azs4c5v","content":"<p>讓我想想要寫什鬼東西</p>\n","site":{"data":{}},"excerpt":"","more":"<p>讓我想想要寫什鬼東西</p>\n"},{"title":"categories","date":"2023-02-07T15:33:03.000Z","type":"categories","layout":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2023-02-07 23:33:03\ntype: \"categories\"\nlayout: \"categories\"\ncomments: false\n---\n","updated":"2023-02-07T16:01:42.031Z","path":"categories/index.html","_id":"clgj2lm6j0002rcu3b7rp44p2","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2023-02-07T15:33:03.000Z","type":"tags","layout":"tags","comments":0,"_content":"\n","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2023-02-07 23:33:03\ntype: \"tags\"\nlayout: \"tags\"\ncomments: false\n---\n\n","updated":"2023-02-07T16:07:32.218Z","path":"tags/index.html","_id":"clgj2lm6m0005rcu39fvk9lid","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Ping主機異常用中華SMS發送通知","date":"2023-02-11T15:28:25.000Z","_content":"\n使用中華電訊SMS通知異常的範本\n\n<!--more-->\n\n## Check_Ping_Main.bat\n\n```bash\n@echo off\nset Check_Host=要檢查的主機IP\nset SMS_TELNUM=\"接收告警電話1,接收告警電話1\"\nset execFileBASE=f:\\dba\n\ncall %execFileBASE%\\check\\check_ping_base.bat %Check_Host% %SMS_TELNUM%\n```\n\n\n\n\n\n## Check_Ping_Base.bat\n\n```bash\n@echo off\nset Check_Host=%1\nset SMS_TN=%2\nset SMS_TELNUM=%SMS_TN:\"=  %\n\n\n@For /F \"tokens=1,2,3 delims=:. \" %%A in ('echo %time%') do @(\nSet Hour=%%A\nSet Min=%%B\nSet Sec=%%C\nSet p_time=%%A:%%B:%%C\n)\nrem: xp @For /f \"tokens=1-3 delims=/ \" %%a in ('date /t') do (set p_date=%%c-%%b-%%a)\nrem: windows 2003\n@For /f \"tokens=1-4 delims=/ \" %%a in ('date /t') do (set p_date=%%d-%%b-%%c)\nset DateString=%p_date%-%p_time%\n\nset execFileBASE=f:\\dba\nset check_file=%execFileBASE%\\check\\log\\check_ping_1.ck\nset SMS_MESSAGE=%Check_Host% is not availabe yet. -- %DateString%\n\nrem: 中華電訊的sms程式\nset notify=%execFileBASE%\\notify2\\Release\\notify2.exe\nset SMS_IP=中華電訊的sms主機IP\nset SMS_USER=中華電訊的sms帳號\nset SMS_PWD=中華電訊的sms密碼\n\n%SystemRoot%\\system32\\ping.exe -n 1 %Check_Host% >nul\nif errorlevel 1 goto NoServer\n\necho %Check_Host% is availabe.\nif exist %check_file% (del %check_file% /Q)\nrem Insert commands here, for example 1 or more net use to connect network drives.\ngoto :EOF\n\n:NoServer\necho %Check_Host% is not availabe yet.\nif exist %check_file% ( for %%i in (%SMS_TELNUM%) do %notify% %SMS_IP% %SMS_USER%  %SMS_PWD% %%i %SMS_MESSAGE% )\necho \"error\" > %check_file%\ngoto :EOF\n```\n\n","source":"_posts/OS-SMS.md","raw":"---\ntitle: Ping主機異常用中華SMS發送通知\ndate: 2023-02-11 23:28:25\ntags:\n- [Monitor]\n- [Script]\ncategories:\n- [OS]\n---\n\n使用中華電訊SMS通知異常的範本\n\n<!--more-->\n\n## Check_Ping_Main.bat\n\n```bash\n@echo off\nset Check_Host=要檢查的主機IP\nset SMS_TELNUM=\"接收告警電話1,接收告警電話1\"\nset execFileBASE=f:\\dba\n\ncall %execFileBASE%\\check\\check_ping_base.bat %Check_Host% %SMS_TELNUM%\n```\n\n\n\n\n\n## Check_Ping_Base.bat\n\n```bash\n@echo off\nset Check_Host=%1\nset SMS_TN=%2\nset SMS_TELNUM=%SMS_TN:\"=  %\n\n\n@For /F \"tokens=1,2,3 delims=:. \" %%A in ('echo %time%') do @(\nSet Hour=%%A\nSet Min=%%B\nSet Sec=%%C\nSet p_time=%%A:%%B:%%C\n)\nrem: xp @For /f \"tokens=1-3 delims=/ \" %%a in ('date /t') do (set p_date=%%c-%%b-%%a)\nrem: windows 2003\n@For /f \"tokens=1-4 delims=/ \" %%a in ('date /t') do (set p_date=%%d-%%b-%%c)\nset DateString=%p_date%-%p_time%\n\nset execFileBASE=f:\\dba\nset check_file=%execFileBASE%\\check\\log\\check_ping_1.ck\nset SMS_MESSAGE=%Check_Host% is not availabe yet. -- %DateString%\n\nrem: 中華電訊的sms程式\nset notify=%execFileBASE%\\notify2\\Release\\notify2.exe\nset SMS_IP=中華電訊的sms主機IP\nset SMS_USER=中華電訊的sms帳號\nset SMS_PWD=中華電訊的sms密碼\n\n%SystemRoot%\\system32\\ping.exe -n 1 %Check_Host% >nul\nif errorlevel 1 goto NoServer\n\necho %Check_Host% is availabe.\nif exist %check_file% (del %check_file% /Q)\nrem Insert commands here, for example 1 or more net use to connect network drives.\ngoto :EOF\n\n:NoServer\necho %Check_Host% is not availabe yet.\nif exist %check_file% ( for %%i in (%SMS_TELNUM%) do %notify% %SMS_IP% %SMS_USER%  %SMS_PWD% %%i %SMS_MESSAGE% )\necho \"error\" > %check_file%\ngoto :EOF\n```\n\n","slug":"OS-SMS","published":1,"updated":"2023-02-19T14:33:17.608Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6g0001rcu32fat42wf","content":"<p>使用中華電訊SMS通知異常的範本</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Check-Ping-Main-bat\"><a href=\"#Check-Ping-Main-bat\" class=\"headerlink\" title=\"Check_Ping_Main.bat\"></a>Check_Ping_Main.bat</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"><span class=\"built_in\">set</span> Check_Host=要檢查的主機IP</span><br><span class=\"line\"><span class=\"built_in\">set</span> SMS_TELNUM=<span class=\"string\">&quot;接收告警電話1,接收告警電話1&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> execFileBASE=f:\\dba</span><br><span class=\"line\"></span><br><span class=\"line\">call %execFileBASE%\\check\\check_ping_base.bat %Check_Host% %SMS_TELNUM%</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"Check-Ping-Base-bat\"><a href=\"#Check-Ping-Base-bat\" class=\"headerlink\" title=\"Check_Ping_Base.bat\"></a>Check_Ping_Base.bat</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"><span class=\"built_in\">set</span> Check_Host=%1</span><br><span class=\"line\"><span class=\"built_in\">set</span> SMS_TN=%2</span><br><span class=\"line\"><span class=\"built_in\">set</span> SMS_TELNUM=%SMS_TN:<span class=\"string\">&quot;=  %</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">@For /F &quot;</span>tokens=1,2,3 delims=:. <span class=\"string\">&quot; %%A in (&#x27;echo %time%&#x27;) do @(</span></span><br><span class=\"line\"><span class=\"string\">Set Hour=%%A</span></span><br><span class=\"line\"><span class=\"string\">Set Min=%%B</span></span><br><span class=\"line\"><span class=\"string\">Set Sec=%%C</span></span><br><span class=\"line\"><span class=\"string\">Set p_time=%%A:%%B:%%C</span></span><br><span class=\"line\"><span class=\"string\">)</span></span><br><span class=\"line\"><span class=\"string\">rem: xp @For /f &quot;</span>tokens=1-3 delims=/ <span class=\"string\">&quot; %%a in (&#x27;date /t&#x27;) do (set p_date=%%c-%%b-%%a)</span></span><br><span class=\"line\"><span class=\"string\">rem: windows 2003</span></span><br><span class=\"line\"><span class=\"string\">@For /f &quot;</span>tokens=1-4 delims=/ <span class=\"string\">&quot; %%a in (&#x27;date /t&#x27;) do (set p_date=%%d-%%b-%%c)</span></span><br><span class=\"line\"><span class=\"string\">set DateString=%p_date%-%p_time%</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">set execFileBASE=f:\\dba</span></span><br><span class=\"line\"><span class=\"string\">set check_file=%execFileBASE%\\check\\log\\check_ping_1.ck</span></span><br><span class=\"line\"><span class=\"string\">set SMS_MESSAGE=%Check_Host% is not availabe yet. -- %DateString%</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">rem: 中華電訊的sms程式</span></span><br><span class=\"line\"><span class=\"string\">set notify=%execFileBASE%\\notify2\\Release\\notify2.exe</span></span><br><span class=\"line\"><span class=\"string\">set SMS_IP=中華電訊的sms主機IP</span></span><br><span class=\"line\"><span class=\"string\">set SMS_USER=中華電訊的sms帳號</span></span><br><span class=\"line\"><span class=\"string\">set SMS_PWD=中華電訊的sms密碼</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">%SystemRoot%\\system32\\ping.exe -n 1 %Check_Host% &gt;nul</span></span><br><span class=\"line\"><span class=\"string\">if errorlevel 1 goto NoServer</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo %Check_Host% is availabe.</span></span><br><span class=\"line\"><span class=\"string\">if exist %check_file% (del %check_file% /Q)</span></span><br><span class=\"line\"><span class=\"string\">rem Insert commands here, for example 1 or more net use to connect network drives.</span></span><br><span class=\"line\"><span class=\"string\">goto :EOF</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">:NoServer</span></span><br><span class=\"line\"><span class=\"string\">echo %Check_Host% is not availabe yet.</span></span><br><span class=\"line\"><span class=\"string\">if exist %check_file% ( for %%i in (%SMS_TELNUM%) do %notify% %SMS_IP% %SMS_USER%  %SMS_PWD% %%i %SMS_MESSAGE% )</span></span><br><span class=\"line\"><span class=\"string\">echo &quot;</span>error<span class=\"string\">&quot; &gt; %check_file%</span></span><br><span class=\"line\"><span class=\"string\">goto :EOF</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>使用中華電訊SMS通知異常的範本</p>","more":"<h2 id=\"Check-Ping-Main-bat\"><a href=\"#Check-Ping-Main-bat\" class=\"headerlink\" title=\"Check_Ping_Main.bat\"></a>Check_Ping_Main.bat</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"><span class=\"built_in\">set</span> Check_Host=要檢查的主機IP</span><br><span class=\"line\"><span class=\"built_in\">set</span> SMS_TELNUM=<span class=\"string\">&quot;接收告警電話1,接收告警電話1&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> execFileBASE=f:\\dba</span><br><span class=\"line\"></span><br><span class=\"line\">call %execFileBASE%\\check\\check_ping_base.bat %Check_Host% %SMS_TELNUM%</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"Check-Ping-Base-bat\"><a href=\"#Check-Ping-Base-bat\" class=\"headerlink\" title=\"Check_Ping_Base.bat\"></a>Check_Ping_Base.bat</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"><span class=\"built_in\">set</span> Check_Host=%1</span><br><span class=\"line\"><span class=\"built_in\">set</span> SMS_TN=%2</span><br><span class=\"line\"><span class=\"built_in\">set</span> SMS_TELNUM=%SMS_TN:<span class=\"string\">&quot;=  %</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">@For /F &quot;</span>tokens=1,2,3 delims=:. <span class=\"string\">&quot; %%A in (&#x27;echo %time%&#x27;) do @(</span></span><br><span class=\"line\"><span class=\"string\">Set Hour=%%A</span></span><br><span class=\"line\"><span class=\"string\">Set Min=%%B</span></span><br><span class=\"line\"><span class=\"string\">Set Sec=%%C</span></span><br><span class=\"line\"><span class=\"string\">Set p_time=%%A:%%B:%%C</span></span><br><span class=\"line\"><span class=\"string\">)</span></span><br><span class=\"line\"><span class=\"string\">rem: xp @For /f &quot;</span>tokens=1-3 delims=/ <span class=\"string\">&quot; %%a in (&#x27;date /t&#x27;) do (set p_date=%%c-%%b-%%a)</span></span><br><span class=\"line\"><span class=\"string\">rem: windows 2003</span></span><br><span class=\"line\"><span class=\"string\">@For /f &quot;</span>tokens=1-4 delims=/ <span class=\"string\">&quot; %%a in (&#x27;date /t&#x27;) do (set p_date=%%d-%%b-%%c)</span></span><br><span class=\"line\"><span class=\"string\">set DateString=%p_date%-%p_time%</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">set execFileBASE=f:\\dba</span></span><br><span class=\"line\"><span class=\"string\">set check_file=%execFileBASE%\\check\\log\\check_ping_1.ck</span></span><br><span class=\"line\"><span class=\"string\">set SMS_MESSAGE=%Check_Host% is not availabe yet. -- %DateString%</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">rem: 中華電訊的sms程式</span></span><br><span class=\"line\"><span class=\"string\">set notify=%execFileBASE%\\notify2\\Release\\notify2.exe</span></span><br><span class=\"line\"><span class=\"string\">set SMS_IP=中華電訊的sms主機IP</span></span><br><span class=\"line\"><span class=\"string\">set SMS_USER=中華電訊的sms帳號</span></span><br><span class=\"line\"><span class=\"string\">set SMS_PWD=中華電訊的sms密碼</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">%SystemRoot%\\system32\\ping.exe -n 1 %Check_Host% &gt;nul</span></span><br><span class=\"line\"><span class=\"string\">if errorlevel 1 goto NoServer</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo %Check_Host% is availabe.</span></span><br><span class=\"line\"><span class=\"string\">if exist %check_file% (del %check_file% /Q)</span></span><br><span class=\"line\"><span class=\"string\">rem Insert commands here, for example 1 or more net use to connect network drives.</span></span><br><span class=\"line\"><span class=\"string\">goto :EOF</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">:NoServer</span></span><br><span class=\"line\"><span class=\"string\">echo %Check_Host% is not availabe yet.</span></span><br><span class=\"line\"><span class=\"string\">if exist %check_file% ( for %%i in (%SMS_TELNUM%) do %notify% %SMS_IP% %SMS_USER%  %SMS_PWD% %%i %SMS_MESSAGE% )</span></span><br><span class=\"line\"><span class=\"string\">echo &quot;</span>error<span class=\"string\">&quot; &gt; %check_file%</span></span><br><span class=\"line\"><span class=\"string\">goto :EOF</span></span><br></pre></td></tr></table></figure>"},{"title":"Oracle ACL設定","date":"2023-02-11T13:14:23.000Z","description":"Oracle ACL設定","_content":"\nACL維護和Mail\n\n<!--more-->\n\n## 刪除ACL設定\n\n```SQL\nbegin\n dbms_network_acl_admin.drop_acl(acl => 'mail_acl_file.xml'); \n commit;\nend;\n```\n\n\n\n## 新增ACL設定\n\n```SQL\nBEGIN\nDBMS_NETWORK_ACL_ADMIN.create_acl (\nacl => 'mail_acl_file.xml',\ndescription => 'create by 2020/1/1',\nprincipal => 'User帳號',--改這\nis_grant => TRUE,\nprivilege => 'connect',\nstart_date => SYSTIMESTAMP,\nend_date => NULL);\ncommit;\nEND;\n/\n```\n\n\n\n## 新增ACL權限\n\n```sql\nbegin\n  dbms_network_acl_admin.add_privilege (\n  acl => 'mail_acl_file.xml',\n  principal => 'User帳號',--改這\n  is_grant => true,\n  privilege => 'connect'\n  );\n  commit;\n  end;\n/\n\nbegin\ndbms_network_acl_admin.add_privilege(\n   acl => 'mail_acl_file.xml',\n   principal => 'User帳號',--改這\n   is_grant => TRUE,\n   privilege => 'resolve'\n   ); \n  commit;\nend;\n/ \n```\n\n\n\n------\n\n\n\n## 設定Email-ACL\n\n```sql\nbegin\n    dbms_network_acl_admin.assign_acl(\n    acl => 'mail_acl_file.xml',\n    host => 'Mail IP'--改這\n    );\n    commit;\nend;  \n/\n```\n\n\n\n## 相關SQL\n\n```sql\nSELECT host, lower_port, upper_port, acl FROM dba_network_acls;\n\nselect acl,principal,privilege,is_grant,to_char(start_date, 'dd-mon-yyyy') as start_date,to_char(end_date, 'dd-mon-yyyy') as end_date \nfrom dba_network_acl_privileges;\n\nselect any_path from resource_view where any_path like '/sys/acls/%.xml';\n```\n\n\n\n------\n\n\n\n## Schedule Mail\n\n```sql\nselect * from DBA_SCHEDULER_GLOBAL_ATTRIBUTE;\n\nexecute DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE ('EMAIL_SERVER',' Mail_IP');\n\nexecute DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE ('EMAIL_SENDER','寄件者Mail');\n```\n\n\n\n## Mail_PROCEDURE\n\n```plsql\nCREATE OR REPLACE PROCEDURE DBA_MONITOR_SEND_MAIL (\n   p_from          IN VARCHAR2,\n   p_to            IN VARCHAR2,   \n   p_cc            IN VARCHAR2 default null,\n   p_bcc           IN VARCHAR2 default null,\n   p_reply         IN VARCHAR2 default null,\n   p_subject       IN VARCHAR2,   \n   p_text          IN VARCHAR2 default null,\n   p_html          in VARCHAR2 default null,\n   p_smtp_hostname in varchar2,\n   p_smtp_portnum  in number,\n   p_domain        in varchar2 default null,\n   p_login         in varchar2,\n   p_pwd           in varchar2,\n   p_html_body     in clob \n   )\nIS\n --宣告\n  l_mail_conn   UTL_SMTP.connection;\n  l_boundary    VARCHAR2(50) := '----=*#abc1234321cba#*=';\n\n  \nBEGIN\n --設定伺服器\n  l_mail_conn := UTL_SMTP.open_connection(p_smtp_hostname, p_smtp_portnum);\n  --l_mail_conn := utl_smtp.open_connection('1.1.1.1', 25);\n  UTL_SMTP.helo(l_mail_conn, p_smtp_hostname);\n\n --寄件者\n  UTL_SMTP.mail(l_mail_conn, p_from);\n\n --收件者\n  UTL_SMTP.rcpt(l_mail_conn,  p_to);\n  if p_cc is not null then    \n    UTL_SMTP.rcpt(l_mail_conn,  p_cc);      \n  end if;\n  UTL_SMTP.open_data(l_mail_conn);\n\n -- 主旨\n  UTL_SMTP.write_data(l_mail_conn, 'From: ' || p_from || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, 'To: ' || p_to || UTL_TCP.crlf);\n  if p_cc is not null then    \n    UTL_SMTP.write_data(l_mail_conn, 'Cc: ' || p_cc || UTL_TCP.crlf);  \n  end if;\n  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( 'Subject: '|| p_subject || UTL_TCP.crlf));\n  UTL_SMTP.write_data(l_mail_conn, 'MIME-Version: 1.0' || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, 'Content-Type: multipart/alternative; boundary=\"' || l_boundary || '\"' || UTL_TCP.crlf || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, '--' || l_boundary || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, 'Content-Type: text/html; charset=utf-8/big5' || UTL_TCP.crlf || UTL_TCP.crlf);\n  --utl_smtp.write_data( l_mail_conn, 'Content-Transfer-Encoding: 8bit' || UTL_TCP.crlf );\n  \n  --UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( p_html_body ));\n  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw(CONVERT(dbms_lob.substr(p_html_body), 'UTF8')));\n  UTL_SMTP.write_data(l_mail_conn, UTL_TCP.crlf || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, '--' || l_boundary || '--' || UTL_TCP.crlf);\n  UTL_SMTP.close_data(l_mail_conn);\n  UTL_SMTP.quit(l_mail_conn);\nEND;\n/\n```\n\n\n\n------\n\n\n\n## Windows Script\n\n```bash\nrem:\nrem: WScript Send Mail\nrem: cscript SendMail.vbs /P_From:From /P_To:To /P_Subject:Subject /P_TextBody:TextBody /P_File:File\n/P_TextBody:TextBody_test /P_File:D:\\binhu_folder\\temp\\README-BR.txt\nrem:\n\nSmtpName = \"SMTP主機IP\"\nLogin = \"Mail帳號\"\nLoginPassword = \"Mail密碼\"\nDim P_From\nDim P_To\nDim P_Subject\nDim P_TextBody\nDim P_File\n\nrem: WScript.Echo Wscript.Arguments.Named(\"P_From\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_To\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_Subject\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_TextBody\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_File\")\n\nP_From=Wscript.Arguments.Named(\"P_From\")\nP_To=Wscript.Arguments.Named(\"P_To\")\nP_Subject=Wscript.Arguments.Named(\"P_Subject\")\nP_TextBody=Wscript.Arguments.Named(\"P_TextBody\")\nP_File=Wscript.Arguments.Named(\"P_File\")\n\n\nSet objEmail = CreateObject(\"CDO.Message\")\n    objEmail.From = P_From\n    objEmail.To = P_To\n    objEmail.Subject = P_Subject\n    objEmail.Textbody = P_TextBody\n    Set objFSO = CreateObject(\"Scripting.FileSystemObject\")\n        IF objFSO.FileExists (P_File) then\n           objEmail.Addattachment P_File\n           rem: WScript.echo \"File Exist\"\n        end if \n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/sendusing\") = 2\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/smtpserver\") = SmtpName\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/smtpserverport\") = 25\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/smtpauthenticate\") = 1\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/sendusername\") = Login\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/sendpassword\") = LoginPassword\n    objEmail.Configuration.Fields.Update\n    objEmail.Send\n\nSet objEmail = Nothing\n```\n\n","source":"_posts/Oracle-ACL.md","raw":"---\ntitle: Oracle ACL設定\ndate: 2023-02-11 21:14:23\ntags:\n- [ACL]\n- [Email]\n- [Script]\ncategories:\n- [Oracle]\ndescription: Oracle ACL設定\n---\n\nACL維護和Mail\n\n<!--more-->\n\n## 刪除ACL設定\n\n```SQL\nbegin\n dbms_network_acl_admin.drop_acl(acl => 'mail_acl_file.xml'); \n commit;\nend;\n```\n\n\n\n## 新增ACL設定\n\n```SQL\nBEGIN\nDBMS_NETWORK_ACL_ADMIN.create_acl (\nacl => 'mail_acl_file.xml',\ndescription => 'create by 2020/1/1',\nprincipal => 'User帳號',--改這\nis_grant => TRUE,\nprivilege => 'connect',\nstart_date => SYSTIMESTAMP,\nend_date => NULL);\ncommit;\nEND;\n/\n```\n\n\n\n## 新增ACL權限\n\n```sql\nbegin\n  dbms_network_acl_admin.add_privilege (\n  acl => 'mail_acl_file.xml',\n  principal => 'User帳號',--改這\n  is_grant => true,\n  privilege => 'connect'\n  );\n  commit;\n  end;\n/\n\nbegin\ndbms_network_acl_admin.add_privilege(\n   acl => 'mail_acl_file.xml',\n   principal => 'User帳號',--改這\n   is_grant => TRUE,\n   privilege => 'resolve'\n   ); \n  commit;\nend;\n/ \n```\n\n\n\n------\n\n\n\n## 設定Email-ACL\n\n```sql\nbegin\n    dbms_network_acl_admin.assign_acl(\n    acl => 'mail_acl_file.xml',\n    host => 'Mail IP'--改這\n    );\n    commit;\nend;  \n/\n```\n\n\n\n## 相關SQL\n\n```sql\nSELECT host, lower_port, upper_port, acl FROM dba_network_acls;\n\nselect acl,principal,privilege,is_grant,to_char(start_date, 'dd-mon-yyyy') as start_date,to_char(end_date, 'dd-mon-yyyy') as end_date \nfrom dba_network_acl_privileges;\n\nselect any_path from resource_view where any_path like '/sys/acls/%.xml';\n```\n\n\n\n------\n\n\n\n## Schedule Mail\n\n```sql\nselect * from DBA_SCHEDULER_GLOBAL_ATTRIBUTE;\n\nexecute DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE ('EMAIL_SERVER',' Mail_IP');\n\nexecute DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE ('EMAIL_SENDER','寄件者Mail');\n```\n\n\n\n## Mail_PROCEDURE\n\n```plsql\nCREATE OR REPLACE PROCEDURE DBA_MONITOR_SEND_MAIL (\n   p_from          IN VARCHAR2,\n   p_to            IN VARCHAR2,   \n   p_cc            IN VARCHAR2 default null,\n   p_bcc           IN VARCHAR2 default null,\n   p_reply         IN VARCHAR2 default null,\n   p_subject       IN VARCHAR2,   \n   p_text          IN VARCHAR2 default null,\n   p_html          in VARCHAR2 default null,\n   p_smtp_hostname in varchar2,\n   p_smtp_portnum  in number,\n   p_domain        in varchar2 default null,\n   p_login         in varchar2,\n   p_pwd           in varchar2,\n   p_html_body     in clob \n   )\nIS\n --宣告\n  l_mail_conn   UTL_SMTP.connection;\n  l_boundary    VARCHAR2(50) := '----=*#abc1234321cba#*=';\n\n  \nBEGIN\n --設定伺服器\n  l_mail_conn := UTL_SMTP.open_connection(p_smtp_hostname, p_smtp_portnum);\n  --l_mail_conn := utl_smtp.open_connection('1.1.1.1', 25);\n  UTL_SMTP.helo(l_mail_conn, p_smtp_hostname);\n\n --寄件者\n  UTL_SMTP.mail(l_mail_conn, p_from);\n\n --收件者\n  UTL_SMTP.rcpt(l_mail_conn,  p_to);\n  if p_cc is not null then    \n    UTL_SMTP.rcpt(l_mail_conn,  p_cc);      \n  end if;\n  UTL_SMTP.open_data(l_mail_conn);\n\n -- 主旨\n  UTL_SMTP.write_data(l_mail_conn, 'From: ' || p_from || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, 'To: ' || p_to || UTL_TCP.crlf);\n  if p_cc is not null then    \n    UTL_SMTP.write_data(l_mail_conn, 'Cc: ' || p_cc || UTL_TCP.crlf);  \n  end if;\n  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( 'Subject: '|| p_subject || UTL_TCP.crlf));\n  UTL_SMTP.write_data(l_mail_conn, 'MIME-Version: 1.0' || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, 'Content-Type: multipart/alternative; boundary=\"' || l_boundary || '\"' || UTL_TCP.crlf || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, '--' || l_boundary || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, 'Content-Type: text/html; charset=utf-8/big5' || UTL_TCP.crlf || UTL_TCP.crlf);\n  --utl_smtp.write_data( l_mail_conn, 'Content-Transfer-Encoding: 8bit' || UTL_TCP.crlf );\n  \n  --UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( p_html_body ));\n  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw(CONVERT(dbms_lob.substr(p_html_body), 'UTF8')));\n  UTL_SMTP.write_data(l_mail_conn, UTL_TCP.crlf || UTL_TCP.crlf);\n  UTL_SMTP.write_data(l_mail_conn, '--' || l_boundary || '--' || UTL_TCP.crlf);\n  UTL_SMTP.close_data(l_mail_conn);\n  UTL_SMTP.quit(l_mail_conn);\nEND;\n/\n```\n\n\n\n------\n\n\n\n## Windows Script\n\n```bash\nrem:\nrem: WScript Send Mail\nrem: cscript SendMail.vbs /P_From:From /P_To:To /P_Subject:Subject /P_TextBody:TextBody /P_File:File\n/P_TextBody:TextBody_test /P_File:D:\\binhu_folder\\temp\\README-BR.txt\nrem:\n\nSmtpName = \"SMTP主機IP\"\nLogin = \"Mail帳號\"\nLoginPassword = \"Mail密碼\"\nDim P_From\nDim P_To\nDim P_Subject\nDim P_TextBody\nDim P_File\n\nrem: WScript.Echo Wscript.Arguments.Named(\"P_From\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_To\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_Subject\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_TextBody\")\nrem: WScript.Echo Wscript.Arguments.Named(\"P_File\")\n\nP_From=Wscript.Arguments.Named(\"P_From\")\nP_To=Wscript.Arguments.Named(\"P_To\")\nP_Subject=Wscript.Arguments.Named(\"P_Subject\")\nP_TextBody=Wscript.Arguments.Named(\"P_TextBody\")\nP_File=Wscript.Arguments.Named(\"P_File\")\n\n\nSet objEmail = CreateObject(\"CDO.Message\")\n    objEmail.From = P_From\n    objEmail.To = P_To\n    objEmail.Subject = P_Subject\n    objEmail.Textbody = P_TextBody\n    Set objFSO = CreateObject(\"Scripting.FileSystemObject\")\n        IF objFSO.FileExists (P_File) then\n           objEmail.Addattachment P_File\n           rem: WScript.echo \"File Exist\"\n        end if \n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/sendusing\") = 2\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/smtpserver\") = SmtpName\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/smtpserverport\") = 25\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/smtpauthenticate\") = 1\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/sendusername\") = Login\n    objEmail.Configuration.Fields.Item (\"http://schemas.microsoft.com/cdo/configuration/sendpassword\") = LoginPassword\n    objEmail.Configuration.Fields.Update\n    objEmail.Send\n\nSet objEmail = Nothing\n```\n\n","slug":"Oracle-ACL","published":1,"updated":"2023-02-19T14:31:02.609Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6j0003rcu330elfp22","content":"<p>ACL維護和Mail</p>\n<span id=\"more\"></span>\n\n<h2 id=\"刪除ACL設定\"><a href=\"#刪除ACL設定\" class=\"headerlink\" title=\"刪除ACL設定\"></a>刪除ACL設定</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"> dbms_network_acl_admin.drop_acl(acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>); </span><br><span class=\"line\"> <span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"新增ACL設定\"><a href=\"#新增ACL設定\" class=\"headerlink\" title=\"新增ACL設定\"></a>新增ACL設定</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">DBMS_NETWORK_ACL_ADMIN.create_acl (</span><br><span class=\"line\">acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">description <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;create by 2020/1/1&#x27;</span>,</span><br><span class=\"line\">principal <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;User帳號&#x27;</span>,<span class=\"comment\">--改這</span></span><br><span class=\"line\">is_grant <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"literal\">TRUE</span>,</span><br><span class=\"line\">privilege <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;connect&#x27;</span>,</span><br><span class=\"line\">start_date <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> SYSTIMESTAMP,</span><br><span class=\"line\">end_date <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"keyword\">NULL</span>);</span><br><span class=\"line\"><span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"新增ACL權限\"><a href=\"#新增ACL權限\" class=\"headerlink\" title=\"新增ACL權限\"></a>新增ACL權限</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  dbms_network_acl_admin.add_privilege (</span><br><span class=\"line\">  acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">  principal <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;User帳號&#x27;</span>,<span class=\"comment\">--改這</span></span><br><span class=\"line\">  is_grant <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"literal\">true</span>,</span><br><span class=\"line\">  privilege <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;connect&#x27;</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">commit</span>;</span><br><span class=\"line\">  <span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">dbms_network_acl_admin.add_privilege(</span><br><span class=\"line\">   acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">   principal <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;User帳號&#x27;</span>,<span class=\"comment\">--改這</span></span><br><span class=\"line\">   is_grant <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"literal\">TRUE</span>,</span><br><span class=\"line\">   privilege <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;resolve&#x27;</span></span><br><span class=\"line\">   ); </span><br><span class=\"line\">  <span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span> </span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"設定Email-ACL\"><a href=\"#設定Email-ACL\" class=\"headerlink\" title=\"設定Email-ACL\"></a>設定Email-ACL</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    dbms_network_acl_admin.assign_acl(</span><br><span class=\"line\">    acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">    host <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;Mail IP&#x27;</span><span class=\"comment\">--改這</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;  </span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"相關SQL\"><a href=\"#相關SQL\" class=\"headerlink\" title=\"相關SQL\"></a>相關SQL</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> host, lower_port, upper_port, acl <span class=\"keyword\">FROM</span> dba_network_acls;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> acl,principal,privilege,is_grant,to_char(start_date, <span class=\"string\">&#x27;dd-mon-yyyy&#x27;</span>) <span class=\"keyword\">as</span> start_date,to_char(end_date, <span class=\"string\">&#x27;dd-mon-yyyy&#x27;</span>) <span class=\"keyword\">as</span> end_date </span><br><span class=\"line\"><span class=\"keyword\">from</span> dba_network_acl_privileges;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> any_path <span class=\"keyword\">from</span> resource_view <span class=\"keyword\">where</span> any_path <span class=\"keyword\">like</span> <span class=\"string\">&#x27;/sys/acls/%.xml&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"Schedule-Mail\"><a href=\"#Schedule-Mail\" class=\"headerlink\" title=\"Schedule Mail\"></a>Schedule Mail</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> DBA_SCHEDULER_GLOBAL_ATTRIBUTE;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">execute</span> DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE (<span class=\"string\">&#x27;EMAIL_SERVER&#x27;</span>,<span class=\"string\">&#x27; Mail_IP&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">execute</span> DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE (<span class=\"string\">&#x27;EMAIL_SENDER&#x27;</span>,<span class=\"string\">&#x27;寄件者Mail&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Mail-PROCEDURE\"><a href=\"#Mail-PROCEDURE\" class=\"headerlink\" title=\"Mail_PROCEDURE\"></a>Mail_PROCEDURE</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE OR REPLACE PROCEDURE DBA_MONITOR_SEND_MAIL (</span><br><span class=\"line\">   p_from          IN VARCHAR2,</span><br><span class=\"line\">   p_to            IN VARCHAR2,   </span><br><span class=\"line\">   p_cc            IN VARCHAR2 default null,</span><br><span class=\"line\">   p_bcc           IN VARCHAR2 default null,</span><br><span class=\"line\">   p_reply         IN VARCHAR2 default null,</span><br><span class=\"line\">   p_subject       IN VARCHAR2,   </span><br><span class=\"line\">   p_text          IN VARCHAR2 default null,</span><br><span class=\"line\">   p_html          in VARCHAR2 default null,</span><br><span class=\"line\">   p_smtp_hostname in varchar2,</span><br><span class=\"line\">   p_smtp_portnum  in number,</span><br><span class=\"line\">   p_domain        in varchar2 default null,</span><br><span class=\"line\">   p_login         in varchar2,</span><br><span class=\"line\">   p_pwd           in varchar2,</span><br><span class=\"line\">   p_html_body     in clob </span><br><span class=\"line\">   )</span><br><span class=\"line\">IS</span><br><span class=\"line\"> --宣告</span><br><span class=\"line\">  l_mail_conn   UTL_SMTP.connection;</span><br><span class=\"line\">  l_boundary    VARCHAR2(50) := &#x27;----=*#abc1234321cba#*=&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">BEGIN</span><br><span class=\"line\"> --設定伺服器</span><br><span class=\"line\">  l_mail_conn := UTL_SMTP.open_connection(p_smtp_hostname, p_smtp_portnum);</span><br><span class=\"line\">  --l_mail_conn := utl_smtp.open_connection(&#x27;1.1.1.1&#x27;, 25);</span><br><span class=\"line\">  UTL_SMTP.helo(l_mail_conn, p_smtp_hostname);</span><br><span class=\"line\"></span><br><span class=\"line\"> --寄件者</span><br><span class=\"line\">  UTL_SMTP.mail(l_mail_conn, p_from);</span><br><span class=\"line\"></span><br><span class=\"line\"> --收件者</span><br><span class=\"line\">  UTL_SMTP.rcpt(l_mail_conn,  p_to);</span><br><span class=\"line\">  if p_cc is not null then    </span><br><span class=\"line\">    UTL_SMTP.rcpt(l_mail_conn,  p_cc);      </span><br><span class=\"line\">  end if;</span><br><span class=\"line\">  UTL_SMTP.open_data(l_mail_conn);</span><br><span class=\"line\"></span><br><span class=\"line\"> -- 主旨</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;From: &#x27; || p_from || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;To: &#x27; || p_to || UTL_TCP.crlf);</span><br><span class=\"line\">  if p_cc is not null then    </span><br><span class=\"line\">    UTL_SMTP.write_data(l_mail_conn, &#x27;Cc: &#x27; || p_cc || UTL_TCP.crlf);  </span><br><span class=\"line\">  end if;</span><br><span class=\"line\">  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( &#x27;Subject: &#x27;|| p_subject || UTL_TCP.crlf));</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;MIME-Version: 1.0&#x27; || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;Content-Type: multipart/alternative; boundary=&quot;&#x27; || l_boundary || &#x27;&quot;&#x27; || UTL_TCP.crlf || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;--&#x27; || l_boundary || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;Content-Type: text/html; charset=utf-8/big5&#x27; || UTL_TCP.crlf || UTL_TCP.crlf);</span><br><span class=\"line\">  --utl_smtp.write_data( l_mail_conn, &#x27;Content-Transfer-Encoding: 8bit&#x27; || UTL_TCP.crlf );</span><br><span class=\"line\">  </span><br><span class=\"line\">  --UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( p_html_body ));</span><br><span class=\"line\">  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw(CONVERT(dbms_lob.substr(p_html_body), &#x27;UTF8&#x27;)));</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, UTL_TCP.crlf || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;--&#x27; || l_boundary || &#x27;--&#x27; || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.close_data(l_mail_conn);</span><br><span class=\"line\">  UTL_SMTP.quit(l_mail_conn);</span><br><span class=\"line\">END;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"Windows-Script\"><a href=\"#Windows-Script\" class=\"headerlink\" title=\"Windows Script\"></a>Windows Script</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rem:</span><br><span class=\"line\">rem: WScript Send Mail</span><br><span class=\"line\">rem: cscript SendMail.vbs /P_From:From /P_To:To /P_Subject:Subject /P_TextBody:TextBody /P_File:File</span><br><span class=\"line\">/P_TextBody:TextBody_test /P_File:D:\\binhu_folder\\temp\\README-BR.txt</span><br><span class=\"line\">rem:</span><br><span class=\"line\"></span><br><span class=\"line\">SmtpName = <span class=\"string\">&quot;SMTP主機IP&quot;</span></span><br><span class=\"line\">Login = <span class=\"string\">&quot;Mail帳號&quot;</span></span><br><span class=\"line\">LoginPassword = <span class=\"string\">&quot;Mail密碼&quot;</span></span><br><span class=\"line\">Dim P_From</span><br><span class=\"line\">Dim P_To</span><br><span class=\"line\">Dim P_Subject</span><br><span class=\"line\">Dim P_TextBody</span><br><span class=\"line\">Dim P_File</span><br><span class=\"line\"></span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_From&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_To&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_Subject&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_TextBody&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_File&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">P_From=Wscript.Arguments.Named(<span class=\"string\">&quot;P_From&quot;</span>)</span><br><span class=\"line\">P_To=Wscript.Arguments.Named(<span class=\"string\">&quot;P_To&quot;</span>)</span><br><span class=\"line\">P_Subject=Wscript.Arguments.Named(<span class=\"string\">&quot;P_Subject&quot;</span>)</span><br><span class=\"line\">P_TextBody=Wscript.Arguments.Named(<span class=\"string\">&quot;P_TextBody&quot;</span>)</span><br><span class=\"line\">P_File=Wscript.Arguments.Named(<span class=\"string\">&quot;P_File&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Set objEmail = CreateObject(<span class=\"string\">&quot;CDO.Message&quot;</span>)</span><br><span class=\"line\">    objEmail.From = P_From</span><br><span class=\"line\">    objEmail.To = P_To</span><br><span class=\"line\">    objEmail.Subject = P_Subject</span><br><span class=\"line\">    objEmail.Textbody = P_TextBody</span><br><span class=\"line\">    Set objFSO = CreateObject(<span class=\"string\">&quot;Scripting.FileSystemObject&quot;</span>)</span><br><span class=\"line\">        IF objFSO.FileExists (P_File) <span class=\"keyword\">then</span></span><br><span class=\"line\">           objEmail.Addattachment P_File</span><br><span class=\"line\">           rem: WScript.<span class=\"built_in\">echo</span> <span class=\"string\">&quot;File Exist&quot;</span></span><br><span class=\"line\">        end <span class=\"keyword\">if</span> </span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/sendusing&quot;</span>) = 2</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/smtpserver&quot;</span>) = SmtpName</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/smtpserverport&quot;</span>) = 25</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/smtpauthenticate&quot;</span>) = 1</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/sendusername&quot;</span>) = Login</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/sendpassword&quot;</span>) = LoginPassword</span><br><span class=\"line\">    objEmail.Configuration.Fields.Update</span><br><span class=\"line\">    objEmail.Send</span><br><span class=\"line\"></span><br><span class=\"line\">Set objEmail = Nothing</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>ACL維護和Mail</p>","more":"<h2 id=\"刪除ACL設定\"><a href=\"#刪除ACL設定\" class=\"headerlink\" title=\"刪除ACL設定\"></a>刪除ACL設定</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\"> dbms_network_acl_admin.drop_acl(acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>); </span><br><span class=\"line\"> <span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"新增ACL設定\"><a href=\"#新增ACL設定\" class=\"headerlink\" title=\"新增ACL設定\"></a>新增ACL設定</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">DBMS_NETWORK_ACL_ADMIN.create_acl (</span><br><span class=\"line\">acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">description <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;create by 2020/1/1&#x27;</span>,</span><br><span class=\"line\">principal <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;User帳號&#x27;</span>,<span class=\"comment\">--改這</span></span><br><span class=\"line\">is_grant <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"literal\">TRUE</span>,</span><br><span class=\"line\">privilege <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;connect&#x27;</span>,</span><br><span class=\"line\">start_date <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> SYSTIMESTAMP,</span><br><span class=\"line\">end_date <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"keyword\">NULL</span>);</span><br><span class=\"line\"><span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"新增ACL權限\"><a href=\"#新增ACL權限\" class=\"headerlink\" title=\"新增ACL權限\"></a>新增ACL權限</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  dbms_network_acl_admin.add_privilege (</span><br><span class=\"line\">  acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">  principal <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;User帳號&#x27;</span>,<span class=\"comment\">--改這</span></span><br><span class=\"line\">  is_grant <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"literal\">true</span>,</span><br><span class=\"line\">  privilege <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;connect&#x27;</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">commit</span>;</span><br><span class=\"line\">  <span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">dbms_network_acl_admin.add_privilege(</span><br><span class=\"line\">   acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">   principal <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;User帳號&#x27;</span>,<span class=\"comment\">--改這</span></span><br><span class=\"line\">   is_grant <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"literal\">TRUE</span>,</span><br><span class=\"line\">   privilege <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;resolve&#x27;</span></span><br><span class=\"line\">   ); </span><br><span class=\"line\">  <span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span> </span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"設定Email-ACL\"><a href=\"#設定Email-ACL\" class=\"headerlink\" title=\"設定Email-ACL\"></a>設定Email-ACL</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">    dbms_network_acl_admin.assign_acl(</span><br><span class=\"line\">    acl <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;mail_acl_file.xml&#x27;</span>,</span><br><span class=\"line\">    host <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;Mail IP&#x27;</span><span class=\"comment\">--改這</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;  </span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"相關SQL\"><a href=\"#相關SQL\" class=\"headerlink\" title=\"相關SQL\"></a>相關SQL</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> host, lower_port, upper_port, acl <span class=\"keyword\">FROM</span> dba_network_acls;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> acl,principal,privilege,is_grant,to_char(start_date, <span class=\"string\">&#x27;dd-mon-yyyy&#x27;</span>) <span class=\"keyword\">as</span> start_date,to_char(end_date, <span class=\"string\">&#x27;dd-mon-yyyy&#x27;</span>) <span class=\"keyword\">as</span> end_date </span><br><span class=\"line\"><span class=\"keyword\">from</span> dba_network_acl_privileges;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> any_path <span class=\"keyword\">from</span> resource_view <span class=\"keyword\">where</span> any_path <span class=\"keyword\">like</span> <span class=\"string\">&#x27;/sys/acls/%.xml&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"Schedule-Mail\"><a href=\"#Schedule-Mail\" class=\"headerlink\" title=\"Schedule Mail\"></a>Schedule Mail</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> DBA_SCHEDULER_GLOBAL_ATTRIBUTE;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">execute</span> DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE (<span class=\"string\">&#x27;EMAIL_SERVER&#x27;</span>,<span class=\"string\">&#x27; Mail_IP&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">execute</span> DBMS_SCHEDULER.SET_SCHEDULER_ATTRIBUTE (<span class=\"string\">&#x27;EMAIL_SENDER&#x27;</span>,<span class=\"string\">&#x27;寄件者Mail&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Mail-PROCEDURE\"><a href=\"#Mail-PROCEDURE\" class=\"headerlink\" title=\"Mail_PROCEDURE\"></a>Mail_PROCEDURE</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE OR REPLACE PROCEDURE DBA_MONITOR_SEND_MAIL (</span><br><span class=\"line\">   p_from          IN VARCHAR2,</span><br><span class=\"line\">   p_to            IN VARCHAR2,   </span><br><span class=\"line\">   p_cc            IN VARCHAR2 default null,</span><br><span class=\"line\">   p_bcc           IN VARCHAR2 default null,</span><br><span class=\"line\">   p_reply         IN VARCHAR2 default null,</span><br><span class=\"line\">   p_subject       IN VARCHAR2,   </span><br><span class=\"line\">   p_text          IN VARCHAR2 default null,</span><br><span class=\"line\">   p_html          in VARCHAR2 default null,</span><br><span class=\"line\">   p_smtp_hostname in varchar2,</span><br><span class=\"line\">   p_smtp_portnum  in number,</span><br><span class=\"line\">   p_domain        in varchar2 default null,</span><br><span class=\"line\">   p_login         in varchar2,</span><br><span class=\"line\">   p_pwd           in varchar2,</span><br><span class=\"line\">   p_html_body     in clob </span><br><span class=\"line\">   )</span><br><span class=\"line\">IS</span><br><span class=\"line\"> --宣告</span><br><span class=\"line\">  l_mail_conn   UTL_SMTP.connection;</span><br><span class=\"line\">  l_boundary    VARCHAR2(50) := &#x27;----=*#abc1234321cba#*=&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">BEGIN</span><br><span class=\"line\"> --設定伺服器</span><br><span class=\"line\">  l_mail_conn := UTL_SMTP.open_connection(p_smtp_hostname, p_smtp_portnum);</span><br><span class=\"line\">  --l_mail_conn := utl_smtp.open_connection(&#x27;1.1.1.1&#x27;, 25);</span><br><span class=\"line\">  UTL_SMTP.helo(l_mail_conn, p_smtp_hostname);</span><br><span class=\"line\"></span><br><span class=\"line\"> --寄件者</span><br><span class=\"line\">  UTL_SMTP.mail(l_mail_conn, p_from);</span><br><span class=\"line\"></span><br><span class=\"line\"> --收件者</span><br><span class=\"line\">  UTL_SMTP.rcpt(l_mail_conn,  p_to);</span><br><span class=\"line\">  if p_cc is not null then    </span><br><span class=\"line\">    UTL_SMTP.rcpt(l_mail_conn,  p_cc);      </span><br><span class=\"line\">  end if;</span><br><span class=\"line\">  UTL_SMTP.open_data(l_mail_conn);</span><br><span class=\"line\"></span><br><span class=\"line\"> -- 主旨</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;From: &#x27; || p_from || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;To: &#x27; || p_to || UTL_TCP.crlf);</span><br><span class=\"line\">  if p_cc is not null then    </span><br><span class=\"line\">    UTL_SMTP.write_data(l_mail_conn, &#x27;Cc: &#x27; || p_cc || UTL_TCP.crlf);  </span><br><span class=\"line\">  end if;</span><br><span class=\"line\">  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( &#x27;Subject: &#x27;|| p_subject || UTL_TCP.crlf));</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;MIME-Version: 1.0&#x27; || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;Content-Type: multipart/alternative; boundary=&quot;&#x27; || l_boundary || &#x27;&quot;&#x27; || UTL_TCP.crlf || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;--&#x27; || l_boundary || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;Content-Type: text/html; charset=utf-8/big5&#x27; || UTL_TCP.crlf || UTL_TCP.crlf);</span><br><span class=\"line\">  --utl_smtp.write_data( l_mail_conn, &#x27;Content-Transfer-Encoding: 8bit&#x27; || UTL_TCP.crlf );</span><br><span class=\"line\">  </span><br><span class=\"line\">  --UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw( p_html_body ));</span><br><span class=\"line\">  UTL_smtp.write_raw_data(l_mail_conn, utl_raw.cast_to_raw(CONVERT(dbms_lob.substr(p_html_body), &#x27;UTF8&#x27;)));</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, UTL_TCP.crlf || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.write_data(l_mail_conn, &#x27;--&#x27; || l_boundary || &#x27;--&#x27; || UTL_TCP.crlf);</span><br><span class=\"line\">  UTL_SMTP.close_data(l_mail_conn);</span><br><span class=\"line\">  UTL_SMTP.quit(l_mail_conn);</span><br><span class=\"line\">END;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"Windows-Script\"><a href=\"#Windows-Script\" class=\"headerlink\" title=\"Windows Script\"></a>Windows Script</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rem:</span><br><span class=\"line\">rem: WScript Send Mail</span><br><span class=\"line\">rem: cscript SendMail.vbs /P_From:From /P_To:To /P_Subject:Subject /P_TextBody:TextBody /P_File:File</span><br><span class=\"line\">/P_TextBody:TextBody_test /P_File:D:\\binhu_folder\\temp\\README-BR.txt</span><br><span class=\"line\">rem:</span><br><span class=\"line\"></span><br><span class=\"line\">SmtpName = <span class=\"string\">&quot;SMTP主機IP&quot;</span></span><br><span class=\"line\">Login = <span class=\"string\">&quot;Mail帳號&quot;</span></span><br><span class=\"line\">LoginPassword = <span class=\"string\">&quot;Mail密碼&quot;</span></span><br><span class=\"line\">Dim P_From</span><br><span class=\"line\">Dim P_To</span><br><span class=\"line\">Dim P_Subject</span><br><span class=\"line\">Dim P_TextBody</span><br><span class=\"line\">Dim P_File</span><br><span class=\"line\"></span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_From&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_To&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_Subject&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_TextBody&quot;</span>)</span><br><span class=\"line\">rem: WScript.Echo Wscript.Arguments.Named(<span class=\"string\">&quot;P_File&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">P_From=Wscript.Arguments.Named(<span class=\"string\">&quot;P_From&quot;</span>)</span><br><span class=\"line\">P_To=Wscript.Arguments.Named(<span class=\"string\">&quot;P_To&quot;</span>)</span><br><span class=\"line\">P_Subject=Wscript.Arguments.Named(<span class=\"string\">&quot;P_Subject&quot;</span>)</span><br><span class=\"line\">P_TextBody=Wscript.Arguments.Named(<span class=\"string\">&quot;P_TextBody&quot;</span>)</span><br><span class=\"line\">P_File=Wscript.Arguments.Named(<span class=\"string\">&quot;P_File&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Set objEmail = CreateObject(<span class=\"string\">&quot;CDO.Message&quot;</span>)</span><br><span class=\"line\">    objEmail.From = P_From</span><br><span class=\"line\">    objEmail.To = P_To</span><br><span class=\"line\">    objEmail.Subject = P_Subject</span><br><span class=\"line\">    objEmail.Textbody = P_TextBody</span><br><span class=\"line\">    Set objFSO = CreateObject(<span class=\"string\">&quot;Scripting.FileSystemObject&quot;</span>)</span><br><span class=\"line\">        IF objFSO.FileExists (P_File) <span class=\"keyword\">then</span></span><br><span class=\"line\">           objEmail.Addattachment P_File</span><br><span class=\"line\">           rem: WScript.<span class=\"built_in\">echo</span> <span class=\"string\">&quot;File Exist&quot;</span></span><br><span class=\"line\">        end <span class=\"keyword\">if</span> </span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/sendusing&quot;</span>) = 2</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/smtpserver&quot;</span>) = SmtpName</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/smtpserverport&quot;</span>) = 25</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/smtpauthenticate&quot;</span>) = 1</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/sendusername&quot;</span>) = Login</span><br><span class=\"line\">    objEmail.Configuration.Fields.Item (<span class=\"string\">&quot;http://schemas.microsoft.com/cdo/configuration/sendpassword&quot;</span>) = LoginPassword</span><br><span class=\"line\">    objEmail.Configuration.Fields.Update</span><br><span class=\"line\">    objEmail.Send</span><br><span class=\"line\"></span><br><span class=\"line\">Set objEmail = Nothing</span><br></pre></td></tr></table></figure>"},{"title":"Oracle-Broker","date":"2023-03-12T06:59:22.000Z","_content":"\n11g 刪除 broker 設定值\n\n<!--more-->\n\n\n\n1.設定dg_broker_start為false\n\n```sql\nalter system set dg_broker_start = FALSE ;\n```\n\n\n\n2.刪除dg_broker_config_file1/2\n\n> 刪除dg_broker_config_file1/2的檔案\n\n\n\n3.設定dg_broker_start為true\n\n```sql\nalter system set dg_broker_start = TRUE Scope=both;\n```\n\n\n\n4.重新配置broker\n\n> show configuration應該要會空才對\n","source":"_posts/Oracle-Broker.md","raw":"---\ntitle: Oracle-Broker\ndate: 2023-03-12 14:59:22\ntags:\n- Install\ncategories:\n- [Oracle]\n- [Oracle11g]\n---\n\n11g 刪除 broker 設定值\n\n<!--more-->\n\n\n\n1.設定dg_broker_start為false\n\n```sql\nalter system set dg_broker_start = FALSE ;\n```\n\n\n\n2.刪除dg_broker_config_file1/2\n\n> 刪除dg_broker_config_file1/2的檔案\n\n\n\n3.設定dg_broker_start為true\n\n```sql\nalter system set dg_broker_start = TRUE Scope=both;\n```\n\n\n\n4.重新配置broker\n\n> show configuration應該要會空才對\n","slug":"Oracle-Broker","published":1,"updated":"2023-03-12T07:05:12.670Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6m0006rcu3fk4h4wvt","content":"<p>11g 刪除 broker 設定值</p>\n<span id=\"more\"></span>\n\n\n\n<p>1.設定dg_broker_start為false</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">system</span> <span class=\"keyword\">set</span> dg_broker_start <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span> ;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>2.刪除dg_broker_config_file1/2</p>\n<blockquote>\n<p>刪除dg_broker_config_file1/2的檔案</p>\n</blockquote>\n<p>3.設定dg_broker_start為true</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">system</span> <span class=\"keyword\">set</span> dg_broker_start <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span> <span class=\"keyword\">Scope</span><span class=\"operator\">=</span><span class=\"keyword\">both</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>4.重新配置broker</p>\n<blockquote>\n<p>show configuration應該要會空才對</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>11g 刪除 broker 設定值</p>","more":"<p>1.設定dg_broker_start為false</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">system</span> <span class=\"keyword\">set</span> dg_broker_start <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span> ;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>2.刪除dg_broker_config_file1/2</p>\n<blockquote>\n<p>刪除dg_broker_config_file1/2的檔案</p>\n</blockquote>\n<p>3.設定dg_broker_start為true</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">alter</span> <span class=\"keyword\">system</span> <span class=\"keyword\">set</span> dg_broker_start <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span> <span class=\"keyword\">Scope</span><span class=\"operator\">=</span><span class=\"keyword\">both</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>4.重新配置broker</p>\n<blockquote>\n<p>show configuration應該要會空才對</p>\n</blockquote>"},{"title":"Oracle Check URL","date":"2023-02-11T15:00:10.000Z","_content":"\nOracle檢查URL範本\n\n<!--more-->\n\n## 基本範例\n\n```plsql\nCREATE OR REPLACE PROCEDURE DBA_Check_URL_Status(t_url in varchar2)\nIS\n  request UTL_HTTP.REQ;\n  response UTL_HTTP.RESP;\n  v_url varchar2(4000);\n  v_ck_txt varchar2(4000);\n  clob_buff CLOB;\n  buff VARCHAR2(4000);\n  v_seq number ;\n  V_MSG varchar2(4000);\n  V_USER_FROM varchar2(4000);  \n  c  utl_tcp.connection;  -- TCP/IP connection to the Web server\n  ret_val pls_integer;\n  v_temp varchar2 (1000);\nBEGIN\n  EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_LANGUAGE= ''AMERICAN''';\n  v_url := t_url;\n  v_ck_txt := null;\n  \n  if instr(lower(v_url),'https:') > 0 then\n    --處理HTTPS\n    select REGEXP_SUBSTR(REGEXP_REPLACE(v_url,'^http[s]?://','',1),'[a-z,A-Z,0-9,-]+(\\.\\w+)+') INTO v_temp from dual;\n    BEGIN\n       c := utl_tcp.open_connection(remote_host => v_temp,\n                                    remote_port =>  443,\n                                    tx_timeout => 5,\n                                    charset     => 'UTF-8');  -- open connection\n       ret_val := utl_tcp.write_line(c, 'GET / HTTP/1.1');    -- send HTTP request\n       ret_val := utl_tcp.write_line(c);\n       BEGIN\n         LOOP\n           dbms_output.put_line(utl_tcp.get_line(c, TRUE));  -- read result\n         END LOOP;\n       EXCEPTION\n         WHEN utl_tcp.end_of_input THEN\n           dbms_output.put_line('Check_SSL_URL_OK End');  -- read result\n       END;\n       utl_tcp.close_connection(c);\n    EXCEPTION\n      WHEN OTHERS THEN\n        --記錄錯誤和簡訊通知\n    END;\n  else\n    BEGIN  \n      --處理HTTP\n      UTL_HTTP.SET_RESPONSE_ERROR_CHECK(FALSE);\n      request := UTL_HTTP.BEGIN_REQUEST(v_url, 'GET');\n      UTL_HTTP.SET_HEADER(request, 'User-Agent', 'Mozilla/4.0');\n      response := UTL_HTTP.GET_RESPONSE(request);\n      DBMS_OUTPUT.PUT_LINE('HTTP response status code: ' || response.status_code);\n      \n      IF response.status_code = 200 THEN\n            BEGIN\n                clob_buff := EMPTY_CLOB;\n                LOOP\n                    UTL_HTTP.READ_TEXT(response, buff, LENGTH(buff));\n                    clob_buff := clob_buff || buff;\n                END LOOP;\n                UTL_HTTP.END_RESPONSE(response);\n            EXCEPTION\n                WHEN UTL_HTTP.END_OF_BODY THEN\n                        UTL_HTTP.END_RESPONSE(response);\n                WHEN OTHERS THEN\n                  --記錄錯誤和簡訊通知\n             END;\n            --DBMS_OUTPUT.PUT_LINE(clob_buff);\n            v_ck_txt := substr(clob_buff,1,2000);\n            v_ck_txt := trim(v_ck_txt);\n            \n            IF instr(v_ck_txt,'ORA-') > 0  THEN\n               --記錄錯誤和簡訊通知\n            elsif length(v_ck_txt)=1 and v_ck_txt||''='1' then\n               --判讀回傳特定值就視為正確\n            else\n              --記錄錯誤和簡訊通知\n            END IF;\n      ELSE\n         --記錄錯誤和簡訊通知\n         UTL_HTTP.END_RESPONSE(response);\n      END IF;\n      \n    EXCEPTION\n        WHEN Utl_Http.request_failed THEN\n        v_ck_txt := substr(Utl_Http.get_detailed_sqlerrm,1,100);\n        --記錄錯誤和簡訊通知\n    END;\n   end if;                           \nEND;\n/\n```\n\n","source":"_posts/Oracle-Check-URL.md","raw":"---\ntitle: Oracle Check URL\ndate: 2023-02-11 23:00:10\ntags:\n- [Script]\ncategories:\n- [Oracle]\n---\n\nOracle檢查URL範本\n\n<!--more-->\n\n## 基本範例\n\n```plsql\nCREATE OR REPLACE PROCEDURE DBA_Check_URL_Status(t_url in varchar2)\nIS\n  request UTL_HTTP.REQ;\n  response UTL_HTTP.RESP;\n  v_url varchar2(4000);\n  v_ck_txt varchar2(4000);\n  clob_buff CLOB;\n  buff VARCHAR2(4000);\n  v_seq number ;\n  V_MSG varchar2(4000);\n  V_USER_FROM varchar2(4000);  \n  c  utl_tcp.connection;  -- TCP/IP connection to the Web server\n  ret_val pls_integer;\n  v_temp varchar2 (1000);\nBEGIN\n  EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_LANGUAGE= ''AMERICAN''';\n  v_url := t_url;\n  v_ck_txt := null;\n  \n  if instr(lower(v_url),'https:') > 0 then\n    --處理HTTPS\n    select REGEXP_SUBSTR(REGEXP_REPLACE(v_url,'^http[s]?://','',1),'[a-z,A-Z,0-9,-]+(\\.\\w+)+') INTO v_temp from dual;\n    BEGIN\n       c := utl_tcp.open_connection(remote_host => v_temp,\n                                    remote_port =>  443,\n                                    tx_timeout => 5,\n                                    charset     => 'UTF-8');  -- open connection\n       ret_val := utl_tcp.write_line(c, 'GET / HTTP/1.1');    -- send HTTP request\n       ret_val := utl_tcp.write_line(c);\n       BEGIN\n         LOOP\n           dbms_output.put_line(utl_tcp.get_line(c, TRUE));  -- read result\n         END LOOP;\n       EXCEPTION\n         WHEN utl_tcp.end_of_input THEN\n           dbms_output.put_line('Check_SSL_URL_OK End');  -- read result\n       END;\n       utl_tcp.close_connection(c);\n    EXCEPTION\n      WHEN OTHERS THEN\n        --記錄錯誤和簡訊通知\n    END;\n  else\n    BEGIN  \n      --處理HTTP\n      UTL_HTTP.SET_RESPONSE_ERROR_CHECK(FALSE);\n      request := UTL_HTTP.BEGIN_REQUEST(v_url, 'GET');\n      UTL_HTTP.SET_HEADER(request, 'User-Agent', 'Mozilla/4.0');\n      response := UTL_HTTP.GET_RESPONSE(request);\n      DBMS_OUTPUT.PUT_LINE('HTTP response status code: ' || response.status_code);\n      \n      IF response.status_code = 200 THEN\n            BEGIN\n                clob_buff := EMPTY_CLOB;\n                LOOP\n                    UTL_HTTP.READ_TEXT(response, buff, LENGTH(buff));\n                    clob_buff := clob_buff || buff;\n                END LOOP;\n                UTL_HTTP.END_RESPONSE(response);\n            EXCEPTION\n                WHEN UTL_HTTP.END_OF_BODY THEN\n                        UTL_HTTP.END_RESPONSE(response);\n                WHEN OTHERS THEN\n                  --記錄錯誤和簡訊通知\n             END;\n            --DBMS_OUTPUT.PUT_LINE(clob_buff);\n            v_ck_txt := substr(clob_buff,1,2000);\n            v_ck_txt := trim(v_ck_txt);\n            \n            IF instr(v_ck_txt,'ORA-') > 0  THEN\n               --記錄錯誤和簡訊通知\n            elsif length(v_ck_txt)=1 and v_ck_txt||''='1' then\n               --判讀回傳特定值就視為正確\n            else\n              --記錄錯誤和簡訊通知\n            END IF;\n      ELSE\n         --記錄錯誤和簡訊通知\n         UTL_HTTP.END_RESPONSE(response);\n      END IF;\n      \n    EXCEPTION\n        WHEN Utl_Http.request_failed THEN\n        v_ck_txt := substr(Utl_Http.get_detailed_sqlerrm,1,100);\n        --記錄錯誤和簡訊通知\n    END;\n   end if;                           \nEND;\n/\n```\n\n","slug":"Oracle-Check-URL","published":1,"updated":"2023-03-12T07:05:53.392Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6o0008rcu3bwflecbj","content":"<p>Oracle檢查URL範本</p>\n<span id=\"more\"></span>\n\n<h2 id=\"基本範例\"><a href=\"#基本範例\" class=\"headerlink\" title=\"基本範例\"></a>基本範例</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE OR REPLACE PROCEDURE DBA_Check_URL_Status(t_url in varchar2)</span><br><span class=\"line\">IS</span><br><span class=\"line\">  request UTL_HTTP.REQ;</span><br><span class=\"line\">  response UTL_HTTP.RESP;</span><br><span class=\"line\">  v_url varchar2(4000);</span><br><span class=\"line\">  v_ck_txt varchar2(4000);</span><br><span class=\"line\">  clob_buff CLOB;</span><br><span class=\"line\">  buff VARCHAR2(4000);</span><br><span class=\"line\">  v_seq number ;</span><br><span class=\"line\">  V_MSG varchar2(4000);</span><br><span class=\"line\">  V_USER_FROM varchar2(4000);  </span><br><span class=\"line\">  c  utl_tcp.connection;  -- TCP/IP connection to the Web server</span><br><span class=\"line\">  ret_val pls_integer;</span><br><span class=\"line\">  v_temp varchar2 (1000);</span><br><span class=\"line\">BEGIN</span><br><span class=\"line\">  EXECUTE IMMEDIATE &#x27;ALTER SESSION SET NLS_LANGUAGE= &#x27;&#x27;AMERICAN&#x27;&#x27;&#x27;;</span><br><span class=\"line\">  v_url := t_url;</span><br><span class=\"line\">  v_ck_txt := null;</span><br><span class=\"line\">  </span><br><span class=\"line\">  if instr(lower(v_url),&#x27;https:&#x27;) &gt; 0 then</span><br><span class=\"line\">    --處理HTTPS</span><br><span class=\"line\">    select REGEXP_SUBSTR(REGEXP_REPLACE(v_url,&#x27;^http[s]?://&#x27;,&#x27;&#x27;,1),&#x27;[a-z,A-Z,0-9,-]+(\\.\\w+)+&#x27;) INTO v_temp from dual;</span><br><span class=\"line\">    BEGIN</span><br><span class=\"line\">       c := utl_tcp.open_connection(remote_host =&gt; v_temp,</span><br><span class=\"line\">                                    remote_port =&gt;  443,</span><br><span class=\"line\">                                    tx_timeout =&gt; 5,</span><br><span class=\"line\">                                    charset     =&gt; &#x27;UTF-8&#x27;);  -- open connection</span><br><span class=\"line\">       ret_val := utl_tcp.write_line(c, &#x27;GET / HTTP/1.1&#x27;);    -- send HTTP request</span><br><span class=\"line\">       ret_val := utl_tcp.write_line(c);</span><br><span class=\"line\">       BEGIN</span><br><span class=\"line\">         LOOP</span><br><span class=\"line\">           dbms_output.put_line(utl_tcp.get_line(c, TRUE));  -- read result</span><br><span class=\"line\">         END LOOP;</span><br><span class=\"line\">       EXCEPTION</span><br><span class=\"line\">         WHEN utl_tcp.end_of_input THEN</span><br><span class=\"line\">           dbms_output.put_line(&#x27;Check_SSL_URL_OK End&#x27;);  -- read result</span><br><span class=\"line\">       END;</span><br><span class=\"line\">       utl_tcp.close_connection(c);</span><br><span class=\"line\">    EXCEPTION</span><br><span class=\"line\">      WHEN OTHERS THEN</span><br><span class=\"line\">        --記錄錯誤和簡訊通知</span><br><span class=\"line\">    END;</span><br><span class=\"line\">  else</span><br><span class=\"line\">    BEGIN  </span><br><span class=\"line\">      --處理HTTP</span><br><span class=\"line\">      UTL_HTTP.SET_RESPONSE_ERROR_CHECK(FALSE);</span><br><span class=\"line\">      request := UTL_HTTP.BEGIN_REQUEST(v_url, &#x27;GET&#x27;);</span><br><span class=\"line\">      UTL_HTTP.SET_HEADER(request, &#x27;User-Agent&#x27;, &#x27;Mozilla/4.0&#x27;);</span><br><span class=\"line\">      response := UTL_HTTP.GET_RESPONSE(request);</span><br><span class=\"line\">      DBMS_OUTPUT.PUT_LINE(&#x27;HTTP response status code: &#x27; || response.status_code);</span><br><span class=\"line\">      </span><br><span class=\"line\">      IF response.status_code = 200 THEN</span><br><span class=\"line\">            BEGIN</span><br><span class=\"line\">                clob_buff := EMPTY_CLOB;</span><br><span class=\"line\">                LOOP</span><br><span class=\"line\">                    UTL_HTTP.READ_TEXT(response, buff, LENGTH(buff));</span><br><span class=\"line\">                    clob_buff := clob_buff || buff;</span><br><span class=\"line\">                END LOOP;</span><br><span class=\"line\">                UTL_HTTP.END_RESPONSE(response);</span><br><span class=\"line\">            EXCEPTION</span><br><span class=\"line\">                WHEN UTL_HTTP.END_OF_BODY THEN</span><br><span class=\"line\">                        UTL_HTTP.END_RESPONSE(response);</span><br><span class=\"line\">                WHEN OTHERS THEN</span><br><span class=\"line\">                  --記錄錯誤和簡訊通知</span><br><span class=\"line\">             END;</span><br><span class=\"line\">            --DBMS_OUTPUT.PUT_LINE(clob_buff);</span><br><span class=\"line\">            v_ck_txt := substr(clob_buff,1,2000);</span><br><span class=\"line\">            v_ck_txt := trim(v_ck_txt);</span><br><span class=\"line\">            </span><br><span class=\"line\">            IF instr(v_ck_txt,&#x27;ORA-&#x27;) &gt; 0  THEN</span><br><span class=\"line\">               --記錄錯誤和簡訊通知</span><br><span class=\"line\">            elsif length(v_ck_txt)=1 and v_ck_txt||&#x27;&#x27;=&#x27;1&#x27; then</span><br><span class=\"line\">               --判讀回傳特定值就視為正確</span><br><span class=\"line\">            else</span><br><span class=\"line\">              --記錄錯誤和簡訊通知</span><br><span class=\"line\">            END IF;</span><br><span class=\"line\">      ELSE</span><br><span class=\"line\">         --記錄錯誤和簡訊通知</span><br><span class=\"line\">         UTL_HTTP.END_RESPONSE(response);</span><br><span class=\"line\">      END IF;</span><br><span class=\"line\">      </span><br><span class=\"line\">    EXCEPTION</span><br><span class=\"line\">        WHEN Utl_Http.request_failed THEN</span><br><span class=\"line\">        v_ck_txt := substr(Utl_Http.get_detailed_sqlerrm,1,100);</span><br><span class=\"line\">        --記錄錯誤和簡訊通知</span><br><span class=\"line\">    END;</span><br><span class=\"line\">   end if;                           </span><br><span class=\"line\">END;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>Oracle檢查URL範本</p>","more":"<h2 id=\"基本範例\"><a href=\"#基本範例\" class=\"headerlink\" title=\"基本範例\"></a>基本範例</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE OR REPLACE PROCEDURE DBA_Check_URL_Status(t_url in varchar2)</span><br><span class=\"line\">IS</span><br><span class=\"line\">  request UTL_HTTP.REQ;</span><br><span class=\"line\">  response UTL_HTTP.RESP;</span><br><span class=\"line\">  v_url varchar2(4000);</span><br><span class=\"line\">  v_ck_txt varchar2(4000);</span><br><span class=\"line\">  clob_buff CLOB;</span><br><span class=\"line\">  buff VARCHAR2(4000);</span><br><span class=\"line\">  v_seq number ;</span><br><span class=\"line\">  V_MSG varchar2(4000);</span><br><span class=\"line\">  V_USER_FROM varchar2(4000);  </span><br><span class=\"line\">  c  utl_tcp.connection;  -- TCP/IP connection to the Web server</span><br><span class=\"line\">  ret_val pls_integer;</span><br><span class=\"line\">  v_temp varchar2 (1000);</span><br><span class=\"line\">BEGIN</span><br><span class=\"line\">  EXECUTE IMMEDIATE &#x27;ALTER SESSION SET NLS_LANGUAGE= &#x27;&#x27;AMERICAN&#x27;&#x27;&#x27;;</span><br><span class=\"line\">  v_url := t_url;</span><br><span class=\"line\">  v_ck_txt := null;</span><br><span class=\"line\">  </span><br><span class=\"line\">  if instr(lower(v_url),&#x27;https:&#x27;) &gt; 0 then</span><br><span class=\"line\">    --處理HTTPS</span><br><span class=\"line\">    select REGEXP_SUBSTR(REGEXP_REPLACE(v_url,&#x27;^http[s]?://&#x27;,&#x27;&#x27;,1),&#x27;[a-z,A-Z,0-9,-]+(\\.\\w+)+&#x27;) INTO v_temp from dual;</span><br><span class=\"line\">    BEGIN</span><br><span class=\"line\">       c := utl_tcp.open_connection(remote_host =&gt; v_temp,</span><br><span class=\"line\">                                    remote_port =&gt;  443,</span><br><span class=\"line\">                                    tx_timeout =&gt; 5,</span><br><span class=\"line\">                                    charset     =&gt; &#x27;UTF-8&#x27;);  -- open connection</span><br><span class=\"line\">       ret_val := utl_tcp.write_line(c, &#x27;GET / HTTP/1.1&#x27;);    -- send HTTP request</span><br><span class=\"line\">       ret_val := utl_tcp.write_line(c);</span><br><span class=\"line\">       BEGIN</span><br><span class=\"line\">         LOOP</span><br><span class=\"line\">           dbms_output.put_line(utl_tcp.get_line(c, TRUE));  -- read result</span><br><span class=\"line\">         END LOOP;</span><br><span class=\"line\">       EXCEPTION</span><br><span class=\"line\">         WHEN utl_tcp.end_of_input THEN</span><br><span class=\"line\">           dbms_output.put_line(&#x27;Check_SSL_URL_OK End&#x27;);  -- read result</span><br><span class=\"line\">       END;</span><br><span class=\"line\">       utl_tcp.close_connection(c);</span><br><span class=\"line\">    EXCEPTION</span><br><span class=\"line\">      WHEN OTHERS THEN</span><br><span class=\"line\">        --記錄錯誤和簡訊通知</span><br><span class=\"line\">    END;</span><br><span class=\"line\">  else</span><br><span class=\"line\">    BEGIN  </span><br><span class=\"line\">      --處理HTTP</span><br><span class=\"line\">      UTL_HTTP.SET_RESPONSE_ERROR_CHECK(FALSE);</span><br><span class=\"line\">      request := UTL_HTTP.BEGIN_REQUEST(v_url, &#x27;GET&#x27;);</span><br><span class=\"line\">      UTL_HTTP.SET_HEADER(request, &#x27;User-Agent&#x27;, &#x27;Mozilla/4.0&#x27;);</span><br><span class=\"line\">      response := UTL_HTTP.GET_RESPONSE(request);</span><br><span class=\"line\">      DBMS_OUTPUT.PUT_LINE(&#x27;HTTP response status code: &#x27; || response.status_code);</span><br><span class=\"line\">      </span><br><span class=\"line\">      IF response.status_code = 200 THEN</span><br><span class=\"line\">            BEGIN</span><br><span class=\"line\">                clob_buff := EMPTY_CLOB;</span><br><span class=\"line\">                LOOP</span><br><span class=\"line\">                    UTL_HTTP.READ_TEXT(response, buff, LENGTH(buff));</span><br><span class=\"line\">                    clob_buff := clob_buff || buff;</span><br><span class=\"line\">                END LOOP;</span><br><span class=\"line\">                UTL_HTTP.END_RESPONSE(response);</span><br><span class=\"line\">            EXCEPTION</span><br><span class=\"line\">                WHEN UTL_HTTP.END_OF_BODY THEN</span><br><span class=\"line\">                        UTL_HTTP.END_RESPONSE(response);</span><br><span class=\"line\">                WHEN OTHERS THEN</span><br><span class=\"line\">                  --記錄錯誤和簡訊通知</span><br><span class=\"line\">             END;</span><br><span class=\"line\">            --DBMS_OUTPUT.PUT_LINE(clob_buff);</span><br><span class=\"line\">            v_ck_txt := substr(clob_buff,1,2000);</span><br><span class=\"line\">            v_ck_txt := trim(v_ck_txt);</span><br><span class=\"line\">            </span><br><span class=\"line\">            IF instr(v_ck_txt,&#x27;ORA-&#x27;) &gt; 0  THEN</span><br><span class=\"line\">               --記錄錯誤和簡訊通知</span><br><span class=\"line\">            elsif length(v_ck_txt)=1 and v_ck_txt||&#x27;&#x27;=&#x27;1&#x27; then</span><br><span class=\"line\">               --判讀回傳特定值就視為正確</span><br><span class=\"line\">            else</span><br><span class=\"line\">              --記錄錯誤和簡訊通知</span><br><span class=\"line\">            END IF;</span><br><span class=\"line\">      ELSE</span><br><span class=\"line\">         --記錄錯誤和簡訊通知</span><br><span class=\"line\">         UTL_HTTP.END_RESPONSE(response);</span><br><span class=\"line\">      END IF;</span><br><span class=\"line\">      </span><br><span class=\"line\">    EXCEPTION</span><br><span class=\"line\">        WHEN Utl_Http.request_failed THEN</span><br><span class=\"line\">        v_ck_txt := substr(Utl_Http.get_detailed_sqlerrm,1,100);</span><br><span class=\"line\">        --記錄錯誤和簡訊通知</span><br><span class=\"line\">    END;</span><br><span class=\"line\">   end if;                           </span><br><span class=\"line\">END;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>"},{"title":"Oracle_DW","date":"2023-02-18T12:48:52.000Z","_content":"\nData Warehouse 大資料匯入的優化手段\n\n<!--more-->\n\n## external table 截入cvs和dmp\n\n```sql\nCREATE TABLE emp_ext (\n  id NUMBER(4),\n  addr VARCHAR2(10),\n  ctime DATE\n)\nORGANIZATION EXTERNAL (\n  TYPE CSV\n  DEFAULT DIRECTORY data_dir\n  LOCATION ('test.csv')\n)\nREJECT LIMIT UNLIMITED;\n```\n\n\n\n```sql\n--產生dmp File\nCREATE TABLE emptest_ext (\n  id NUMBER(4),\n  addr VARCHAR2(10),\n  ctime DATE\n)\nORGANIZATION EXTERNAL (\n  TYPE ORACLE_DATAPUMP\n  DEFAULT DIRECTORY dump_dir\n  LOCATION ('emptest.dmp')\n)\nPARALLEL 4\nREJECT LIMIT UNLIMITED;\n\nINSERT INTO emptest_ext SELECT * FROM emptest;\n\n--戴入 emp_ext\nCREATE TABLE emp_ext (\n  id NUMBER(4),\n  addr VARCHAR2(10),\n  ctime DATE\n)\nORGANIZATION EXTERNAL (\n  TYPE ORACLE_DATAPUMP\n  DEFAULT DIRECTORY data_dir\n  LOCATION ('emptest.dmp')\n)\nREJECT LIMIT UNLIMITED;\n```\n\n> 適合資料量很大，並且都是Full Table Scan處理的情境，要留意是無法建立index\n\n\n\n------\n\n\n\n## DBMS_DATAPUMP\n\n```sql\nDECLARE\n   v_handle     NUMBER;\n   v_status     VARCHAR2(20);\nBEGIN\n   v_handle := DBMS_DATAPUMP.OPEN(\n                  operation   => 'EXPORT',\n                  job_mode    => 'TABLE',\n                  remote_link => 'DBLINK_NAME'\n               );\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'EXPORT_DIR:table_export.dmp',\n      directory => 'EXPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'EXPORT_DIR:table_export.log',\n      directory => 'EXPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);\n\n   DBMS_DATAPUMP.METADATA_FILTER(\n      handle => v_handle,\n      name   => 'SCHEMA_EXPR',\n      value  => 'IN(''SCHEMA_NAME'')');\n\n   DBMS_DATAPUMP.START_JOB(handle => v_handle);\n\n   DBMS_DATAPUMP.WAIT_FOR_JOB(handle => v_handle, job_state => v_status);\n\n   DBMS_DATAPUMP.DETACH(handle => v_handle);\nEND;\n/\n```\n\n\n\n```sql\nDECLARE\n   v_handle     NUMBER;\n   v_status     VARCHAR2(20);\nBEGIN\n   v_handle := DBMS_DATAPUMP.OPEN(\n                  operation   => 'IMPORT',\n                  job_mode    => 'TABLE',\n                  remote_link => 'DBLINK_NAME'\n               );\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'IMPORT_DIR:table_export.dmp',\n      directory => 'IMPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'IMPORT_DIR:table_export.log',\n      directory => 'IMPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);\n\n   DBMS_DATAPUMP.METADATA_REMAP(\n      handle     => v_handle,\n      name       => 'REMAP_SCHEMA',\n      old_value  => 'OLD_SCHEMA_NAME',\n      new_value  => 'NEW_SCHEMA_NAME');\n\n   DBMS_DATAPUMP.START_JOB(handle => v_handle);\n\n   DBMS_DATAPUMP.WAIT_FOR_JOB(handle => v_handle, job_state => v_status);\n\n   DBMS_DATAPUMP.DETACH(handle => v_handle);\nEND;\n/\n```\n\n> 使用DBMS的方式不落地用expdp和impdp，一直在db裏完成，不需要進行os操作\n\n\n\n------\n\n\n\n## Hint -- insert direct path\n\n> INSERT /*+ APPEND */ 避開Buufer，直寫入DataFile，但要留意index會導致失效\n\n\n\n------\n\n\n\n## Partition Table \n\n```\nCREATE TABLE emp (\n  id     NUMBER,\n  t_date   DATE,\n  amount   NUMBER\n)\nPARTITION BY RANGE(t_date)\nINTERVAL(NUMTOYMINTERVAL(1, 'MONTH'))\n(\n  PARTITION p1 VALUES LESS THAN (TO_DATE('2022-01-01', 'YYYY-MM-DD'))\n);\n```\n\n自動增加Partition\n\n```\nALTER TABLE emp ENABLE ROW MOVEMENT;  --一定要\nEXEC DBMS_PART_ADMIN.ENABLE_AUTO_PARTITIONING( \n  table_name  => 'emp',\n  interval    => 'INTERVAL(NUMTOYMINTERVAL(1, ''MONTH''))',\n  start_date  => '2022-01-01',\n  retention   => 'INTERVAL ''1'' MONTH' --個為間隔單位\n);\n```\n\n自動刪除舊的Partition (19c可以用，較舊的版本要測一下)\n\n```\nBEGIN\n  DBMS_PART_ADMIN.ALTER_RETENTION(\n    table_name  => 'emp',\n    retention   => 'INTERVAL ''1'' MONTH'\n  );\nEND;\n/\n```\n\n### 針對Index再優化\n\nPartial Indexes\n\n```sql\nCREATE INDEX idx_emp_partial\nON emp(t_date)\nWHERE t_date >= '2022-01-01';\n-- index的資料只包含 2022-01-01之後的，之前的資料並不包含到index裏，可縮小index size\n```\n\nindex生效的方式\n\n```sql\nSELECT *\nFROM t_date\nWHERE t_date >= '2022-02-01' and t_date <= '2022-04-01'\n```\n\n> 刪除和新增資料佔用I/O的時間錯開\n\n\n\n------\n\n\n\n## 換別的OLAP DB\n\n> 考量用apache doris、clickhouse，要考量是否能維運\n\n\n\n------\n\n\n\n## 結論\n\n> 1.首選先考慮升級成SSD\n>\n> 2.了解AP邏輯運作後再看有多少空檔時間可做維護，再選擇方案\n\n","source":"_posts/Oracle-DW.md","raw":"---\ntitle: Oracle_DW\ndate: 2023-02-18 20:48:52\ntags:\n- [PerformanceTuning]\ncategories:\n- [Oracle]\n---\n\nData Warehouse 大資料匯入的優化手段\n\n<!--more-->\n\n## external table 截入cvs和dmp\n\n```sql\nCREATE TABLE emp_ext (\n  id NUMBER(4),\n  addr VARCHAR2(10),\n  ctime DATE\n)\nORGANIZATION EXTERNAL (\n  TYPE CSV\n  DEFAULT DIRECTORY data_dir\n  LOCATION ('test.csv')\n)\nREJECT LIMIT UNLIMITED;\n```\n\n\n\n```sql\n--產生dmp File\nCREATE TABLE emptest_ext (\n  id NUMBER(4),\n  addr VARCHAR2(10),\n  ctime DATE\n)\nORGANIZATION EXTERNAL (\n  TYPE ORACLE_DATAPUMP\n  DEFAULT DIRECTORY dump_dir\n  LOCATION ('emptest.dmp')\n)\nPARALLEL 4\nREJECT LIMIT UNLIMITED;\n\nINSERT INTO emptest_ext SELECT * FROM emptest;\n\n--戴入 emp_ext\nCREATE TABLE emp_ext (\n  id NUMBER(4),\n  addr VARCHAR2(10),\n  ctime DATE\n)\nORGANIZATION EXTERNAL (\n  TYPE ORACLE_DATAPUMP\n  DEFAULT DIRECTORY data_dir\n  LOCATION ('emptest.dmp')\n)\nREJECT LIMIT UNLIMITED;\n```\n\n> 適合資料量很大，並且都是Full Table Scan處理的情境，要留意是無法建立index\n\n\n\n------\n\n\n\n## DBMS_DATAPUMP\n\n```sql\nDECLARE\n   v_handle     NUMBER;\n   v_status     VARCHAR2(20);\nBEGIN\n   v_handle := DBMS_DATAPUMP.OPEN(\n                  operation   => 'EXPORT',\n                  job_mode    => 'TABLE',\n                  remote_link => 'DBLINK_NAME'\n               );\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'EXPORT_DIR:table_export.dmp',\n      directory => 'EXPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'EXPORT_DIR:table_export.log',\n      directory => 'EXPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);\n\n   DBMS_DATAPUMP.METADATA_FILTER(\n      handle => v_handle,\n      name   => 'SCHEMA_EXPR',\n      value  => 'IN(''SCHEMA_NAME'')');\n\n   DBMS_DATAPUMP.START_JOB(handle => v_handle);\n\n   DBMS_DATAPUMP.WAIT_FOR_JOB(handle => v_handle, job_state => v_status);\n\n   DBMS_DATAPUMP.DETACH(handle => v_handle);\nEND;\n/\n```\n\n\n\n```sql\nDECLARE\n   v_handle     NUMBER;\n   v_status     VARCHAR2(20);\nBEGIN\n   v_handle := DBMS_DATAPUMP.OPEN(\n                  operation   => 'IMPORT',\n                  job_mode    => 'TABLE',\n                  remote_link => 'DBLINK_NAME'\n               );\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'IMPORT_DIR:table_export.dmp',\n      directory => 'IMPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);\n\n   DBMS_DATAPUMP.ADD_FILE(\n      handle  => v_handle,\n      filename=> 'IMPORT_DIR:table_export.log',\n      directory => 'IMPORT_DIR',\n      filetype => DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);\n\n   DBMS_DATAPUMP.METADATA_REMAP(\n      handle     => v_handle,\n      name       => 'REMAP_SCHEMA',\n      old_value  => 'OLD_SCHEMA_NAME',\n      new_value  => 'NEW_SCHEMA_NAME');\n\n   DBMS_DATAPUMP.START_JOB(handle => v_handle);\n\n   DBMS_DATAPUMP.WAIT_FOR_JOB(handle => v_handle, job_state => v_status);\n\n   DBMS_DATAPUMP.DETACH(handle => v_handle);\nEND;\n/\n```\n\n> 使用DBMS的方式不落地用expdp和impdp，一直在db裏完成，不需要進行os操作\n\n\n\n------\n\n\n\n## Hint -- insert direct path\n\n> INSERT /*+ APPEND */ 避開Buufer，直寫入DataFile，但要留意index會導致失效\n\n\n\n------\n\n\n\n## Partition Table \n\n```\nCREATE TABLE emp (\n  id     NUMBER,\n  t_date   DATE,\n  amount   NUMBER\n)\nPARTITION BY RANGE(t_date)\nINTERVAL(NUMTOYMINTERVAL(1, 'MONTH'))\n(\n  PARTITION p1 VALUES LESS THAN (TO_DATE('2022-01-01', 'YYYY-MM-DD'))\n);\n```\n\n自動增加Partition\n\n```\nALTER TABLE emp ENABLE ROW MOVEMENT;  --一定要\nEXEC DBMS_PART_ADMIN.ENABLE_AUTO_PARTITIONING( \n  table_name  => 'emp',\n  interval    => 'INTERVAL(NUMTOYMINTERVAL(1, ''MONTH''))',\n  start_date  => '2022-01-01',\n  retention   => 'INTERVAL ''1'' MONTH' --個為間隔單位\n);\n```\n\n自動刪除舊的Partition (19c可以用，較舊的版本要測一下)\n\n```\nBEGIN\n  DBMS_PART_ADMIN.ALTER_RETENTION(\n    table_name  => 'emp',\n    retention   => 'INTERVAL ''1'' MONTH'\n  );\nEND;\n/\n```\n\n### 針對Index再優化\n\nPartial Indexes\n\n```sql\nCREATE INDEX idx_emp_partial\nON emp(t_date)\nWHERE t_date >= '2022-01-01';\n-- index的資料只包含 2022-01-01之後的，之前的資料並不包含到index裏，可縮小index size\n```\n\nindex生效的方式\n\n```sql\nSELECT *\nFROM t_date\nWHERE t_date >= '2022-02-01' and t_date <= '2022-04-01'\n```\n\n> 刪除和新增資料佔用I/O的時間錯開\n\n\n\n------\n\n\n\n## 換別的OLAP DB\n\n> 考量用apache doris、clickhouse，要考量是否能維運\n\n\n\n------\n\n\n\n## 結論\n\n> 1.首選先考慮升級成SSD\n>\n> 2.了解AP邏輯運作後再看有多少空檔時間可做維護，再選擇方案\n\n","slug":"Oracle-DW","published":1,"updated":"2023-02-19T14:29:48.996Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6o0009rcu3fn133ppw","content":"<p>Data Warehouse 大資料匯入的優化手段</p>\n<span id=\"more\"></span>\n\n<h2 id=\"external-table-截入cvs和dmp\"><a href=\"#external-table-截入cvs和dmp\" class=\"headerlink\" title=\"external table 截入cvs和dmp\"></a>external table 截入cvs和dmp</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> emp_ext (</span><br><span class=\"line\">  id NUMBER(<span class=\"number\">4</span>),</span><br><span class=\"line\">  addr VARCHAR2(<span class=\"number\">10</span>),</span><br><span class=\"line\">  ctime <span class=\"type\">DATE</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ORGANIZATION <span class=\"keyword\">EXTERNAL</span> (</span><br><span class=\"line\">  TYPE CSV</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> DIRECTORY data_dir</span><br><span class=\"line\">  LOCATION (<span class=\"string\">&#x27;test.csv&#x27;</span>)</span><br><span class=\"line\">)</span><br><span class=\"line\">REJECT LIMIT UNLIMITED;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--產生dmp File</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> emptest_ext (</span><br><span class=\"line\">  id NUMBER(<span class=\"number\">4</span>),</span><br><span class=\"line\">  addr VARCHAR2(<span class=\"number\">10</span>),</span><br><span class=\"line\">  ctime <span class=\"type\">DATE</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ORGANIZATION <span class=\"keyword\">EXTERNAL</span> (</span><br><span class=\"line\">  TYPE ORACLE_DATAPUMP</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> DIRECTORY dump_dir</span><br><span class=\"line\">  LOCATION (<span class=\"string\">&#x27;emptest.dmp&#x27;</span>)</span><br><span class=\"line\">)</span><br><span class=\"line\">PARALLEL <span class=\"number\">4</span></span><br><span class=\"line\">REJECT LIMIT UNLIMITED;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> emptest_ext <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emptest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--戴入 emp_ext</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> emp_ext (</span><br><span class=\"line\">  id NUMBER(<span class=\"number\">4</span>),</span><br><span class=\"line\">  addr VARCHAR2(<span class=\"number\">10</span>),</span><br><span class=\"line\">  ctime <span class=\"type\">DATE</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ORGANIZATION <span class=\"keyword\">EXTERNAL</span> (</span><br><span class=\"line\">  TYPE ORACLE_DATAPUMP</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> DIRECTORY data_dir</span><br><span class=\"line\">  LOCATION (<span class=\"string\">&#x27;emptest.dmp&#x27;</span>)</span><br><span class=\"line\">)</span><br><span class=\"line\">REJECT LIMIT UNLIMITED;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>適合資料量很大，並且都是Full Table Scan處理的情境，要留意是無法建立index</p>\n</blockquote>\n<hr>\n<h2 id=\"DBMS-DATAPUMP\"><a href=\"#DBMS-DATAPUMP\" class=\"headerlink\" title=\"DBMS_DATAPUMP\"></a>DBMS_DATAPUMP</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\">   v_handle     NUMBER;</span><br><span class=\"line\">   v_status     VARCHAR2(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">   v_handle :<span class=\"operator\">=</span> DBMS_DATAPUMP.OPEN(</span><br><span class=\"line\">                  operation   <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT&#x27;</span>,</span><br><span class=\"line\">                  job_mode    <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;TABLE&#x27;</span>,</span><br><span class=\"line\">                  remote_link <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;DBLINK_NAME&#x27;</span></span><br><span class=\"line\">               );</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR:table_export.dmp&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR:table_export.log&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.METADATA_FILTER(</span><br><span class=\"line\">      handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      name   <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;SCHEMA_EXPR&#x27;</span>,</span><br><span class=\"line\">      <span class=\"keyword\">value</span>  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IN(&#x27;&#x27;SCHEMA_NAME&#x27;&#x27;)&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.START_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.WAIT_FOR_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle, job_state <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_status);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.DETACH(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\">   v_handle     NUMBER;</span><br><span class=\"line\">   v_status     VARCHAR2(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">   v_handle :<span class=\"operator\">=</span> DBMS_DATAPUMP.OPEN(</span><br><span class=\"line\">                  operation   <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT&#x27;</span>,</span><br><span class=\"line\">                  job_mode    <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;TABLE&#x27;</span>,</span><br><span class=\"line\">                  remote_link <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;DBLINK_NAME&#x27;</span></span><br><span class=\"line\">               );</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR:table_export.dmp&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR:table_export.log&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.METADATA_REMAP(</span><br><span class=\"line\">      handle     <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      name       <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;REMAP_SCHEMA&#x27;</span>,</span><br><span class=\"line\">      old_value  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;OLD_SCHEMA_NAME&#x27;</span>,</span><br><span class=\"line\">      new_value  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;NEW_SCHEMA_NAME&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.START_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.WAIT_FOR_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle, job_state <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_status);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.DETACH(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>使用DBMS的方式不落地用expdp和impdp，一直在db裏完成，不需要進行os操作</p>\n</blockquote>\n<hr>\n<h2 id=\"Hint-–-insert-direct-path\"><a href=\"#Hint-–-insert-direct-path\" class=\"headerlink\" title=\"Hint – insert direct path\"></a>Hint – insert direct path</h2><blockquote>\n<p>INSERT /*+ APPEND */ 避開Buufer，直寫入DataFile，但要留意index會導致失效</p>\n</blockquote>\n<hr>\n<h2 id=\"Partition-Table\"><a href=\"#Partition-Table\" class=\"headerlink\" title=\"Partition Table\"></a>Partition Table</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE emp (</span><br><span class=\"line\">  id     NUMBER,</span><br><span class=\"line\">  t_date   DATE,</span><br><span class=\"line\">  amount   NUMBER</span><br><span class=\"line\">)</span><br><span class=\"line\">PARTITION BY RANGE(t_date)</span><br><span class=\"line\">INTERVAL(NUMTOYMINTERVAL(1, &#x27;MONTH&#x27;))</span><br><span class=\"line\">(</span><br><span class=\"line\">  PARTITION p1 VALUES LESS THAN (TO_DATE(&#x27;2022-01-01&#x27;, &#x27;YYYY-MM-DD&#x27;))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>自動增加Partition</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE emp ENABLE ROW MOVEMENT;  --一定要</span><br><span class=\"line\">EXEC DBMS_PART_ADMIN.ENABLE_AUTO_PARTITIONING( </span><br><span class=\"line\">  table_name  =&gt; &#x27;emp&#x27;,</span><br><span class=\"line\">  interval    =&gt; &#x27;INTERVAL(NUMTOYMINTERVAL(1, &#x27;&#x27;MONTH&#x27;&#x27;))&#x27;,</span><br><span class=\"line\">  start_date  =&gt; &#x27;2022-01-01&#x27;,</span><br><span class=\"line\">  retention   =&gt; &#x27;INTERVAL &#x27;&#x27;1&#x27;&#x27; MONTH&#x27; --個為間隔單位</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>自動刪除舊的Partition (19c可以用，較舊的版本要測一下)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BEGIN</span><br><span class=\"line\">  DBMS_PART_ADMIN.ALTER_RETENTION(</span><br><span class=\"line\">    table_name  =&gt; &#x27;emp&#x27;,</span><br><span class=\"line\">    retention   =&gt; &#x27;INTERVAL &#x27;&#x27;1&#x27;&#x27; MONTH&#x27;</span><br><span class=\"line\">  );</span><br><span class=\"line\">END;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"針對Index再優化\"><a href=\"#針對Index再優化\" class=\"headerlink\" title=\"針對Index再優化\"></a>針對Index再優化</h3><p>Partial Indexes</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> INDEX idx_emp_partial</span><br><span class=\"line\"><span class=\"keyword\">ON</span> emp(t_date)</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> t_date <span class=\"operator\">&gt;=</span> <span class=\"string\">&#x27;2022-01-01&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">-- index的資料只包含 2022-01-01之後的，之前的資料並不包含到index裏，可縮小index size</span></span><br></pre></td></tr></table></figure>\n\n<p>index生效的方式</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_date</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> t_date <span class=\"operator\">&gt;=</span> <span class=\"string\">&#x27;2022-02-01&#x27;</span> <span class=\"keyword\">and</span> t_date <span class=\"operator\">&lt;=</span> <span class=\"string\">&#x27;2022-04-01&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>刪除和新增資料佔用I/O的時間錯開</p>\n</blockquote>\n<hr>\n<h2 id=\"換別的OLAP-DB\"><a href=\"#換別的OLAP-DB\" class=\"headerlink\" title=\"換別的OLAP DB\"></a>換別的OLAP DB</h2><blockquote>\n<p>考量用apache doris、clickhouse，要考量是否能維運</p>\n</blockquote>\n<hr>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.首選先考慮升級成SSD</p>\n<p>2.了解AP邏輯運作後再看有多少空檔時間可做維護，再選擇方案</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>Data Warehouse 大資料匯入的優化手段</p>","more":"<h2 id=\"external-table-截入cvs和dmp\"><a href=\"#external-table-截入cvs和dmp\" class=\"headerlink\" title=\"external table 截入cvs和dmp\"></a>external table 截入cvs和dmp</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> emp_ext (</span><br><span class=\"line\">  id NUMBER(<span class=\"number\">4</span>),</span><br><span class=\"line\">  addr VARCHAR2(<span class=\"number\">10</span>),</span><br><span class=\"line\">  ctime <span class=\"type\">DATE</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ORGANIZATION <span class=\"keyword\">EXTERNAL</span> (</span><br><span class=\"line\">  TYPE CSV</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> DIRECTORY data_dir</span><br><span class=\"line\">  LOCATION (<span class=\"string\">&#x27;test.csv&#x27;</span>)</span><br><span class=\"line\">)</span><br><span class=\"line\">REJECT LIMIT UNLIMITED;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--產生dmp File</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> emptest_ext (</span><br><span class=\"line\">  id NUMBER(<span class=\"number\">4</span>),</span><br><span class=\"line\">  addr VARCHAR2(<span class=\"number\">10</span>),</span><br><span class=\"line\">  ctime <span class=\"type\">DATE</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ORGANIZATION <span class=\"keyword\">EXTERNAL</span> (</span><br><span class=\"line\">  TYPE ORACLE_DATAPUMP</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> DIRECTORY dump_dir</span><br><span class=\"line\">  LOCATION (<span class=\"string\">&#x27;emptest.dmp&#x27;</span>)</span><br><span class=\"line\">)</span><br><span class=\"line\">PARALLEL <span class=\"number\">4</span></span><br><span class=\"line\">REJECT LIMIT UNLIMITED;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> emptest_ext <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emptest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--戴入 emp_ext</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> emp_ext (</span><br><span class=\"line\">  id NUMBER(<span class=\"number\">4</span>),</span><br><span class=\"line\">  addr VARCHAR2(<span class=\"number\">10</span>),</span><br><span class=\"line\">  ctime <span class=\"type\">DATE</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ORGANIZATION <span class=\"keyword\">EXTERNAL</span> (</span><br><span class=\"line\">  TYPE ORACLE_DATAPUMP</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> DIRECTORY data_dir</span><br><span class=\"line\">  LOCATION (<span class=\"string\">&#x27;emptest.dmp&#x27;</span>)</span><br><span class=\"line\">)</span><br><span class=\"line\">REJECT LIMIT UNLIMITED;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>適合資料量很大，並且都是Full Table Scan處理的情境，要留意是無法建立index</p>\n</blockquote>\n<hr>\n<h2 id=\"DBMS-DATAPUMP\"><a href=\"#DBMS-DATAPUMP\" class=\"headerlink\" title=\"DBMS_DATAPUMP\"></a>DBMS_DATAPUMP</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\">   v_handle     NUMBER;</span><br><span class=\"line\">   v_status     VARCHAR2(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">   v_handle :<span class=\"operator\">=</span> DBMS_DATAPUMP.OPEN(</span><br><span class=\"line\">                  operation   <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT&#x27;</span>,</span><br><span class=\"line\">                  job_mode    <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;TABLE&#x27;</span>,</span><br><span class=\"line\">                  remote_link <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;DBLINK_NAME&#x27;</span></span><br><span class=\"line\">               );</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR:table_export.dmp&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR:table_export.log&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;EXPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.METADATA_FILTER(</span><br><span class=\"line\">      handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      name   <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;SCHEMA_EXPR&#x27;</span>,</span><br><span class=\"line\">      <span class=\"keyword\">value</span>  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IN(&#x27;&#x27;SCHEMA_NAME&#x27;&#x27;)&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.START_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.WAIT_FOR_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle, job_state <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_status);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.DETACH(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\">   v_handle     NUMBER;</span><br><span class=\"line\">   v_status     VARCHAR2(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">   v_handle :<span class=\"operator\">=</span> DBMS_DATAPUMP.OPEN(</span><br><span class=\"line\">                  operation   <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT&#x27;</span>,</span><br><span class=\"line\">                  job_mode    <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;TABLE&#x27;</span>,</span><br><span class=\"line\">                  remote_link <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;DBLINK_NAME&#x27;</span></span><br><span class=\"line\">               );</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR:table_export.dmp&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_DUMP_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.ADD_FILE(</span><br><span class=\"line\">      handle  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      filename<span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR:table_export.log&#x27;</span>,</span><br><span class=\"line\">      directory <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;IMPORT_DIR&#x27;</span>,</span><br><span class=\"line\">      filetype <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> DBMS_DATAPUMP.KU$_FILE_TYPE_LOG_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.METADATA_REMAP(</span><br><span class=\"line\">      handle     <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle,</span><br><span class=\"line\">      name       <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;REMAP_SCHEMA&#x27;</span>,</span><br><span class=\"line\">      old_value  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;OLD_SCHEMA_NAME&#x27;</span>,</span><br><span class=\"line\">      new_value  <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;NEW_SCHEMA_NAME&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.START_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.WAIT_FOR_JOB(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle, job_state <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_status);</span><br><span class=\"line\"></span><br><span class=\"line\">   DBMS_DATAPUMP.DETACH(handle <span class=\"operator\">=</span><span class=\"operator\">&gt;</span> v_handle);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>使用DBMS的方式不落地用expdp和impdp，一直在db裏完成，不需要進行os操作</p>\n</blockquote>\n<hr>\n<h2 id=\"Hint-–-insert-direct-path\"><a href=\"#Hint-–-insert-direct-path\" class=\"headerlink\" title=\"Hint – insert direct path\"></a>Hint – insert direct path</h2><blockquote>\n<p>INSERT /*+ APPEND */ 避開Buufer，直寫入DataFile，但要留意index會導致失效</p>\n</blockquote>\n<hr>\n<h2 id=\"Partition-Table\"><a href=\"#Partition-Table\" class=\"headerlink\" title=\"Partition Table\"></a>Partition Table</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE emp (</span><br><span class=\"line\">  id     NUMBER,</span><br><span class=\"line\">  t_date   DATE,</span><br><span class=\"line\">  amount   NUMBER</span><br><span class=\"line\">)</span><br><span class=\"line\">PARTITION BY RANGE(t_date)</span><br><span class=\"line\">INTERVAL(NUMTOYMINTERVAL(1, &#x27;MONTH&#x27;))</span><br><span class=\"line\">(</span><br><span class=\"line\">  PARTITION p1 VALUES LESS THAN (TO_DATE(&#x27;2022-01-01&#x27;, &#x27;YYYY-MM-DD&#x27;))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>自動增加Partition</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE emp ENABLE ROW MOVEMENT;  --一定要</span><br><span class=\"line\">EXEC DBMS_PART_ADMIN.ENABLE_AUTO_PARTITIONING( </span><br><span class=\"line\">  table_name  =&gt; &#x27;emp&#x27;,</span><br><span class=\"line\">  interval    =&gt; &#x27;INTERVAL(NUMTOYMINTERVAL(1, &#x27;&#x27;MONTH&#x27;&#x27;))&#x27;,</span><br><span class=\"line\">  start_date  =&gt; &#x27;2022-01-01&#x27;,</span><br><span class=\"line\">  retention   =&gt; &#x27;INTERVAL &#x27;&#x27;1&#x27;&#x27; MONTH&#x27; --個為間隔單位</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>自動刪除舊的Partition (19c可以用，較舊的版本要測一下)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BEGIN</span><br><span class=\"line\">  DBMS_PART_ADMIN.ALTER_RETENTION(</span><br><span class=\"line\">    table_name  =&gt; &#x27;emp&#x27;,</span><br><span class=\"line\">    retention   =&gt; &#x27;INTERVAL &#x27;&#x27;1&#x27;&#x27; MONTH&#x27;</span><br><span class=\"line\">  );</span><br><span class=\"line\">END;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"針對Index再優化\"><a href=\"#針對Index再優化\" class=\"headerlink\" title=\"針對Index再優化\"></a>針對Index再優化</h3><p>Partial Indexes</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> INDEX idx_emp_partial</span><br><span class=\"line\"><span class=\"keyword\">ON</span> emp(t_date)</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> t_date <span class=\"operator\">&gt;=</span> <span class=\"string\">&#x27;2022-01-01&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">-- index的資料只包含 2022-01-01之後的，之前的資料並不包含到index裏，可縮小index size</span></span><br></pre></td></tr></table></figure>\n\n<p>index生效的方式</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_date</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> t_date <span class=\"operator\">&gt;=</span> <span class=\"string\">&#x27;2022-02-01&#x27;</span> <span class=\"keyword\">and</span> t_date <span class=\"operator\">&lt;=</span> <span class=\"string\">&#x27;2022-04-01&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>刪除和新增資料佔用I/O的時間錯開</p>\n</blockquote>\n<hr>\n<h2 id=\"換別的OLAP-DB\"><a href=\"#換別的OLAP-DB\" class=\"headerlink\" title=\"換別的OLAP DB\"></a>換別的OLAP DB</h2><blockquote>\n<p>考量用apache doris、clickhouse，要考量是否能維運</p>\n</blockquote>\n<hr>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.首選先考慮升級成SSD</p>\n<p>2.了解AP邏輯運作後再看有多少空檔時間可做維護，再選擇方案</p>\n</blockquote>"},{"title":"Oracle-EM","date":"2023-03-12T06:49:24.000Z","_content":"\n重建11g EM問題處理\n\n<!--more-->\n\n\n\n1.環境變數\n\n```\nset ORACLE_UNQNAME\nset ORACLE_HOME\nset ORACLE_HOSTNAME\n```\n\n\n\n\n\n2.刪除EM的檢查\n\n```\nemca -deconfig dbcontrol db -repos drop\n\n手動檢查這些物件都要不存在\nSYSMAN\nMGMT_VIEW\nMGMT_USER\nMGMT_TARGET_BLACKOUTS\nSETEMVIEWUSERCONTEXT\n```\n\n\n\n\n\n3.建立EM\n\n```\nemca -config dbcontrol db -repos create\n\n--建立錯誤可考慮刪除舊的目錄\n$ORACLE_HOME/<主機名稱>_<Oracle_SID>\n```\n\n","source":"_posts/Oracle-EM.md","raw":"---\ntitle: Oracle-EM\ndate: 2023-03-12 14:49:24\ntags:\n- [ORA-]\ncategories:\n- [Oracle]\n- [Oracle11g]\n---\n\n重建11g EM問題處理\n\n<!--more-->\n\n\n\n1.環境變數\n\n```\nset ORACLE_UNQNAME\nset ORACLE_HOME\nset ORACLE_HOSTNAME\n```\n\n\n\n\n\n2.刪除EM的檢查\n\n```\nemca -deconfig dbcontrol db -repos drop\n\n手動檢查這些物件都要不存在\nSYSMAN\nMGMT_VIEW\nMGMT_USER\nMGMT_TARGET_BLACKOUTS\nSETEMVIEWUSERCONTEXT\n```\n\n\n\n\n\n3.建立EM\n\n```\nemca -config dbcontrol db -repos create\n\n--建立錯誤可考慮刪除舊的目錄\n$ORACLE_HOME/<主機名稱>_<Oracle_SID>\n```\n\n","slug":"Oracle-EM","published":1,"updated":"2023-03-12T06:59:00.427Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6q000crcu3h40i61sh","content":"<p>重建11g EM問題處理</p>\n<span id=\"more\"></span>\n\n\n\n<p>1.環境變數</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set ORACLE_UNQNAME</span><br><span class=\"line\">set ORACLE_HOME</span><br><span class=\"line\">set ORACLE_HOSTNAME</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>2.刪除EM的檢查</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">emca -deconfig dbcontrol db -repos drop</span><br><span class=\"line\"></span><br><span class=\"line\">手動檢查這些物件都要不存在</span><br><span class=\"line\">SYSMAN</span><br><span class=\"line\">MGMT_VIEW</span><br><span class=\"line\">MGMT_USER</span><br><span class=\"line\">MGMT_TARGET_BLACKOUTS</span><br><span class=\"line\">SETEMVIEWUSERCONTEXT</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>3.建立EM</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">emca -config dbcontrol db -repos create</span><br><span class=\"line\"></span><br><span class=\"line\">--建立錯誤可考慮刪除舊的目錄</span><br><span class=\"line\">$ORACLE_HOME/&lt;主機名稱&gt;_&lt;Oracle_SID&gt;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>重建11g EM問題處理</p>","more":"<p>1.環境變數</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set ORACLE_UNQNAME</span><br><span class=\"line\">set ORACLE_HOME</span><br><span class=\"line\">set ORACLE_HOSTNAME</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>2.刪除EM的檢查</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">emca -deconfig dbcontrol db -repos drop</span><br><span class=\"line\"></span><br><span class=\"line\">手動檢查這些物件都要不存在</span><br><span class=\"line\">SYSMAN</span><br><span class=\"line\">MGMT_VIEW</span><br><span class=\"line\">MGMT_USER</span><br><span class=\"line\">MGMT_TARGET_BLACKOUTS</span><br><span class=\"line\">SETEMVIEWUSERCONTEXT</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>3.建立EM</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">emca -config dbcontrol db -repos create</span><br><span class=\"line\"></span><br><span class=\"line\">--建立錯誤可考慮刪除舊的目錄</span><br><span class=\"line\">$ORACLE_HOME/&lt;主機名稱&gt;_&lt;Oracle_SID&gt;</span><br></pre></td></tr></table></figure>"},{"title":"Oracle-ORA-1861","date":"2023-03-02T14:47:17.000Z","_content":"\nRMAN Recovery Session Fails with ORA-1861 (Doc ID 852723.1)\n\n<!--more-->\n\n遇到的情況就是rman list backup出現 ORA-01861: literal does not match format string\n\n\n\n查的解決方法\n\n1.設定NLS，失敗\n\n```\nLinux :\nexport NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1\nexport NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS\n\nWindows :\nset NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1\nset NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS\n```\n\n2.重建controlfile，懶的用，所以不採用\n\n3.依Doc ID 852723.1來做最簡單，裏面就只有plb檔要戴入而已\n\n```\nloadjava -user sys/sys_pwd pb.plb\n\nsqlplus sys/sys_pwd as sysdba\n@del.sql\n```\n\n\n\n\n\n結論:\n\n> 1.DataGuard 環境在Standby DB也要做一次@del.sql\n>\n> 2.Standby Control File也可用restored的方式\n","source":"_posts/Oracle-ORA-1861.md","raw":"---\ntitle: Oracle-ORA-1861\ndate: 2023-03-02 22:47:17\ntags:\n- [Script]\ncategories:\n- [Oracle]\n- [Oracle11g]\n---\n\nRMAN Recovery Session Fails with ORA-1861 (Doc ID 852723.1)\n\n<!--more-->\n\n遇到的情況就是rman list backup出現 ORA-01861: literal does not match format string\n\n\n\n查的解決方法\n\n1.設定NLS，失敗\n\n```\nLinux :\nexport NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1\nexport NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS\n\nWindows :\nset NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1\nset NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS\n```\n\n2.重建controlfile，懶的用，所以不採用\n\n3.依Doc ID 852723.1來做最簡單，裏面就只有plb檔要戴入而已\n\n```\nloadjava -user sys/sys_pwd pb.plb\n\nsqlplus sys/sys_pwd as sysdba\n@del.sql\n```\n\n\n\n\n\n結論:\n\n> 1.DataGuard 環境在Standby DB也要做一次@del.sql\n>\n> 2.Standby Control File也可用restored的方式\n","slug":"Oracle-ORA-1861","published":1,"updated":"2023-03-02T15:06:00.230Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6q000drcu379jqhmfy","content":"<p>RMAN Recovery Session Fails with ORA-1861 (Doc ID 852723.1)</p>\n<span id=\"more\"></span>\n\n<p>遇到的情況就是rman list backup出現 ORA-01861: literal does not match format string</p>\n<p>查的解決方法</p>\n<p>1.設定NLS，失敗</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Linux :</span><br><span class=\"line\">export NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1</span><br><span class=\"line\">export NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS</span><br><span class=\"line\"></span><br><span class=\"line\">Windows :</span><br><span class=\"line\">set NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1</span><br><span class=\"line\">set NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS</span><br></pre></td></tr></table></figure>\n\n<p>2.重建controlfile，懶的用，所以不採用</p>\n<p>3.依Doc ID 852723.1來做最簡單，裏面就只有plb檔要戴入而已</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loadjava -user sys/sys_pwd pb.plb</span><br><span class=\"line\"></span><br><span class=\"line\">sqlplus sys/sys_pwd as sysdba</span><br><span class=\"line\">@del.sql</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>結論:</p>\n<blockquote>\n<p>1.DataGuard 環境在Standby DB也要做一次@del.sql</p>\n<p>2.Standby Control File也可用restored的方式</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>RMAN Recovery Session Fails with ORA-1861 (Doc ID 852723.1)</p>","more":"<p>遇到的情況就是rman list backup出現 ORA-01861: literal does not match format string</p>\n<p>查的解決方法</p>\n<p>1.設定NLS，失敗</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Linux :</span><br><span class=\"line\">export NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1</span><br><span class=\"line\">export NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS</span><br><span class=\"line\"></span><br><span class=\"line\">Windows :</span><br><span class=\"line\">set NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P1</span><br><span class=\"line\">set NLS_DATE_FORMAT=YYYY_MM_DD HH24:MI:SS</span><br></pre></td></tr></table></figure>\n\n<p>2.重建controlfile，懶的用，所以不採用</p>\n<p>3.依Doc ID 852723.1來做最簡單，裏面就只有plb檔要戴入而已</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loadjava -user sys/sys_pwd pb.plb</span><br><span class=\"line\"></span><br><span class=\"line\">sqlplus sys/sys_pwd as sysdba</span><br><span class=\"line\">@del.sql</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>結論:</p>\n<blockquote>\n<p>1.DataGuard 環境在Standby DB也要做一次@del.sql</p>\n<p>2.Standby Control File也可用restored的方式</p>\n</blockquote>"},{"title":"Oracle Zip壓縮檔案","date":"2023-02-11T14:46:43.000Z","_content":"\n將目錄下的txt壓成一個zip檔的範本\n\n<!--more-->\n\n## Java Zip Code\n\n```java\nimport java.io.*;\nimport java.util.zip.*;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipOutputStream;\n\n\npublic class zipFile\n{\n    //java zipFile 來源目錄 zip檔案(含目錄)\n    //java zipFile d:/temp d:/temp/t.zip\n    List<String> fileList;\n    zipFile(){\n\t   fileList = new ArrayList<String>();\n    }\n\n    public static void main( String[] args )\n    {\n    \tzipFile appZip = new zipFile();\n        String SOURCE_FOLDER = args[0];\n        String OUTPUT_ZIP_FILE = args[1];\n    \tappZip.generateFileList(new File(SOURCE_FOLDER),SOURCE_FOLDER);\n    \tappZip.zipIt(OUTPUT_ZIP_FILE,SOURCE_FOLDER);    \t\n    }\n\n    /**\n     * Zip it\n     * @param zipFile output ZIP file location\n     */\n    public void zipIt(String zipFile,String s_folder){\n\n     byte[] buffer = new byte[1024];\n\n     try{\n\n    \tFileOutputStream fos = new FileOutputStream(zipFile);\n    \tZipOutputStream zos = new ZipOutputStream(fos);\n\n    \tSystem.out.println(\"Output to Zip : \" + zipFile);\n\n    \tfor(String file : this.fileList){\n\n    \t\tSystem.out.println(\"File Added : \" + file);\n    \t\tZipEntry ze= new ZipEntry(file);\n        \tzos.putNextEntry(ze);\n\n        \tFileInputStream in =\n                       new FileInputStream(s_folder + File.separator + file);\n\n        \tint len;\n        \twhile ((len = in.read(buffer)) > 0) {\n        \t\tzos.write(buffer, 0, len);\n        \t}\n\n        \tin.close();\n    \t}\n\n    \tzos.closeEntry();\n    \t//remember close it\n    \tzos.close();\n\n    \tSystem.out.println(\"Done\");\n    }catch(IOException ex){\n       ex.printStackTrace();\n    }\n   }\n\n    /**\n     * Traverse a directory and get all files,\n     * and add the file into fileList\n     * @param node file or directory\n     */\n    public void generateFileList(File node,String s_folder){\n\n    //add file only\n\tif(node.isFile()){\n\t   if (node.getAbsoluteFile().toString().toLowerCase().lastIndexOf(\".txt\") >0 ) {\n\t\t  fileList.add(generateZipEntry(node.getAbsoluteFile().toString(),s_folder));\n       }\n\t}\n\n\t\n\tif(node.isDirectory()){\n\t\tString[] subNote = node.list();\n\t\tfor(String filename : subNote){\n\t\t   generateFileList(new File(node, filename),s_folder);\n\t\t}\n\t}\n\n    }\n\n    /**\n     * Format the file path for zip\n     * @param file file path\n     * @return Formatted file path\n     */\n    private String generateZipEntry(String file,String s_folder){\n    \treturn file.substring(s_folder.length()+1, file.length());\n    }\n}\n\n```\n\n\n\n\n\n## 將java編譯好的class匯入到DB\n\n```shell\nset ORACLE_SID=xxx\nloadjvav -user DB帳號 zipFile.clasee\n```\n\n\n\n\n\n## SYS執行\n\n```sql\nDECLARE\n  l_schema VARCHAR2(30) := 'DB帳號'; -- Adjust as required.\nBEGIN\n  DBMS_JAVA.grant_permission(l_schema, 'java.io.FilePermission', '<<ALL FILES>>', 'read ,write');\n  DBMS_JAVA.grant_permission(l_schema, 'SYS:java.lang.RuntimePermission', 'writeFileDescriptor', '');\n  DBMS_JAVA.grant_permission(l_schema, 'SYS:java.lang.RuntimePermission', 'readFileDescriptor', '');\nEND;\n/\n\n--建立 Procedure\nCREATE OR REPLACE PROCEDURE WH.zipFile(s_folder varchar2,zip_File VARCHAR2)\nAS LANGUAGE JAVA\nNAME 'zipFile.main(java.lang.String[])';\n/\n```\n\n\n\n\n\n## 執行方式\n\n```plsql\nexec zipFile('d:/temp','d:/temp/t.zip');\n```\n\n","source":"_posts/Oracle-Zip.md","raw":"---\ntitle: Oracle Zip壓縮檔案\ndate: 2023-02-11 22:46:43\ntags:\n- [Zip]\n- [Script]\ncategories:\n- [Oracle]\n---\n\n將目錄下的txt壓成一個zip檔的範本\n\n<!--more-->\n\n## Java Zip Code\n\n```java\nimport java.io.*;\nimport java.util.zip.*;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipOutputStream;\n\n\npublic class zipFile\n{\n    //java zipFile 來源目錄 zip檔案(含目錄)\n    //java zipFile d:/temp d:/temp/t.zip\n    List<String> fileList;\n    zipFile(){\n\t   fileList = new ArrayList<String>();\n    }\n\n    public static void main( String[] args )\n    {\n    \tzipFile appZip = new zipFile();\n        String SOURCE_FOLDER = args[0];\n        String OUTPUT_ZIP_FILE = args[1];\n    \tappZip.generateFileList(new File(SOURCE_FOLDER),SOURCE_FOLDER);\n    \tappZip.zipIt(OUTPUT_ZIP_FILE,SOURCE_FOLDER);    \t\n    }\n\n    /**\n     * Zip it\n     * @param zipFile output ZIP file location\n     */\n    public void zipIt(String zipFile,String s_folder){\n\n     byte[] buffer = new byte[1024];\n\n     try{\n\n    \tFileOutputStream fos = new FileOutputStream(zipFile);\n    \tZipOutputStream zos = new ZipOutputStream(fos);\n\n    \tSystem.out.println(\"Output to Zip : \" + zipFile);\n\n    \tfor(String file : this.fileList){\n\n    \t\tSystem.out.println(\"File Added : \" + file);\n    \t\tZipEntry ze= new ZipEntry(file);\n        \tzos.putNextEntry(ze);\n\n        \tFileInputStream in =\n                       new FileInputStream(s_folder + File.separator + file);\n\n        \tint len;\n        \twhile ((len = in.read(buffer)) > 0) {\n        \t\tzos.write(buffer, 0, len);\n        \t}\n\n        \tin.close();\n    \t}\n\n    \tzos.closeEntry();\n    \t//remember close it\n    \tzos.close();\n\n    \tSystem.out.println(\"Done\");\n    }catch(IOException ex){\n       ex.printStackTrace();\n    }\n   }\n\n    /**\n     * Traverse a directory and get all files,\n     * and add the file into fileList\n     * @param node file or directory\n     */\n    public void generateFileList(File node,String s_folder){\n\n    //add file only\n\tif(node.isFile()){\n\t   if (node.getAbsoluteFile().toString().toLowerCase().lastIndexOf(\".txt\") >0 ) {\n\t\t  fileList.add(generateZipEntry(node.getAbsoluteFile().toString(),s_folder));\n       }\n\t}\n\n\t\n\tif(node.isDirectory()){\n\t\tString[] subNote = node.list();\n\t\tfor(String filename : subNote){\n\t\t   generateFileList(new File(node, filename),s_folder);\n\t\t}\n\t}\n\n    }\n\n    /**\n     * Format the file path for zip\n     * @param file file path\n     * @return Formatted file path\n     */\n    private String generateZipEntry(String file,String s_folder){\n    \treturn file.substring(s_folder.length()+1, file.length());\n    }\n}\n\n```\n\n\n\n\n\n## 將java編譯好的class匯入到DB\n\n```shell\nset ORACLE_SID=xxx\nloadjvav -user DB帳號 zipFile.clasee\n```\n\n\n\n\n\n## SYS執行\n\n```sql\nDECLARE\n  l_schema VARCHAR2(30) := 'DB帳號'; -- Adjust as required.\nBEGIN\n  DBMS_JAVA.grant_permission(l_schema, 'java.io.FilePermission', '<<ALL FILES>>', 'read ,write');\n  DBMS_JAVA.grant_permission(l_schema, 'SYS:java.lang.RuntimePermission', 'writeFileDescriptor', '');\n  DBMS_JAVA.grant_permission(l_schema, 'SYS:java.lang.RuntimePermission', 'readFileDescriptor', '');\nEND;\n/\n\n--建立 Procedure\nCREATE OR REPLACE PROCEDURE WH.zipFile(s_folder varchar2,zip_File VARCHAR2)\nAS LANGUAGE JAVA\nNAME 'zipFile.main(java.lang.String[])';\n/\n```\n\n\n\n\n\n## 執行方式\n\n```plsql\nexec zipFile('d:/temp','d:/temp/t.zip');\n```\n\n","slug":"Oracle-Zip","published":1,"updated":"2023-02-19T14:32:09.254Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6s000grcu3hagvbe0s","content":"<p>將目錄下的txt壓成一個zip檔的範本</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Java-Zip-Code\"><a href=\"#Java-Zip-Code\" class=\"headerlink\" title=\"Java Zip Code\"></a>Java Zip Code</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipEntry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipOutputStream;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">zipFile</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">//java zipFile 來源目錄 zip檔案(含目錄)</span></span><br><span class=\"line\">    <span class=\"comment\">//java zipFile d:/temp d:/temp/t.zip</span></span><br><span class=\"line\">    List&lt;String&gt; fileList;</span><br><span class=\"line\">    zipFile()&#123;</span><br><span class=\"line\">\t   fileList = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;String&gt;();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">( String[] args )</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    \t<span class=\"type\">zipFile</span> <span class=\"variable\">appZip</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">zipFile</span>();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">SOURCE_FOLDER</span> <span class=\"operator\">=</span> args[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">OUTPUT_ZIP_FILE</span> <span class=\"operator\">=</span> args[<span class=\"number\">1</span>];</span><br><span class=\"line\">    \tappZip.generateFileList(<span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(SOURCE_FOLDER),SOURCE_FOLDER);</span><br><span class=\"line\">    \tappZip.zipIt(OUTPUT_ZIP_FILE,SOURCE_FOLDER);    \t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Zip it</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> zipFile output ZIP file location</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">zipIt</span><span class=\"params\">(String zipFile,String s_folder)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"type\">byte</span>[] buffer = <span class=\"keyword\">new</span> <span class=\"title class_\">byte</span>[<span class=\"number\">1024</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"type\">FileOutputStream</span> <span class=\"variable\">fos</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FileOutputStream</span>(zipFile);</span><br><span class=\"line\">    \t<span class=\"type\">ZipOutputStream</span> <span class=\"variable\">zos</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ZipOutputStream</span>(fos);</span><br><span class=\"line\"></span><br><span class=\"line\">    \tSystem.out.println(<span class=\"string\">&quot;Output to Zip : &quot;</span> + zipFile);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"keyword\">for</span>(String file : <span class=\"built_in\">this</span>.fileList)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\tSystem.out.println(<span class=\"string\">&quot;File Added : &quot;</span> + file);</span><br><span class=\"line\">    \t\tZipEntry ze= <span class=\"keyword\">new</span> <span class=\"title class_\">ZipEntry</span>(file);</span><br><span class=\"line\">        \tzos.putNextEntry(ze);</span><br><span class=\"line\"></span><br><span class=\"line\">        \t<span class=\"type\">FileInputStream</span> <span class=\"variable\">in</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                       <span class=\"keyword\">new</span> <span class=\"title class_\">FileInputStream</span>(s_folder + File.separator + file);</span><br><span class=\"line\"></span><br><span class=\"line\">        \t<span class=\"type\">int</span> len;</span><br><span class=\"line\">        \t<span class=\"keyword\">while</span> ((len = in.read(buffer)) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        \t\tzos.write(buffer, <span class=\"number\">0</span>, len);</span><br><span class=\"line\">        \t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        \tin.close();</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    \tzos.closeEntry();</span><br><span class=\"line\">    \t<span class=\"comment\">//remember close it</span></span><br><span class=\"line\">    \tzos.close();</span><br><span class=\"line\"></span><br><span class=\"line\">    \tSystem.out.println(<span class=\"string\">&quot;Done&quot;</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">catch</span>(IOException ex)&#123;</span><br><span class=\"line\">       ex.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Traverse a directory and get all files,</span></span><br><span class=\"line\"><span class=\"comment\">     * and add the file into fileList</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> node file or directory</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">generateFileList</span><span class=\"params\">(File node,String s_folder)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//add file only</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(node.isFile())&#123;</span><br><span class=\"line\">\t   <span class=\"keyword\">if</span> (node.getAbsoluteFile().toString().toLowerCase().lastIndexOf(<span class=\"string\">&quot;.txt&quot;</span>) &gt;<span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">\t\t  fileList.add(generateZipEntry(node.getAbsoluteFile().toString(),s_folder));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(node.isDirectory())&#123;</span><br><span class=\"line\">\t\tString[] subNote = node.list();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(String filename : subNote)&#123;</span><br><span class=\"line\">\t\t   generateFileList(<span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(node, filename),s_folder);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Format the file path for zip</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> file file path</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Formatted file path</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String <span class=\"title function_\">generateZipEntry</span><span class=\"params\">(String file,String s_folder)</span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> file.substring(s_folder.length()+<span class=\"number\">1</span>, file.length());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"將java編譯好的class匯入到DB\"><a href=\"#將java編譯好的class匯入到DB\" class=\"headerlink\" title=\"將java編譯好的class匯入到DB\"></a>將java編譯好的class匯入到DB</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set ORACLE_SID=xxx</span><br><span class=\"line\">loadjvav -user DB帳號 zipFile.clasee</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"SYS執行\"><a href=\"#SYS執行\" class=\"headerlink\" title=\"SYS執行\"></a>SYS執行</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\">  l_schema VARCHAR2(<span class=\"number\">30</span>) :<span class=\"operator\">=</span> <span class=\"string\">&#x27;DB帳號&#x27;</span>; <span class=\"comment\">-- Adjust as required.</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">  DBMS_JAVA.grant_permission(l_schema, <span class=\"string\">&#x27;java.io.FilePermission&#x27;</span>, <span class=\"string\">&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;</span>, <span class=\"string\">&#x27;read ,write&#x27;</span>);</span><br><span class=\"line\">  DBMS_JAVA.grant_permission(l_schema, <span class=\"string\">&#x27;SYS:java.lang.RuntimePermission&#x27;</span>, <span class=\"string\">&#x27;writeFileDescriptor&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">  DBMS_JAVA.grant_permission(l_schema, <span class=\"string\">&#x27;SYS:java.lang.RuntimePermission&#x27;</span>, <span class=\"string\">&#x27;readFileDescriptor&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--建立 Procedure</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">PROCEDURE</span> WH.zipFile(s_folder varchar2,zip_File VARCHAR2)</span><br><span class=\"line\"><span class=\"keyword\">AS</span> <span class=\"keyword\">LANGUAGE</span> JAVA</span><br><span class=\"line\">NAME <span class=\"string\">&#x27;zipFile.main(java.lang.String[])&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"執行方式\"><a href=\"#執行方式\" class=\"headerlink\" title=\"執行方式\"></a>執行方式</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exec zipFile(&#x27;d:/temp&#x27;,&#x27;d:/temp/t.zip&#x27;);</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>將目錄下的txt壓成一個zip檔的範本</p>","more":"<h2 id=\"Java-Zip-Code\"><a href=\"#Java-Zip-Code\" class=\"headerlink\" title=\"Java Zip Code\"></a>Java Zip Code</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipEntry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipOutputStream;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">zipFile</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">//java zipFile 來源目錄 zip檔案(含目錄)</span></span><br><span class=\"line\">    <span class=\"comment\">//java zipFile d:/temp d:/temp/t.zip</span></span><br><span class=\"line\">    List&lt;String&gt; fileList;</span><br><span class=\"line\">    zipFile()&#123;</span><br><span class=\"line\">\t   fileList = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;String&gt;();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">( String[] args )</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    \t<span class=\"type\">zipFile</span> <span class=\"variable\">appZip</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">zipFile</span>();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">SOURCE_FOLDER</span> <span class=\"operator\">=</span> args[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">OUTPUT_ZIP_FILE</span> <span class=\"operator\">=</span> args[<span class=\"number\">1</span>];</span><br><span class=\"line\">    \tappZip.generateFileList(<span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(SOURCE_FOLDER),SOURCE_FOLDER);</span><br><span class=\"line\">    \tappZip.zipIt(OUTPUT_ZIP_FILE,SOURCE_FOLDER);    \t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Zip it</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> zipFile output ZIP file location</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">zipIt</span><span class=\"params\">(String zipFile,String s_folder)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"type\">byte</span>[] buffer = <span class=\"keyword\">new</span> <span class=\"title class_\">byte</span>[<span class=\"number\">1024</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"type\">FileOutputStream</span> <span class=\"variable\">fos</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FileOutputStream</span>(zipFile);</span><br><span class=\"line\">    \t<span class=\"type\">ZipOutputStream</span> <span class=\"variable\">zos</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ZipOutputStream</span>(fos);</span><br><span class=\"line\"></span><br><span class=\"line\">    \tSystem.out.println(<span class=\"string\">&quot;Output to Zip : &quot;</span> + zipFile);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"keyword\">for</span>(String file : <span class=\"built_in\">this</span>.fileList)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\tSystem.out.println(<span class=\"string\">&quot;File Added : &quot;</span> + file);</span><br><span class=\"line\">    \t\tZipEntry ze= <span class=\"keyword\">new</span> <span class=\"title class_\">ZipEntry</span>(file);</span><br><span class=\"line\">        \tzos.putNextEntry(ze);</span><br><span class=\"line\"></span><br><span class=\"line\">        \t<span class=\"type\">FileInputStream</span> <span class=\"variable\">in</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                       <span class=\"keyword\">new</span> <span class=\"title class_\">FileInputStream</span>(s_folder + File.separator + file);</span><br><span class=\"line\"></span><br><span class=\"line\">        \t<span class=\"type\">int</span> len;</span><br><span class=\"line\">        \t<span class=\"keyword\">while</span> ((len = in.read(buffer)) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        \t\tzos.write(buffer, <span class=\"number\">0</span>, len);</span><br><span class=\"line\">        \t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        \tin.close();</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    \tzos.closeEntry();</span><br><span class=\"line\">    \t<span class=\"comment\">//remember close it</span></span><br><span class=\"line\">    \tzos.close();</span><br><span class=\"line\"></span><br><span class=\"line\">    \tSystem.out.println(<span class=\"string\">&quot;Done&quot;</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">catch</span>(IOException ex)&#123;</span><br><span class=\"line\">       ex.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Traverse a directory and get all files,</span></span><br><span class=\"line\"><span class=\"comment\">     * and add the file into fileList</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> node file or directory</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">generateFileList</span><span class=\"params\">(File node,String s_folder)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//add file only</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(node.isFile())&#123;</span><br><span class=\"line\">\t   <span class=\"keyword\">if</span> (node.getAbsoluteFile().toString().toLowerCase().lastIndexOf(<span class=\"string\">&quot;.txt&quot;</span>) &gt;<span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">\t\t  fileList.add(generateZipEntry(node.getAbsoluteFile().toString(),s_folder));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(node.isDirectory())&#123;</span><br><span class=\"line\">\t\tString[] subNote = node.list();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(String filename : subNote)&#123;</span><br><span class=\"line\">\t\t   generateFileList(<span class=\"keyword\">new</span> <span class=\"title class_\">File</span>(node, filename),s_folder);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Format the file path for zip</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> file file path</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Formatted file path</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String <span class=\"title function_\">generateZipEntry</span><span class=\"params\">(String file,String s_folder)</span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> file.substring(s_folder.length()+<span class=\"number\">1</span>, file.length());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"將java編譯好的class匯入到DB\"><a href=\"#將java編譯好的class匯入到DB\" class=\"headerlink\" title=\"將java編譯好的class匯入到DB\"></a>將java編譯好的class匯入到DB</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set ORACLE_SID=xxx</span><br><span class=\"line\">loadjvav -user DB帳號 zipFile.clasee</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"SYS執行\"><a href=\"#SYS執行\" class=\"headerlink\" title=\"SYS執行\"></a>SYS執行</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\">  l_schema VARCHAR2(<span class=\"number\">30</span>) :<span class=\"operator\">=</span> <span class=\"string\">&#x27;DB帳號&#x27;</span>; <span class=\"comment\">-- Adjust as required.</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">  DBMS_JAVA.grant_permission(l_schema, <span class=\"string\">&#x27;java.io.FilePermission&#x27;</span>, <span class=\"string\">&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;</span>, <span class=\"string\">&#x27;read ,write&#x27;</span>);</span><br><span class=\"line\">  DBMS_JAVA.grant_permission(l_schema, <span class=\"string\">&#x27;SYS:java.lang.RuntimePermission&#x27;</span>, <span class=\"string\">&#x27;writeFileDescriptor&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">  DBMS_JAVA.grant_permission(l_schema, <span class=\"string\">&#x27;SYS:java.lang.RuntimePermission&#x27;</span>, <span class=\"string\">&#x27;readFileDescriptor&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--建立 Procedure</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">PROCEDURE</span> WH.zipFile(s_folder varchar2,zip_File VARCHAR2)</span><br><span class=\"line\"><span class=\"keyword\">AS</span> <span class=\"keyword\">LANGUAGE</span> JAVA</span><br><span class=\"line\">NAME <span class=\"string\">&#x27;zipFile.main(java.lang.String[])&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"執行方式\"><a href=\"#執行方式\" class=\"headerlink\" title=\"執行方式\"></a>執行方式</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exec zipFile(&#x27;d:/temp&#x27;,&#x27;d:/temp/t.zip&#x27;);</span><br></pre></td></tr></table></figure>"},{"title":"Oracle11g_unwrap","date":"2023-02-14T15:43:31.000Z","_content":"\nOracle11g 反解wrap的內容\n\n<!--more-->\n\n\n\n## 使用方式\n\n```sql\nSET SERVEROUTPUT ON SIZE 1000000\nDECLARE\nBEGIN    \n     SYS.unwrap ('SchemaName', 'Object_Name','Object_Type');\nEND;\n/\n```\n\n\n\n\n\n## 程式碼\n\n```\nCREATE OR REPLACE PROCEDURE SYS.unwrap(p_owner IN VARCHAR,\n                   p_name  IN VARCHAR,\n                   p_type  IN VARCHAR) AS\n  \n    l_wrap varchar2(32767);\n  \n    l_inf       clob;\n    l_res       clob;\n    l_src       clob;\n    l_inflate   varchar2(32767);\n    l_temp      VARCHAR2(32767);\n    l_bt        varchar2(32767);\n    l_text      varchar2(32767);\n    l_char      varchar2(2);\n    l_len       number;\n    l_slen      integer;\n    l_offset    integer := 1;\n    l_chunk_len integer := 10080;\n  \n    --解密字節對照字典表\n    l_dict varchar2(512) := '3D6585B318DBE287F152AB634BB5A05F' ||\n                            '7D687B9B24C228678ADEA4261E03EB17' ||\n                            '6F343E7A3FD2A96A0FE935561FB14D10' ||\n                            '78D975F6BC4104816106F9ADD6D5297E' ||\n                            '869E79E505BA84CC6E278EB05DA8F39F' ||\n                            'D0A271B858DD2C38994C480755E4538C' ||\n                            '46B62DA5AF322240DC50C3A1258B9C16' ||\n                            '605CCFFD0C981CD4376D3C3A30E86C31' ||\n                            '47F533DA43C8E35E1994ECE6A39514E0' ||\n                            '9D64FA5915C52FCABB0BDFF297BF0A76' ||\n                            'B449445A1DF0009621807F1A82394FC1' ||\n                            'A7D70DD1D8FF139370EE5BEFBE09B977' ||\n                            '72E7B254B72AC7739066200E51EDF87C' ||\n                            '8F2EF412C62B83CDACCB3BC44EC06936' ||\n                            '6202AE88FCAA4208A64557D39ABDE123' ||\n                            '8D924A1189746B91FBFEC901EA1BF7CE';\n    l_sl   varchar2(512) := '000102030405060708090A0B0C0D0E0F' ||\n                            '101112131415161718191A1B1C1D1E1F' ||\n                            '202122232425262728292A2B2C2D2E2F' ||\n                            '303132333435363738393A3B3C3D3E3F' ||\n                            '404142434445464748494A4B4C4D4E4F' ||\n                            '505152535455565758595A5B5C5D5E5F' ||\n                            '606162636465666768696A6B6C6D6E6F' ||\n                            '707172737475767778797A7B7C7D7E7F' ||\n                            '808182838485868788898A8B8C8D8E8F' ||\n                            '909192939495969798999A9B9C9D9E9F' ||\n                            'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF' ||\n                            'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF' ||\n                            'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF' ||\n                            'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF' ||\n                            'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF' ||\n                            'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF';\n    cursor c_src is\n      SELECT src.line, src.text\n        FROM DBA_SOURCE src\n       WHERE owner = p_owner\n         AND Name = p_name\n         AND TYPE = p_type\n       order by line;\n  BEGIN\n    dbms_lob.createtemporary(lob_loc => l_inf,\n                             cache   => TRUE,\n                             dur     => dbms_lob.session);\n    --取得package密文\n    for rec in c_src loop\n      l_src := l_src || rtrim(rec.text);\n    end loop;\n  \n     --out_put('source:<'||l_src||'>');\n    l_src := rtrim(substr(l_src, instr(l_src, chr(10), 1, 20) + 1), chr(10));\n    l_src := replace(l_src, chr(10), '');\n    -- dbms_output.put_line('source:<'||l_src||'>');\n    --l_src:=substr(l_src,41);\n    \n    --base64解碼\n    l_len := dbms_lob.getlength(l_src);\n    while l_offset < l_len loop\n      if (l_len - l_offset) < 10080 then\n        l_chunk_len := (l_len - l_offset);\n      end if;\n      l_temp := dbms_lob.substr(l_src, l_chunk_len, l_offset);\n      l_bt   := utl_encode.base64_decode(utl_raw.cast_to_raw(l_temp));\n    \n      if l_bt is not null then\n        if l_offset = 1 then\n          --去掉前40位哈希串\n          l_bt := substr(l_bt, 41);\n        end if;\n        -- l_wrap := l_wrap || l_bt;\n        --字典表轉換\n        l_bt := utl_raw.translate(l_bt, l_sl, l_dict);\n      \n        l_offset := l_offset + l_chunk_len;\n        --    l_inflate := l_inflate || l_bt;\n        dbms_lob.writeappend(l_inf, length(l_bt), l_bt);\n      end if;\n    \n    end loop;\n  \n    /* dbms_output.put_line('base:' || l_wrap);\n    dbms_output.put_line('<' || l_inflate || '>');*/\n    \n    --解壓縮\n    l_res := cux_unwrapper_pl.inflate(l_inf);\n    DBMS_OUTPUT.PUT_LINE(l_res);\n  END unwrap;\n/\n```\n\n\n\n\n\n## 結論\n\n> 1.網路上試了好幾個版本，可在11g中使用無錯誤\n>\n> 2.應該不支援11g之後的版本，Oracle的加密方式已有改變\n\n","source":"_posts/Oracle11g-unwrap.md","raw":"---\ntitle: Oracle11g_unwrap\ndate: 2023-02-14 23:43:31\ntags:\n- [Script]\ncategories:\n- [Oracle]\n- [Oracle11g]\n---\n\nOracle11g 反解wrap的內容\n\n<!--more-->\n\n\n\n## 使用方式\n\n```sql\nSET SERVEROUTPUT ON SIZE 1000000\nDECLARE\nBEGIN    \n     SYS.unwrap ('SchemaName', 'Object_Name','Object_Type');\nEND;\n/\n```\n\n\n\n\n\n## 程式碼\n\n```\nCREATE OR REPLACE PROCEDURE SYS.unwrap(p_owner IN VARCHAR,\n                   p_name  IN VARCHAR,\n                   p_type  IN VARCHAR) AS\n  \n    l_wrap varchar2(32767);\n  \n    l_inf       clob;\n    l_res       clob;\n    l_src       clob;\n    l_inflate   varchar2(32767);\n    l_temp      VARCHAR2(32767);\n    l_bt        varchar2(32767);\n    l_text      varchar2(32767);\n    l_char      varchar2(2);\n    l_len       number;\n    l_slen      integer;\n    l_offset    integer := 1;\n    l_chunk_len integer := 10080;\n  \n    --解密字節對照字典表\n    l_dict varchar2(512) := '3D6585B318DBE287F152AB634BB5A05F' ||\n                            '7D687B9B24C228678ADEA4261E03EB17' ||\n                            '6F343E7A3FD2A96A0FE935561FB14D10' ||\n                            '78D975F6BC4104816106F9ADD6D5297E' ||\n                            '869E79E505BA84CC6E278EB05DA8F39F' ||\n                            'D0A271B858DD2C38994C480755E4538C' ||\n                            '46B62DA5AF322240DC50C3A1258B9C16' ||\n                            '605CCFFD0C981CD4376D3C3A30E86C31' ||\n                            '47F533DA43C8E35E1994ECE6A39514E0' ||\n                            '9D64FA5915C52FCABB0BDFF297BF0A76' ||\n                            'B449445A1DF0009621807F1A82394FC1' ||\n                            'A7D70DD1D8FF139370EE5BEFBE09B977' ||\n                            '72E7B254B72AC7739066200E51EDF87C' ||\n                            '8F2EF412C62B83CDACCB3BC44EC06936' ||\n                            '6202AE88FCAA4208A64557D39ABDE123' ||\n                            '8D924A1189746B91FBFEC901EA1BF7CE';\n    l_sl   varchar2(512) := '000102030405060708090A0B0C0D0E0F' ||\n                            '101112131415161718191A1B1C1D1E1F' ||\n                            '202122232425262728292A2B2C2D2E2F' ||\n                            '303132333435363738393A3B3C3D3E3F' ||\n                            '404142434445464748494A4B4C4D4E4F' ||\n                            '505152535455565758595A5B5C5D5E5F' ||\n                            '606162636465666768696A6B6C6D6E6F' ||\n                            '707172737475767778797A7B7C7D7E7F' ||\n                            '808182838485868788898A8B8C8D8E8F' ||\n                            '909192939495969798999A9B9C9D9E9F' ||\n                            'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF' ||\n                            'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF' ||\n                            'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF' ||\n                            'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF' ||\n                            'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF' ||\n                            'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF';\n    cursor c_src is\n      SELECT src.line, src.text\n        FROM DBA_SOURCE src\n       WHERE owner = p_owner\n         AND Name = p_name\n         AND TYPE = p_type\n       order by line;\n  BEGIN\n    dbms_lob.createtemporary(lob_loc => l_inf,\n                             cache   => TRUE,\n                             dur     => dbms_lob.session);\n    --取得package密文\n    for rec in c_src loop\n      l_src := l_src || rtrim(rec.text);\n    end loop;\n  \n     --out_put('source:<'||l_src||'>');\n    l_src := rtrim(substr(l_src, instr(l_src, chr(10), 1, 20) + 1), chr(10));\n    l_src := replace(l_src, chr(10), '');\n    -- dbms_output.put_line('source:<'||l_src||'>');\n    --l_src:=substr(l_src,41);\n    \n    --base64解碼\n    l_len := dbms_lob.getlength(l_src);\n    while l_offset < l_len loop\n      if (l_len - l_offset) < 10080 then\n        l_chunk_len := (l_len - l_offset);\n      end if;\n      l_temp := dbms_lob.substr(l_src, l_chunk_len, l_offset);\n      l_bt   := utl_encode.base64_decode(utl_raw.cast_to_raw(l_temp));\n    \n      if l_bt is not null then\n        if l_offset = 1 then\n          --去掉前40位哈希串\n          l_bt := substr(l_bt, 41);\n        end if;\n        -- l_wrap := l_wrap || l_bt;\n        --字典表轉換\n        l_bt := utl_raw.translate(l_bt, l_sl, l_dict);\n      \n        l_offset := l_offset + l_chunk_len;\n        --    l_inflate := l_inflate || l_bt;\n        dbms_lob.writeappend(l_inf, length(l_bt), l_bt);\n      end if;\n    \n    end loop;\n  \n    /* dbms_output.put_line('base:' || l_wrap);\n    dbms_output.put_line('<' || l_inflate || '>');*/\n    \n    --解壓縮\n    l_res := cux_unwrapper_pl.inflate(l_inf);\n    DBMS_OUTPUT.PUT_LINE(l_res);\n  END unwrap;\n/\n```\n\n\n\n\n\n## 結論\n\n> 1.網路上試了好幾個版本，可在11g中使用無錯誤\n>\n> 2.應該不支援11g之後的版本，Oracle的加密方式已有改變\n\n","slug":"Oracle11g-unwrap","published":1,"updated":"2023-02-19T14:32:16.677Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6t000jrcu39j3d4td7","content":"<p>Oracle11g 反解wrap的內容</p>\n<span id=\"more\"></span>\n\n\n\n<h2 id=\"使用方式\"><a href=\"#使用方式\" class=\"headerlink\" title=\"使用方式\"></a>使用方式</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> SERVEROUTPUT <span class=\"keyword\">ON</span> SIZE <span class=\"number\">1000000</span></span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>    </span><br><span class=\"line\">     SYS.unwrap (<span class=\"string\">&#x27;SchemaName&#x27;</span>, <span class=\"string\">&#x27;Object_Name&#x27;</span>,<span class=\"string\">&#x27;Object_Type&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"程式碼\"><a href=\"#程式碼\" class=\"headerlink\" title=\"程式碼\"></a>程式碼</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE OR REPLACE PROCEDURE SYS.unwrap(p_owner IN VARCHAR,</span><br><span class=\"line\">                   p_name  IN VARCHAR,</span><br><span class=\"line\">                   p_type  IN VARCHAR) AS</span><br><span class=\"line\">  </span><br><span class=\"line\">    l_wrap varchar2(32767);</span><br><span class=\"line\">  </span><br><span class=\"line\">    l_inf       clob;</span><br><span class=\"line\">    l_res       clob;</span><br><span class=\"line\">    l_src       clob;</span><br><span class=\"line\">    l_inflate   varchar2(32767);</span><br><span class=\"line\">    l_temp      VARCHAR2(32767);</span><br><span class=\"line\">    l_bt        varchar2(32767);</span><br><span class=\"line\">    l_text      varchar2(32767);</span><br><span class=\"line\">    l_char      varchar2(2);</span><br><span class=\"line\">    l_len       number;</span><br><span class=\"line\">    l_slen      integer;</span><br><span class=\"line\">    l_offset    integer := 1;</span><br><span class=\"line\">    l_chunk_len integer := 10080;</span><br><span class=\"line\">  </span><br><span class=\"line\">    --解密字節對照字典表</span><br><span class=\"line\">    l_dict varchar2(512) := &#x27;3D6585B318DBE287F152AB634BB5A05F&#x27; ||</span><br><span class=\"line\">                            &#x27;7D687B9B24C228678ADEA4261E03EB17&#x27; ||</span><br><span class=\"line\">                            &#x27;6F343E7A3FD2A96A0FE935561FB14D10&#x27; ||</span><br><span class=\"line\">                            &#x27;78D975F6BC4104816106F9ADD6D5297E&#x27; ||</span><br><span class=\"line\">                            &#x27;869E79E505BA84CC6E278EB05DA8F39F&#x27; ||</span><br><span class=\"line\">                            &#x27;D0A271B858DD2C38994C480755E4538C&#x27; ||</span><br><span class=\"line\">                            &#x27;46B62DA5AF322240DC50C3A1258B9C16&#x27; ||</span><br><span class=\"line\">                            &#x27;605CCFFD0C981CD4376D3C3A30E86C31&#x27; ||</span><br><span class=\"line\">                            &#x27;47F533DA43C8E35E1994ECE6A39514E0&#x27; ||</span><br><span class=\"line\">                            &#x27;9D64FA5915C52FCABB0BDFF297BF0A76&#x27; ||</span><br><span class=\"line\">                            &#x27;B449445A1DF0009621807F1A82394FC1&#x27; ||</span><br><span class=\"line\">                            &#x27;A7D70DD1D8FF139370EE5BEFBE09B977&#x27; ||</span><br><span class=\"line\">                            &#x27;72E7B254B72AC7739066200E51EDF87C&#x27; ||</span><br><span class=\"line\">                            &#x27;8F2EF412C62B83CDACCB3BC44EC06936&#x27; ||</span><br><span class=\"line\">                            &#x27;6202AE88FCAA4208A64557D39ABDE123&#x27; ||</span><br><span class=\"line\">                            &#x27;8D924A1189746B91FBFEC901EA1BF7CE&#x27;;</span><br><span class=\"line\">    l_sl   varchar2(512) := &#x27;000102030405060708090A0B0C0D0E0F&#x27; ||</span><br><span class=\"line\">                            &#x27;101112131415161718191A1B1C1D1E1F&#x27; ||</span><br><span class=\"line\">                            &#x27;202122232425262728292A2B2C2D2E2F&#x27; ||</span><br><span class=\"line\">                            &#x27;303132333435363738393A3B3C3D3E3F&#x27; ||</span><br><span class=\"line\">                            &#x27;404142434445464748494A4B4C4D4E4F&#x27; ||</span><br><span class=\"line\">                            &#x27;505152535455565758595A5B5C5D5E5F&#x27; ||</span><br><span class=\"line\">                            &#x27;606162636465666768696A6B6C6D6E6F&#x27; ||</span><br><span class=\"line\">                            &#x27;707172737475767778797A7B7C7D7E7F&#x27; ||</span><br><span class=\"line\">                            &#x27;808182838485868788898A8B8C8D8E8F&#x27; ||</span><br><span class=\"line\">                            &#x27;909192939495969798999A9B9C9D9E9F&#x27; ||</span><br><span class=\"line\">                            &#x27;A0A1A2A3A4A5A6A7A8A9AAABACADAEAF&#x27; ||</span><br><span class=\"line\">                            &#x27;B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF&#x27; ||</span><br><span class=\"line\">                            &#x27;C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF&#x27; ||</span><br><span class=\"line\">                            &#x27;D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF&#x27; ||</span><br><span class=\"line\">                            &#x27;E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF&#x27; ||</span><br><span class=\"line\">                            &#x27;F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF&#x27;;</span><br><span class=\"line\">    cursor c_src is</span><br><span class=\"line\">      SELECT src.line, src.text</span><br><span class=\"line\">        FROM DBA_SOURCE src</span><br><span class=\"line\">       WHERE owner = p_owner</span><br><span class=\"line\">         AND Name = p_name</span><br><span class=\"line\">         AND TYPE = p_type</span><br><span class=\"line\">       order by line;</span><br><span class=\"line\">  BEGIN</span><br><span class=\"line\">    dbms_lob.createtemporary(lob_loc =&gt; l_inf,</span><br><span class=\"line\">                             cache   =&gt; TRUE,</span><br><span class=\"line\">                             dur     =&gt; dbms_lob.session);</span><br><span class=\"line\">    --取得package密文</span><br><span class=\"line\">    for rec in c_src loop</span><br><span class=\"line\">      l_src := l_src || rtrim(rec.text);</span><br><span class=\"line\">    end loop;</span><br><span class=\"line\">  </span><br><span class=\"line\">     --out_put(&#x27;source:&lt;&#x27;||l_src||&#x27;&gt;&#x27;);</span><br><span class=\"line\">    l_src := rtrim(substr(l_src, instr(l_src, chr(10), 1, 20) + 1), chr(10));</span><br><span class=\"line\">    l_src := replace(l_src, chr(10), &#x27;&#x27;);</span><br><span class=\"line\">    -- dbms_output.put_line(&#x27;source:&lt;&#x27;||l_src||&#x27;&gt;&#x27;);</span><br><span class=\"line\">    --l_src:=substr(l_src,41);</span><br><span class=\"line\">    </span><br><span class=\"line\">    --base64解碼</span><br><span class=\"line\">    l_len := dbms_lob.getlength(l_src);</span><br><span class=\"line\">    while l_offset &lt; l_len loop</span><br><span class=\"line\">      if (l_len - l_offset) &lt; 10080 then</span><br><span class=\"line\">        l_chunk_len := (l_len - l_offset);</span><br><span class=\"line\">      end if;</span><br><span class=\"line\">      l_temp := dbms_lob.substr(l_src, l_chunk_len, l_offset);</span><br><span class=\"line\">      l_bt   := utl_encode.base64_decode(utl_raw.cast_to_raw(l_temp));</span><br><span class=\"line\">    </span><br><span class=\"line\">      if l_bt is not null then</span><br><span class=\"line\">        if l_offset = 1 then</span><br><span class=\"line\">          --去掉前40位哈希串</span><br><span class=\"line\">          l_bt := substr(l_bt, 41);</span><br><span class=\"line\">        end if;</span><br><span class=\"line\">        -- l_wrap := l_wrap || l_bt;</span><br><span class=\"line\">        --字典表轉換</span><br><span class=\"line\">        l_bt := utl_raw.translate(l_bt, l_sl, l_dict);</span><br><span class=\"line\">      </span><br><span class=\"line\">        l_offset := l_offset + l_chunk_len;</span><br><span class=\"line\">        --    l_inflate := l_inflate || l_bt;</span><br><span class=\"line\">        dbms_lob.writeappend(l_inf, length(l_bt), l_bt);</span><br><span class=\"line\">      end if;</span><br><span class=\"line\">    </span><br><span class=\"line\">    end loop;</span><br><span class=\"line\">  </span><br><span class=\"line\">    /* dbms_output.put_line(&#x27;base:&#x27; || l_wrap);</span><br><span class=\"line\">    dbms_output.put_line(&#x27;&lt;&#x27; || l_inflate || &#x27;&gt;&#x27;);*/</span><br><span class=\"line\">    </span><br><span class=\"line\">    --解壓縮</span><br><span class=\"line\">    l_res := cux_unwrapper_pl.inflate(l_inf);</span><br><span class=\"line\">    DBMS_OUTPUT.PUT_LINE(l_res);</span><br><span class=\"line\">  END unwrap;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.網路上試了好幾個版本，可在11g中使用無錯誤</p>\n<p>2.應該不支援11g之後的版本，Oracle的加密方式已有改變</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>Oracle11g 反解wrap的內容</p>","more":"<h2 id=\"使用方式\"><a href=\"#使用方式\" class=\"headerlink\" title=\"使用方式\"></a>使用方式</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> SERVEROUTPUT <span class=\"keyword\">ON</span> SIZE <span class=\"number\">1000000</span></span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>    </span><br><span class=\"line\">     SYS.unwrap (<span class=\"string\">&#x27;SchemaName&#x27;</span>, <span class=\"string\">&#x27;Object_Name&#x27;</span>,<span class=\"string\">&#x27;Object_Type&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"><span class=\"operator\">/</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"程式碼\"><a href=\"#程式碼\" class=\"headerlink\" title=\"程式碼\"></a>程式碼</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE OR REPLACE PROCEDURE SYS.unwrap(p_owner IN VARCHAR,</span><br><span class=\"line\">                   p_name  IN VARCHAR,</span><br><span class=\"line\">                   p_type  IN VARCHAR) AS</span><br><span class=\"line\">  </span><br><span class=\"line\">    l_wrap varchar2(32767);</span><br><span class=\"line\">  </span><br><span class=\"line\">    l_inf       clob;</span><br><span class=\"line\">    l_res       clob;</span><br><span class=\"line\">    l_src       clob;</span><br><span class=\"line\">    l_inflate   varchar2(32767);</span><br><span class=\"line\">    l_temp      VARCHAR2(32767);</span><br><span class=\"line\">    l_bt        varchar2(32767);</span><br><span class=\"line\">    l_text      varchar2(32767);</span><br><span class=\"line\">    l_char      varchar2(2);</span><br><span class=\"line\">    l_len       number;</span><br><span class=\"line\">    l_slen      integer;</span><br><span class=\"line\">    l_offset    integer := 1;</span><br><span class=\"line\">    l_chunk_len integer := 10080;</span><br><span class=\"line\">  </span><br><span class=\"line\">    --解密字節對照字典表</span><br><span class=\"line\">    l_dict varchar2(512) := &#x27;3D6585B318DBE287F152AB634BB5A05F&#x27; ||</span><br><span class=\"line\">                            &#x27;7D687B9B24C228678ADEA4261E03EB17&#x27; ||</span><br><span class=\"line\">                            &#x27;6F343E7A3FD2A96A0FE935561FB14D10&#x27; ||</span><br><span class=\"line\">                            &#x27;78D975F6BC4104816106F9ADD6D5297E&#x27; ||</span><br><span class=\"line\">                            &#x27;869E79E505BA84CC6E278EB05DA8F39F&#x27; ||</span><br><span class=\"line\">                            &#x27;D0A271B858DD2C38994C480755E4538C&#x27; ||</span><br><span class=\"line\">                            &#x27;46B62DA5AF322240DC50C3A1258B9C16&#x27; ||</span><br><span class=\"line\">                            &#x27;605CCFFD0C981CD4376D3C3A30E86C31&#x27; ||</span><br><span class=\"line\">                            &#x27;47F533DA43C8E35E1994ECE6A39514E0&#x27; ||</span><br><span class=\"line\">                            &#x27;9D64FA5915C52FCABB0BDFF297BF0A76&#x27; ||</span><br><span class=\"line\">                            &#x27;B449445A1DF0009621807F1A82394FC1&#x27; ||</span><br><span class=\"line\">                            &#x27;A7D70DD1D8FF139370EE5BEFBE09B977&#x27; ||</span><br><span class=\"line\">                            &#x27;72E7B254B72AC7739066200E51EDF87C&#x27; ||</span><br><span class=\"line\">                            &#x27;8F2EF412C62B83CDACCB3BC44EC06936&#x27; ||</span><br><span class=\"line\">                            &#x27;6202AE88FCAA4208A64557D39ABDE123&#x27; ||</span><br><span class=\"line\">                            &#x27;8D924A1189746B91FBFEC901EA1BF7CE&#x27;;</span><br><span class=\"line\">    l_sl   varchar2(512) := &#x27;000102030405060708090A0B0C0D0E0F&#x27; ||</span><br><span class=\"line\">                            &#x27;101112131415161718191A1B1C1D1E1F&#x27; ||</span><br><span class=\"line\">                            &#x27;202122232425262728292A2B2C2D2E2F&#x27; ||</span><br><span class=\"line\">                            &#x27;303132333435363738393A3B3C3D3E3F&#x27; ||</span><br><span class=\"line\">                            &#x27;404142434445464748494A4B4C4D4E4F&#x27; ||</span><br><span class=\"line\">                            &#x27;505152535455565758595A5B5C5D5E5F&#x27; ||</span><br><span class=\"line\">                            &#x27;606162636465666768696A6B6C6D6E6F&#x27; ||</span><br><span class=\"line\">                            &#x27;707172737475767778797A7B7C7D7E7F&#x27; ||</span><br><span class=\"line\">                            &#x27;808182838485868788898A8B8C8D8E8F&#x27; ||</span><br><span class=\"line\">                            &#x27;909192939495969798999A9B9C9D9E9F&#x27; ||</span><br><span class=\"line\">                            &#x27;A0A1A2A3A4A5A6A7A8A9AAABACADAEAF&#x27; ||</span><br><span class=\"line\">                            &#x27;B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF&#x27; ||</span><br><span class=\"line\">                            &#x27;C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF&#x27; ||</span><br><span class=\"line\">                            &#x27;D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF&#x27; ||</span><br><span class=\"line\">                            &#x27;E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF&#x27; ||</span><br><span class=\"line\">                            &#x27;F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF&#x27;;</span><br><span class=\"line\">    cursor c_src is</span><br><span class=\"line\">      SELECT src.line, src.text</span><br><span class=\"line\">        FROM DBA_SOURCE src</span><br><span class=\"line\">       WHERE owner = p_owner</span><br><span class=\"line\">         AND Name = p_name</span><br><span class=\"line\">         AND TYPE = p_type</span><br><span class=\"line\">       order by line;</span><br><span class=\"line\">  BEGIN</span><br><span class=\"line\">    dbms_lob.createtemporary(lob_loc =&gt; l_inf,</span><br><span class=\"line\">                             cache   =&gt; TRUE,</span><br><span class=\"line\">                             dur     =&gt; dbms_lob.session);</span><br><span class=\"line\">    --取得package密文</span><br><span class=\"line\">    for rec in c_src loop</span><br><span class=\"line\">      l_src := l_src || rtrim(rec.text);</span><br><span class=\"line\">    end loop;</span><br><span class=\"line\">  </span><br><span class=\"line\">     --out_put(&#x27;source:&lt;&#x27;||l_src||&#x27;&gt;&#x27;);</span><br><span class=\"line\">    l_src := rtrim(substr(l_src, instr(l_src, chr(10), 1, 20) + 1), chr(10));</span><br><span class=\"line\">    l_src := replace(l_src, chr(10), &#x27;&#x27;);</span><br><span class=\"line\">    -- dbms_output.put_line(&#x27;source:&lt;&#x27;||l_src||&#x27;&gt;&#x27;);</span><br><span class=\"line\">    --l_src:=substr(l_src,41);</span><br><span class=\"line\">    </span><br><span class=\"line\">    --base64解碼</span><br><span class=\"line\">    l_len := dbms_lob.getlength(l_src);</span><br><span class=\"line\">    while l_offset &lt; l_len loop</span><br><span class=\"line\">      if (l_len - l_offset) &lt; 10080 then</span><br><span class=\"line\">        l_chunk_len := (l_len - l_offset);</span><br><span class=\"line\">      end if;</span><br><span class=\"line\">      l_temp := dbms_lob.substr(l_src, l_chunk_len, l_offset);</span><br><span class=\"line\">      l_bt   := utl_encode.base64_decode(utl_raw.cast_to_raw(l_temp));</span><br><span class=\"line\">    </span><br><span class=\"line\">      if l_bt is not null then</span><br><span class=\"line\">        if l_offset = 1 then</span><br><span class=\"line\">          --去掉前40位哈希串</span><br><span class=\"line\">          l_bt := substr(l_bt, 41);</span><br><span class=\"line\">        end if;</span><br><span class=\"line\">        -- l_wrap := l_wrap || l_bt;</span><br><span class=\"line\">        --字典表轉換</span><br><span class=\"line\">        l_bt := utl_raw.translate(l_bt, l_sl, l_dict);</span><br><span class=\"line\">      </span><br><span class=\"line\">        l_offset := l_offset + l_chunk_len;</span><br><span class=\"line\">        --    l_inflate := l_inflate || l_bt;</span><br><span class=\"line\">        dbms_lob.writeappend(l_inf, length(l_bt), l_bt);</span><br><span class=\"line\">      end if;</span><br><span class=\"line\">    </span><br><span class=\"line\">    end loop;</span><br><span class=\"line\">  </span><br><span class=\"line\">    /* dbms_output.put_line(&#x27;base:&#x27; || l_wrap);</span><br><span class=\"line\">    dbms_output.put_line(&#x27;&lt;&#x27; || l_inflate || &#x27;&gt;&#x27;);*/</span><br><span class=\"line\">    </span><br><span class=\"line\">    --解壓縮</span><br><span class=\"line\">    l_res := cux_unwrapper_pl.inflate(l_inf);</span><br><span class=\"line\">    DBMS_OUTPUT.PUT_LINE(l_res);</span><br><span class=\"line\">  END unwrap;</span><br><span class=\"line\">/</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.網路上試了好幾個版本，可在11g中使用無錯誤</p>\n<p>2.應該不支援11g之後的版本，Oracle的加密方式已有改變</p>\n</blockquote>"},{"title":"ProxySQL","date":"2023-02-07T15:49:54.000Z","_content":"\nProx暫定\n\n<!--more-->\n\n待\n","source":"_posts/ProxySQL.md","raw":"---\ntitle: ProxySQL\ndate: 2023-02-07 23:49:54\ntags: \n - Install\ncategories:\n - MariaDB\n---\n\nProx暫定\n\n<!--more-->\n\n待\n","slug":"ProxySQL","published":1,"updated":"2023-02-19T14:33:23.094Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6u000nrcu33zki5mmb","content":"<p>Prox暫定</p>\n<span id=\"more\"></span>\n\n<p>待</p>\n","site":{"data":{}},"excerpt":"<p>Prox暫定</p>","more":"<p>待</p>"},{"title":"Oracle19c_Rman_Restore_Table","date":"2023-02-12T11:16:37.000Z","_content":"\nOracle 19c 新功能 : Rman Restore table\n\n<!--more-->\n\n\n\n## Recover Table\n\n```\nrecover table SchemaName.TableName until time \"to_date('2020-06-12 15:07:08','yyyy-mm-dd hh24:mi:ss')\" auxiliary destination 'c:\\ap\\recover_temp';\n```\n\n\n\n\n\n## 目錄架構\n\n![image-20230212192032400](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200832.png)\n\n\n\n\n\n## 執行的Log\n\n![image-20230212192558673](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201158.png)\n\n\n\n![image-20230212192647009](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201207.png)\n\n\n\n![image-20230212192711109](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201231.png)\n\n暫存目錄檔案沒自動刪除乾淨...\n\n\n\n\n\n## 結論\n\n> 1.在舊版本就只能restore配合skpi tablespace才能完成這個需求\n>\n> 2.在還原Table的過程中是需要一定的硬碟空間需求\n>\n> 3.Table取出後要記清除產生的暫存檔案\n","source":"_posts/Oracle19c-Rman-Restore-Table.md","raw":"---\ntitle: Oracle19c_Rman_Restore_Table\ndate: 2023-02-12 19:16:37\ntags:\n- [Rman]\ncategories:\n- [Oracle]\n- [Oracle19c]\n---\n\nOracle 19c 新功能 : Rman Restore table\n\n<!--more-->\n\n\n\n## Recover Table\n\n```\nrecover table SchemaName.TableName until time \"to_date('2020-06-12 15:07:08','yyyy-mm-dd hh24:mi:ss')\" auxiliary destination 'c:\\ap\\recover_temp';\n```\n\n\n\n\n\n## 目錄架構\n\n![image-20230212192032400](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200832.png)\n\n\n\n\n\n## 執行的Log\n\n![image-20230212192558673](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201158.png)\n\n\n\n![image-20230212192647009](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201207.png)\n\n\n\n![image-20230212192711109](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201231.png)\n\n暫存目錄檔案沒自動刪除乾淨...\n\n\n\n\n\n## 結論\n\n> 1.在舊版本就只能restore配合skpi tablespace才能完成這個需求\n>\n> 2.在還原Table的過程中是需要一定的硬碟空間需求\n>\n> 3.Table取出後要記清除產生的暫存檔案\n","slug":"Oracle19c-Rman-Restore-Table","published":1,"updated":"2023-02-19T14:33:12.798Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6v000qrcu39raueyvn","content":"<p>Oracle 19c 新功能 : Rman Restore table</p>\n<span id=\"more\"></span>\n\n\n\n<h2 id=\"Recover-Table\"><a href=\"#Recover-Table\" class=\"headerlink\" title=\"Recover Table\"></a>Recover Table</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">recover table SchemaName.TableName until time &quot;to_date(&#x27;2020-06-12 15:07:08&#x27;,&#x27;yyyy-mm-dd hh24:mi:ss&#x27;)&quot; auxiliary destination &#x27;c:\\ap\\recover_temp&#x27;;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"目錄架構\"><a href=\"#目錄架構\" class=\"headerlink\" title=\"目錄架構\"></a>目錄架構</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200832.png\" alt=\"image-20230212192032400\"></p>\n<h2 id=\"執行的Log\"><a href=\"#執行的Log\" class=\"headerlink\" title=\"執行的Log\"></a>執行的Log</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201158.png\" alt=\"image-20230212192558673\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201207.png\" alt=\"image-20230212192647009\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201231.png\" alt=\"image-20230212192711109\"></p>\n<p>暫存目錄檔案沒自動刪除乾淨…</p>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.在舊版本就只能restore配合skpi tablespace才能完成這個需求</p>\n<p>2.在還原Table的過程中是需要一定的硬碟空間需求</p>\n<p>3.Table取出後要記清除產生的暫存檔案</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>Oracle 19c 新功能 : Rman Restore table</p>","more":"<h2 id=\"Recover-Table\"><a href=\"#Recover-Table\" class=\"headerlink\" title=\"Recover Table\"></a>Recover Table</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">recover table SchemaName.TableName until time &quot;to_date(&#x27;2020-06-12 15:07:08&#x27;,&#x27;yyyy-mm-dd hh24:mi:ss&#x27;)&quot; auxiliary destination &#x27;c:\\ap\\recover_temp&#x27;;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"目錄架構\"><a href=\"#目錄架構\" class=\"headerlink\" title=\"目錄架構\"></a>目錄架構</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200832.png\" alt=\"image-20230212192032400\"></p>\n<h2 id=\"執行的Log\"><a href=\"#執行的Log\" class=\"headerlink\" title=\"執行的Log\"></a>執行的Log</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201158.png\" alt=\"image-20230212192558673\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201207.png\" alt=\"image-20230212192647009\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676201231.png\" alt=\"image-20230212192711109\"></p>\n<p>暫存目錄檔案沒自動刪除乾淨…</p>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.在舊版本就只能restore配合skpi tablespace才能完成這個需求</p>\n<p>2.在還原Table的過程中是需要一定的硬碟空間需求</p>\n<p>3.Table取出後要記清除產生的暫存檔案</p>\n</blockquote>"},{"title":"Hexo雜記","date":"2023-02-11T13:07:21.000Z","_content":"\nHexo設定記錄\n\n<!--more-->\n\n## 如何刪除 Hexo 已發佈的文章\n\n1. 在%HEXO_HOME%/source/_post 資料夾中刪除不要的文章\n\n2. CMD 執行hexo clean\n\n3. 在%HEXO_HOME% 刪除 db.json\n\n4. 執行hexo cl\n\n5. 執行hexo g -d\n\n\n\n\n\n## 首頁只顯示部份內容\n\n文章中插<!--more-->就只會顯示該行以上的內容\n\n\n\n\n\n## 留言版\n\n參考 [https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/](https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/)\n\n","source":"_posts/hexo雜記.md","raw":"---\ntitle: Hexo雜記\ndate: 2023-02-11 21:07:21\ntags:\n- [Hexo]\ncategories:\n- [Hexo]\n---\n\nHexo設定記錄\n\n<!--more-->\n\n## 如何刪除 Hexo 已發佈的文章\n\n1. 在%HEXO_HOME%/source/_post 資料夾中刪除不要的文章\n\n2. CMD 執行hexo clean\n\n3. 在%HEXO_HOME% 刪除 db.json\n\n4. 執行hexo cl\n\n5. 執行hexo g -d\n\n\n\n\n\n## 首頁只顯示部份內容\n\n文章中插<!--more-->就只會顯示該行以上的內容\n\n\n\n\n\n## 留言版\n\n參考 [https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/](https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/)\n\n","slug":"hexo雜記","published":1,"updated":"2023-02-19T14:31:10.766Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6w000urcu3cpub6lnn","content":"<p>Hexo設定記錄</p>\n<span id=\"more\"></span>\n\n<h2 id=\"如何刪除-Hexo-已發佈的文章\"><a href=\"#如何刪除-Hexo-已發佈的文章\" class=\"headerlink\" title=\"如何刪除 Hexo 已發佈的文章\"></a>如何刪除 Hexo 已發佈的文章</h2><ol>\n<li><p>在%HEXO_HOME%/source/_post 資料夾中刪除不要的文章</p>\n</li>\n<li><p>CMD 執行hexo clean</p>\n</li>\n<li><p>在%HEXO_HOME% 刪除 db.json</p>\n</li>\n<li><p>執行hexo cl</p>\n</li>\n<li><p>執行hexo g -d</p>\n</li>\n</ol>\n<h2 id=\"首頁只顯示部份內容\"><a href=\"#首頁只顯示部份內容\" class=\"headerlink\" title=\"首頁只顯示部份內容\"></a>首頁只顯示部份內容</h2><p>文章中插<!--more-->就只會顯示該行以上的內容</p>\n<h2 id=\"留言版\"><a href=\"#留言版\" class=\"headerlink\" title=\"留言版\"></a>留言版</h2><p>參考 <a href=\"https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/\">https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/</a></p>\n","site":{"data":{}},"excerpt":"<p>Hexo設定記錄</p>","more":"<h2 id=\"如何刪除-Hexo-已發佈的文章\"><a href=\"#如何刪除-Hexo-已發佈的文章\" class=\"headerlink\" title=\"如何刪除 Hexo 已發佈的文章\"></a>如何刪除 Hexo 已發佈的文章</h2><ol>\n<li><p>在%HEXO_HOME%/source/_post 資料夾中刪除不要的文章</p>\n</li>\n<li><p>CMD 執行hexo clean</p>\n</li>\n<li><p>在%HEXO_HOME% 刪除 db.json</p>\n</li>\n<li><p>執行hexo cl</p>\n</li>\n<li><p>執行hexo g -d</p>\n</li>\n</ol>\n<h2 id=\"首頁只顯示部份內容\"><a href=\"#首頁只顯示部份內容\" class=\"headerlink\" title=\"首頁只顯示部份內容\"></a>首頁只顯示部份內容</h2><p>文章中插<!--more-->就只會顯示該行以上的內容</p>\n<h2 id=\"留言版\"><a href=\"#留言版\" class=\"headerlink\" title=\"留言版\"></a>留言版</h2><p>參考 <a href=\"https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/\">https://annkuoq.github.io/blog/2020-03-09-add-utterances-comment-widget-to-hexo/</a></p>"},{"title":"lab設定","date":"2023-02-15T14:09:27.000Z","_content":"\n做測試時會用的設定參考網址\n\n<!--more-->\n\n## Windows 關畢密碼政策\n\n> 1.https://dev.twsiyuan.com/2017/01/configuring-password-policies-with-windows-server-2016.html\n>\n> 2.gpedit.msc\n\n\n\n\n\n## Windows AD 關畢密碼政策\n\n> 1.gpmc.msc\n>\n> 2.Computer Configuration > Policies > Windows Settings > Security Settings > Account Policies > Password Policy\n>\n> 3.Double-click on the \"Password must meet complexity requirements\" policy > Select \"Disabled\"\n\n\n\n\n\n## 工具\n\n> 7Zip\n>\n> Notepad++\n>\n> Typora\n>\n> virtualbox\n","source":"_posts/lab-info.md","raw":"---\ntitle: lab設定\ndate: 2023-02-15 22:09:27\ntags:\n- [Script]\ncategories:\n- [OS]\n---\n\n做測試時會用的設定參考網址\n\n<!--more-->\n\n## Windows 關畢密碼政策\n\n> 1.https://dev.twsiyuan.com/2017/01/configuring-password-policies-with-windows-server-2016.html\n>\n> 2.gpedit.msc\n\n\n\n\n\n## Windows AD 關畢密碼政策\n\n> 1.gpmc.msc\n>\n> 2.Computer Configuration > Policies > Windows Settings > Security Settings > Account Policies > Password Policy\n>\n> 3.Double-click on the \"Password must meet complexity requirements\" policy > Select \"Disabled\"\n\n\n\n\n\n## 工具\n\n> 7Zip\n>\n> Notepad++\n>\n> Typora\n>\n> virtualbox\n","slug":"lab-info","published":1,"updated":"2023-02-19T14:31:41.200Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6x000wrcu3d11e1wfa","content":"<p>做測試時會用的設定參考網址</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Windows-關畢密碼政策\"><a href=\"#Windows-關畢密碼政策\" class=\"headerlink\" title=\"Windows 關畢密碼政策\"></a>Windows 關畢密碼政策</h2><blockquote>\n<p>1.<a href=\"https://dev.twsiyuan.com/2017/01/configuring-password-policies-with-windows-server-2016.html\">https://dev.twsiyuan.com/2017/01/configuring-password-policies-with-windows-server-2016.html</a></p>\n<p>2.gpedit.msc</p>\n</blockquote>\n<h2 id=\"Windows-AD-關畢密碼政策\"><a href=\"#Windows-AD-關畢密碼政策\" class=\"headerlink\" title=\"Windows AD 關畢密碼政策\"></a>Windows AD 關畢密碼政策</h2><blockquote>\n<p>1.gpmc.msc</p>\n<p>2.Computer Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Account Policies &gt; Password Policy</p>\n<p>3.Double-click on the “Password must meet complexity requirements” policy &gt; Select “Disabled”</p>\n</blockquote>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><blockquote>\n<p>7Zip</p>\n<p>Notepad++</p>\n<p>Typora</p>\n<p>virtualbox</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>做測試時會用的設定參考網址</p>","more":"<h2 id=\"Windows-關畢密碼政策\"><a href=\"#Windows-關畢密碼政策\" class=\"headerlink\" title=\"Windows 關畢密碼政策\"></a>Windows 關畢密碼政策</h2><blockquote>\n<p>1.<a href=\"https://dev.twsiyuan.com/2017/01/configuring-password-policies-with-windows-server-2016.html\">https://dev.twsiyuan.com/2017/01/configuring-password-policies-with-windows-server-2016.html</a></p>\n<p>2.gpedit.msc</p>\n</blockquote>\n<h2 id=\"Windows-AD-關畢密碼政策\"><a href=\"#Windows-AD-關畢密碼政策\" class=\"headerlink\" title=\"Windows AD 關畢密碼政策\"></a>Windows AD 關畢密碼政策</h2><blockquote>\n<p>1.gpmc.msc</p>\n<p>2.Computer Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Account Policies &gt; Password Policy</p>\n<p>3.Double-click on the “Password must meet complexity requirements” policy &gt; Select “Disabled”</p>\n</blockquote>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><blockquote>\n<p>7Zip</p>\n<p>Notepad++</p>\n<p>Typora</p>\n<p>virtualbox</p>\n</blockquote>"},{"title":"SQL_FailOver_Cluster","date":"2023-02-19T13:17:39.000Z","_content":"\n前罝作業\n\n<!--more-->\n\n> 1.測SQL FailOver Cluster是要AD和iSCSI\n>\n> 2.是測AlwaysOn可不用AD，可用工作群組設\n>\n> 3.方便測試可關畢:密碼政策、防火牆\n>\n> 4.不論是FailOver Cluster或AlwaysOn都需要Windows Failover Cluster\n>\n> 5.FailOver Cluster安裝時要留意安裝SQL Home時的硬碟有沒有選錯，進FailOver Cluster Manager確認一下，以免安裝錯誤要調整或重來一次都麻煩\n>\n> 6.TLS 1.0 要考慮是否要開起，舊版的SQL並不支援TLS 1.2\n>\n> 7.遠端登入要開起\n>\n> 8.Windows Update記的要做，以免少Patch\n>\n> 9.AD有包含DNS的話，記的把C:\\Windows\\System32\\drivers\\etc\\hosts內容盡可能清空，以免讓DNS和hosts裏面的內容出現衝突\n\n\n\n------\n\n\n\n## TLS 1.0 開起方式\n\n```\n1.regedit\n2.HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\n3.建新目錄TLS 1.0，下面再建Client和Server，各別新增2個 DWORD \n  --DisabledByDefault  (值設為0)\n  --Enabled  (值設為1)\n4.重開OS後，用powershell進行檢查\nGet-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Client\" -Name DisabledByDefault\nGet-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server\" -Name DisabledByDefault\n```\n\n\n\n\n\n------\n\n## Windows FailOver Cluster留意事項\n\n### 設定Quorum Disk(仲裁磁碟)\n\n![image-20230219222207793](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816546.png)\n\n\n\n![image-20230219222254144](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816583.png)\n\n\n\n![image-20230219222429300](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816669.png)\n\n選擇那個硬碟要當仲裁磁碟\n\n![image-20230219222509987](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816710.png)\n\n沒錯誤的話，應該會是Disk Witness in Quorum\n\n![image-20230219222636220](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816796.png)\n\n\n\n------\n\n\n\n## SQL FailOver Cluster錯誤處理\n\n### 多張網卡\n\n![image-20230222231334277](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677078814.png)\n\n> 設定網卡只留一個cluster and client在除錯上會容易很多\n\n\n\n\n\n### DNS\n\n![image-20230222231803452](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677079083.png)\n\n> 1.安裝windows failover cluster 的帳號要有異動dns和查詢node主機資源的權限，用較大的權限建立避免一些權限問題\n>\n> 2.當windows/sql 的 failover cluster的vip無法自動建立在dns裏時，可手動補建。相對來說，如有產生錯誤的dns記錄的話，直接手動刪除就可以\n>\n> 3.node主機網卡的第一個dns ip建議寫網域的\n\n\n\n\n\n### Remote Registry 權限\n\n> Run wmimgmt.msc\n\n\n\n![image-20230223221906009](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677161946.png)\n\n\n\n![image-20230223222215469](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162135.png)\n\n\n\n![image-20230223222403422](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162243.png)\n\n\n\n![image-20230223222511496](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162311.png)\n\n\n\n\n\n\n\n###　DCOM 權限\n\n> Run dcomcnfg\n\n\n\n\n\n![image-20230223223048305](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162648.png)\n\n\n\n![image-20230223223240744](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162760.png)\n\n\n\n![image-20230223223331758](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162811.png)\n\n\n\n\n\n### WMI 權限\n\n> Run dcomcnfg\n\n\n\n\n\n![image-20230223223914623](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163154.png)\n\n\n\n\n\n![image-20230223224057210](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163644.png)\n\n\n\n\n\n![image-20230223224316383](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163396.png)\n\n\n\n\n\n\n\n### 修正SQL Server Agent是null的情況\n\n![image-20230223230823870](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677164904.png)\n\n\n\n#### PowerShell\n\n```\n$ClusterName = \"sqlcluster\"\n$FciClusterGroupName = \"SQL Server (MSSQLSERVER)\"\nAdd-ClusterResourceType -Name \"SQL Server Agent\" -Dll \"sqagtres.dll\" \n```\n\n![image-20230223231450729](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165290.png)\n\n\n\n\n\n![image-20230223231647851](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165408.png)\n\n\n\n\n\n![image-20230223233943452](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166783.png)\n\n\n\n#### SQL Server Agent進行配置\n\n![image-20230223234023893](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166824.png)\n\n\n\n![image-20230223234103405](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166863.png)\n\n\n\n\n\n![image-20230223235918061](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167958.png)\n\n重起SQL FailOver Cluster後再用SSMS試看看能否正常登入DB\n\n\n\n## Add Node to SQL FailOver Cluster不知的錯誤\n\n> 遇到該檢查和確認的都沒問題，但就是在安裝過程中出現錯誤，試的檢查 regedit : Primary DB主機，這些參數都要為1\n\n![image-20230223235555095](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167755.png)\n\n\n\n------\n\n## SQL FailOver Cluster安裝\n\n### Node A\n\n![image-20230220212455255](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899515.png)\n\n\n\n![image-20230220212522748](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899539.png)\n\n\n\n![image-20230220212553903](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899554.png)\n\n\n\n\n\n![image-20230220212640200](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899600.png)\n\n\n\n\n\n![image-20230220223021981](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903422.png)\n\n\n\n\n\n![image-20230220223135663](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903495.png)\n\n\n\n![image-20230220223208973](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903529.png)\n\n\n\n![image-20230220223331211](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903611.png)\n\n\n\n我網卡沒配置好，不然應該是要設成固定IP較佳\n\n![image-20230220223353803](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903634.png)\n\n\n\n![image-20230220223532356](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903732.png)\n\n\n\n![image-20230220223623645](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903783.png)\n\n\n\nShare Disk\n\n![image-20230220223713560](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903833.png)\n\n\n\n![image-20230220223803736](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903883.png)\n\n\n\n\n\n![image-20230220223856159](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903936.png)\n\n\n\n![image-20230220223929225](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903969.png)\n\n\n\n\n\n![image-20230220225643580](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676905003.png)\n\n> 可先建立起後，再進windows failover cluster manager進行重新檢查sql failover cluster無法起動的原因\n>\n> 檢查:TLS支援度、各node、vip 主機名稱在DNS裏是不是正確、防火牆、起動sql服務的ad帳號權限是否有node主機的administrator權限\n\n\n\n### Node B \n\n新增node到sql failover cluster\n\n![image-20230222234331936](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080612.png)\n\n\n\n![image-20230222234401864](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080642.png)\n\n\n\n![image-20230222234420672](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080660.png)\n\n\n\n![image-20230222234439731](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080679.png)\n\n\n\n![image-20230223224829524](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163709.png)\n\n\n\n![image-20230223224932838](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163787.png)\n\n\n\n\n\n![image-20230223225026687](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163826.png)\n\n\n\n![image-20230223235005122](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167405.png)\n\n\n\n\n\n![image-20230224000200930](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168121.png)\n\n\n\n\n\n![image-20230224000917091](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168557.png)\n\n\n\n\n\n\n\n重起原本的primdy db主機後，可以在另一台主機看到已正確接手\n\n![image-20230224001317302](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168797.png)\n\n\n\n![image-20230224001327038](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168807.png)\n\n\n\n## 結論:\n\n> 1.安裝SQL的主機權限要額外設定，不然就算用Administrator安裝也一樣報錯\n>\n> 2.DCOM的權限是跟SSIS有關\n>\n> 3.WMI和Reomte Registry的權限問題是有關連的，要一併處理\n>\n> 4.FailOver Cluster的價錢比AlwaysOn便宜，並且無AlwaysOn切換時有資料不一致問題。如Storage有保護機制的，FailOver Cluster也不是無法使用的HA方案\n\n","source":"_posts/SQL-FailOver-Cluster.md","raw":"---\ntitle: SQL_FailOver_Cluster\ndate: 2023-02-19 21:17:39\ntags: \n - Install\ncategories:\n - [HA]\n - [MSSQL]\n---\n\n前罝作業\n\n<!--more-->\n\n> 1.測SQL FailOver Cluster是要AD和iSCSI\n>\n> 2.是測AlwaysOn可不用AD，可用工作群組設\n>\n> 3.方便測試可關畢:密碼政策、防火牆\n>\n> 4.不論是FailOver Cluster或AlwaysOn都需要Windows Failover Cluster\n>\n> 5.FailOver Cluster安裝時要留意安裝SQL Home時的硬碟有沒有選錯，進FailOver Cluster Manager確認一下，以免安裝錯誤要調整或重來一次都麻煩\n>\n> 6.TLS 1.0 要考慮是否要開起，舊版的SQL並不支援TLS 1.2\n>\n> 7.遠端登入要開起\n>\n> 8.Windows Update記的要做，以免少Patch\n>\n> 9.AD有包含DNS的話，記的把C:\\Windows\\System32\\drivers\\etc\\hosts內容盡可能清空，以免讓DNS和hosts裏面的內容出現衝突\n\n\n\n------\n\n\n\n## TLS 1.0 開起方式\n\n```\n1.regedit\n2.HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\n3.建新目錄TLS 1.0，下面再建Client和Server，各別新增2個 DWORD \n  --DisabledByDefault  (值設為0)\n  --Enabled  (值設為1)\n4.重開OS後，用powershell進行檢查\nGet-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Client\" -Name DisabledByDefault\nGet-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server\" -Name DisabledByDefault\n```\n\n\n\n\n\n------\n\n## Windows FailOver Cluster留意事項\n\n### 設定Quorum Disk(仲裁磁碟)\n\n![image-20230219222207793](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816546.png)\n\n\n\n![image-20230219222254144](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816583.png)\n\n\n\n![image-20230219222429300](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816669.png)\n\n選擇那個硬碟要當仲裁磁碟\n\n![image-20230219222509987](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816710.png)\n\n沒錯誤的話，應該會是Disk Witness in Quorum\n\n![image-20230219222636220](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816796.png)\n\n\n\n------\n\n\n\n## SQL FailOver Cluster錯誤處理\n\n### 多張網卡\n\n![image-20230222231334277](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677078814.png)\n\n> 設定網卡只留一個cluster and client在除錯上會容易很多\n\n\n\n\n\n### DNS\n\n![image-20230222231803452](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677079083.png)\n\n> 1.安裝windows failover cluster 的帳號要有異動dns和查詢node主機資源的權限，用較大的權限建立避免一些權限問題\n>\n> 2.當windows/sql 的 failover cluster的vip無法自動建立在dns裏時，可手動補建。相對來說，如有產生錯誤的dns記錄的話，直接手動刪除就可以\n>\n> 3.node主機網卡的第一個dns ip建議寫網域的\n\n\n\n\n\n### Remote Registry 權限\n\n> Run wmimgmt.msc\n\n\n\n![image-20230223221906009](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677161946.png)\n\n\n\n![image-20230223222215469](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162135.png)\n\n\n\n![image-20230223222403422](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162243.png)\n\n\n\n![image-20230223222511496](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162311.png)\n\n\n\n\n\n\n\n###　DCOM 權限\n\n> Run dcomcnfg\n\n\n\n\n\n![image-20230223223048305](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162648.png)\n\n\n\n![image-20230223223240744](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162760.png)\n\n\n\n![image-20230223223331758](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162811.png)\n\n\n\n\n\n### WMI 權限\n\n> Run dcomcnfg\n\n\n\n\n\n![image-20230223223914623](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163154.png)\n\n\n\n\n\n![image-20230223224057210](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163644.png)\n\n\n\n\n\n![image-20230223224316383](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163396.png)\n\n\n\n\n\n\n\n### 修正SQL Server Agent是null的情況\n\n![image-20230223230823870](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677164904.png)\n\n\n\n#### PowerShell\n\n```\n$ClusterName = \"sqlcluster\"\n$FciClusterGroupName = \"SQL Server (MSSQLSERVER)\"\nAdd-ClusterResourceType -Name \"SQL Server Agent\" -Dll \"sqagtres.dll\" \n```\n\n![image-20230223231450729](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165290.png)\n\n\n\n\n\n![image-20230223231647851](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165408.png)\n\n\n\n\n\n![image-20230223233943452](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166783.png)\n\n\n\n#### SQL Server Agent進行配置\n\n![image-20230223234023893](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166824.png)\n\n\n\n![image-20230223234103405](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166863.png)\n\n\n\n\n\n![image-20230223235918061](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167958.png)\n\n重起SQL FailOver Cluster後再用SSMS試看看能否正常登入DB\n\n\n\n## Add Node to SQL FailOver Cluster不知的錯誤\n\n> 遇到該檢查和確認的都沒問題，但就是在安裝過程中出現錯誤，試的檢查 regedit : Primary DB主機，這些參數都要為1\n\n![image-20230223235555095](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167755.png)\n\n\n\n------\n\n## SQL FailOver Cluster安裝\n\n### Node A\n\n![image-20230220212455255](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899515.png)\n\n\n\n![image-20230220212522748](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899539.png)\n\n\n\n![image-20230220212553903](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899554.png)\n\n\n\n\n\n![image-20230220212640200](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899600.png)\n\n\n\n\n\n![image-20230220223021981](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903422.png)\n\n\n\n\n\n![image-20230220223135663](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903495.png)\n\n\n\n![image-20230220223208973](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903529.png)\n\n\n\n![image-20230220223331211](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903611.png)\n\n\n\n我網卡沒配置好，不然應該是要設成固定IP較佳\n\n![image-20230220223353803](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903634.png)\n\n\n\n![image-20230220223532356](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903732.png)\n\n\n\n![image-20230220223623645](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903783.png)\n\n\n\nShare Disk\n\n![image-20230220223713560](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903833.png)\n\n\n\n![image-20230220223803736](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903883.png)\n\n\n\n\n\n![image-20230220223856159](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903936.png)\n\n\n\n![image-20230220223929225](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903969.png)\n\n\n\n\n\n![image-20230220225643580](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676905003.png)\n\n> 可先建立起後，再進windows failover cluster manager進行重新檢查sql failover cluster無法起動的原因\n>\n> 檢查:TLS支援度、各node、vip 主機名稱在DNS裏是不是正確、防火牆、起動sql服務的ad帳號權限是否有node主機的administrator權限\n\n\n\n### Node B \n\n新增node到sql failover cluster\n\n![image-20230222234331936](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080612.png)\n\n\n\n![image-20230222234401864](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080642.png)\n\n\n\n![image-20230222234420672](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080660.png)\n\n\n\n![image-20230222234439731](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080679.png)\n\n\n\n![image-20230223224829524](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163709.png)\n\n\n\n![image-20230223224932838](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163787.png)\n\n\n\n\n\n![image-20230223225026687](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163826.png)\n\n\n\n![image-20230223235005122](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167405.png)\n\n\n\n\n\n![image-20230224000200930](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168121.png)\n\n\n\n\n\n![image-20230224000917091](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168557.png)\n\n\n\n\n\n\n\n重起原本的primdy db主機後，可以在另一台主機看到已正確接手\n\n![image-20230224001317302](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168797.png)\n\n\n\n![image-20230224001327038](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168807.png)\n\n\n\n## 結論:\n\n> 1.安裝SQL的主機權限要額外設定，不然就算用Administrator安裝也一樣報錯\n>\n> 2.DCOM的權限是跟SSIS有關\n>\n> 3.WMI和Reomte Registry的權限問題是有關連的，要一併處理\n>\n> 4.FailOver Cluster的價錢比AlwaysOn便宜，並且無AlwaysOn切換時有資料不一致問題。如Storage有保護機制的，FailOver Cluster也不是無法使用的HA方案\n\n","slug":"SQL-FailOver-Cluster","published":1,"updated":"2023-02-25T13:28:25.453Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6y000zrcu3g73rh8vy","content":"<p>前罝作業</p>\n<span id=\"more\"></span>\n\n<blockquote>\n<p>1.測SQL FailOver Cluster是要AD和iSCSI</p>\n<p>2.是測AlwaysOn可不用AD，可用工作群組設</p>\n<p>3.方便測試可關畢:密碼政策、防火牆</p>\n<p>4.不論是FailOver Cluster或AlwaysOn都需要Windows Failover Cluster</p>\n<p>5.FailOver Cluster安裝時要留意安裝SQL Home時的硬碟有沒有選錯，進FailOver Cluster Manager確認一下，以免安裝錯誤要調整或重來一次都麻煩</p>\n<p>6.TLS 1.0 要考慮是否要開起，舊版的SQL並不支援TLS 1.2</p>\n<p>7.遠端登入要開起</p>\n<p>8.Windows Update記的要做，以免少Patch</p>\n<p>9.AD有包含DNS的話，記的把C:\\Windows\\System32\\drivers\\etc\\hosts內容盡可能清空，以免讓DNS和hosts裏面的內容出現衝突</p>\n</blockquote>\n<hr>\n<h2 id=\"TLS-1-0-開起方式\"><a href=\"#TLS-1-0-開起方式\" class=\"headerlink\" title=\"TLS 1.0 開起方式\"></a>TLS 1.0 開起方式</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.regedit</span><br><span class=\"line\">2.HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols</span><br><span class=\"line\">3.建新目錄TLS 1.0，下面再建Client和Server，各別新增2個 DWORD </span><br><span class=\"line\">  --DisabledByDefault  (值設為0)</span><br><span class=\"line\">  --Enabled  (值設為1)</span><br><span class=\"line\">4.重開OS後，用powershell進行檢查</span><br><span class=\"line\">Get-ItemProperty -Path &quot;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Client&quot; -Name DisabledByDefault</span><br><span class=\"line\">Get-ItemProperty -Path &quot;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server&quot; -Name DisabledByDefault</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<hr>\n<h2 id=\"Windows-FailOver-Cluster留意事項\"><a href=\"#Windows-FailOver-Cluster留意事項\" class=\"headerlink\" title=\"Windows FailOver Cluster留意事項\"></a>Windows FailOver Cluster留意事項</h2><h3 id=\"設定Quorum-Disk-仲裁磁碟\"><a href=\"#設定Quorum-Disk-仲裁磁碟\" class=\"headerlink\" title=\"設定Quorum Disk(仲裁磁碟)\"></a>設定Quorum Disk(仲裁磁碟)</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816546.png\" alt=\"image-20230219222207793\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816583.png\" alt=\"image-20230219222254144\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816669.png\" alt=\"image-20230219222429300\"></p>\n<p>選擇那個硬碟要當仲裁磁碟</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816710.png\" alt=\"image-20230219222509987\"></p>\n<p>沒錯誤的話，應該會是Disk Witness in Quorum</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816796.png\" alt=\"image-20230219222636220\"></p>\n<hr>\n<h2 id=\"SQL-FailOver-Cluster錯誤處理\"><a href=\"#SQL-FailOver-Cluster錯誤處理\" class=\"headerlink\" title=\"SQL FailOver Cluster錯誤處理\"></a>SQL FailOver Cluster錯誤處理</h2><h3 id=\"多張網卡\"><a href=\"#多張網卡\" class=\"headerlink\" title=\"多張網卡\"></a>多張網卡</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677078814.png\" alt=\"image-20230222231334277\"></p>\n<blockquote>\n<p>設定網卡只留一個cluster and client在除錯上會容易很多</p>\n</blockquote>\n<h3 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677079083.png\" alt=\"image-20230222231803452\"></p>\n<blockquote>\n<p>1.安裝windows failover cluster 的帳號要有異動dns和查詢node主機資源的權限，用較大的權限建立避免一些權限問題</p>\n<p>2.當windows/sql 的 failover cluster的vip無法自動建立在dns裏時，可手動補建。相對來說，如有產生錯誤的dns記錄的話，直接手動刪除就可以</p>\n<p>3.node主機網卡的第一個dns ip建議寫網域的</p>\n</blockquote>\n<h3 id=\"Remote-Registry-權限\"><a href=\"#Remote-Registry-權限\" class=\"headerlink\" title=\"Remote Registry 權限\"></a>Remote Registry 權限</h3><blockquote>\n<p>Run wmimgmt.msc</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677161946.png\" alt=\"image-20230223221906009\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162135.png\" alt=\"image-20230223222215469\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162243.png\" alt=\"image-20230223222403422\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162311.png\" alt=\"image-20230223222511496\"></p>\n<h3 id=\"DCOM-權限\"><a href=\"#DCOM-權限\" class=\"headerlink\" title=\"DCOM 權限\"></a>DCOM 權限</h3><blockquote>\n<p>Run dcomcnfg</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162648.png\" alt=\"image-20230223223048305\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162760.png\" alt=\"image-20230223223240744\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162811.png\" alt=\"image-20230223223331758\"></p>\n<h3 id=\"WMI-權限\"><a href=\"#WMI-權限\" class=\"headerlink\" title=\"WMI 權限\"></a>WMI 權限</h3><blockquote>\n<p>Run dcomcnfg</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163154.png\" alt=\"image-20230223223914623\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163644.png\" alt=\"image-20230223224057210\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163396.png\" alt=\"image-20230223224316383\"></p>\n<h3 id=\"修正SQL-Server-Agent是null的情況\"><a href=\"#修正SQL-Server-Agent是null的情況\" class=\"headerlink\" title=\"修正SQL Server Agent是null的情況\"></a>修正SQL Server Agent是null的情況</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677164904.png\" alt=\"image-20230223230823870\"></p>\n<h4 id=\"PowerShell\"><a href=\"#PowerShell\" class=\"headerlink\" title=\"PowerShell\"></a>PowerShell</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ClusterName = &quot;sqlcluster&quot;</span><br><span class=\"line\">$FciClusterGroupName = &quot;SQL Server (MSSQLSERVER)&quot;</span><br><span class=\"line\">Add-ClusterResourceType -Name &quot;SQL Server Agent&quot; -Dll &quot;sqagtres.dll&quot; </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165290.png\" alt=\"image-20230223231450729\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165408.png\" alt=\"image-20230223231647851\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166783.png\" alt=\"image-20230223233943452\"></p>\n<h4 id=\"SQL-Server-Agent進行配置\"><a href=\"#SQL-Server-Agent進行配置\" class=\"headerlink\" title=\"SQL Server Agent進行配置\"></a>SQL Server Agent進行配置</h4><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166824.png\" alt=\"image-20230223234023893\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166863.png\" alt=\"image-20230223234103405\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167958.png\" alt=\"image-20230223235918061\"></p>\n<p>重起SQL FailOver Cluster後再用SSMS試看看能否正常登入DB</p>\n<h2 id=\"Add-Node-to-SQL-FailOver-Cluster不知的錯誤\"><a href=\"#Add-Node-to-SQL-FailOver-Cluster不知的錯誤\" class=\"headerlink\" title=\"Add Node to SQL FailOver Cluster不知的錯誤\"></a>Add Node to SQL FailOver Cluster不知的錯誤</h2><blockquote>\n<p>遇到該檢查和確認的都沒問題，但就是在安裝過程中出現錯誤，試的檢查 regedit : Primary DB主機，這些參數都要為1</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167755.png\" alt=\"image-20230223235555095\"></p>\n<hr>\n<h2 id=\"SQL-FailOver-Cluster安裝\"><a href=\"#SQL-FailOver-Cluster安裝\" class=\"headerlink\" title=\"SQL FailOver Cluster安裝\"></a>SQL FailOver Cluster安裝</h2><h3 id=\"Node-A\"><a href=\"#Node-A\" class=\"headerlink\" title=\"Node A\"></a>Node A</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899515.png\" alt=\"image-20230220212455255\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899539.png\" alt=\"image-20230220212522748\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899554.png\" alt=\"image-20230220212553903\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899600.png\" alt=\"image-20230220212640200\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903422.png\" alt=\"image-20230220223021981\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903495.png\" alt=\"image-20230220223135663\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903529.png\" alt=\"image-20230220223208973\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903611.png\" alt=\"image-20230220223331211\"></p>\n<p>我網卡沒配置好，不然應該是要設成固定IP較佳</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903634.png\" alt=\"image-20230220223353803\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903732.png\" alt=\"image-20230220223532356\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903783.png\" alt=\"image-20230220223623645\"></p>\n<p>Share Disk</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903833.png\" alt=\"image-20230220223713560\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903883.png\" alt=\"image-20230220223803736\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903936.png\" alt=\"image-20230220223856159\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903969.png\" alt=\"image-20230220223929225\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676905003.png\" alt=\"image-20230220225643580\"></p>\n<blockquote>\n<p>可先建立起後，再進windows failover cluster manager進行重新檢查sql failover cluster無法起動的原因</p>\n<p>檢查:TLS支援度、各node、vip 主機名稱在DNS裏是不是正確、防火牆、起動sql服務的ad帳號權限是否有node主機的administrator權限</p>\n</blockquote>\n<h3 id=\"Node-B\"><a href=\"#Node-B\" class=\"headerlink\" title=\"Node B\"></a>Node B</h3><p>新增node到sql failover cluster</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080612.png\" alt=\"image-20230222234331936\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080642.png\" alt=\"image-20230222234401864\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080660.png\" alt=\"image-20230222234420672\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080679.png\" alt=\"image-20230222234439731\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163709.png\" alt=\"image-20230223224829524\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163787.png\" alt=\"image-20230223224932838\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163826.png\" alt=\"image-20230223225026687\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167405.png\" alt=\"image-20230223235005122\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168121.png\" alt=\"image-20230224000200930\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168557.png\" alt=\"image-20230224000917091\"></p>\n<p>重起原本的primdy db主機後，可以在另一台主機看到已正確接手</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168797.png\" alt=\"image-20230224001317302\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168807.png\" alt=\"image-20230224001327038\"></p>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論:\"></a>結論:</h2><blockquote>\n<p>1.安裝SQL的主機權限要額外設定，不然就算用Administrator安裝也一樣報錯</p>\n<p>2.DCOM的權限是跟SSIS有關</p>\n<p>3.WMI和Reomte Registry的權限問題是有關連的，要一併處理</p>\n<p>4.FailOver Cluster的價錢比AlwaysOn便宜，並且無AlwaysOn切換時有資料不一致問題。如Storage有保護機制的，FailOver Cluster也不是無法使用的HA方案</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>前罝作業</p>","more":"<blockquote>\n<p>1.測SQL FailOver Cluster是要AD和iSCSI</p>\n<p>2.是測AlwaysOn可不用AD，可用工作群組設</p>\n<p>3.方便測試可關畢:密碼政策、防火牆</p>\n<p>4.不論是FailOver Cluster或AlwaysOn都需要Windows Failover Cluster</p>\n<p>5.FailOver Cluster安裝時要留意安裝SQL Home時的硬碟有沒有選錯，進FailOver Cluster Manager確認一下，以免安裝錯誤要調整或重來一次都麻煩</p>\n<p>6.TLS 1.0 要考慮是否要開起，舊版的SQL並不支援TLS 1.2</p>\n<p>7.遠端登入要開起</p>\n<p>8.Windows Update記的要做，以免少Patch</p>\n<p>9.AD有包含DNS的話，記的把C:\\Windows\\System32\\drivers\\etc\\hosts內容盡可能清空，以免讓DNS和hosts裏面的內容出現衝突</p>\n</blockquote>\n<hr>\n<h2 id=\"TLS-1-0-開起方式\"><a href=\"#TLS-1-0-開起方式\" class=\"headerlink\" title=\"TLS 1.0 開起方式\"></a>TLS 1.0 開起方式</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.regedit</span><br><span class=\"line\">2.HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols</span><br><span class=\"line\">3.建新目錄TLS 1.0，下面再建Client和Server，各別新增2個 DWORD </span><br><span class=\"line\">  --DisabledByDefault  (值設為0)</span><br><span class=\"line\">  --Enabled  (值設為1)</span><br><span class=\"line\">4.重開OS後，用powershell進行檢查</span><br><span class=\"line\">Get-ItemProperty -Path &quot;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Client&quot; -Name DisabledByDefault</span><br><span class=\"line\">Get-ItemProperty -Path &quot;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server&quot; -Name DisabledByDefault</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<hr>\n<h2 id=\"Windows-FailOver-Cluster留意事項\"><a href=\"#Windows-FailOver-Cluster留意事項\" class=\"headerlink\" title=\"Windows FailOver Cluster留意事項\"></a>Windows FailOver Cluster留意事項</h2><h3 id=\"設定Quorum-Disk-仲裁磁碟\"><a href=\"#設定Quorum-Disk-仲裁磁碟\" class=\"headerlink\" title=\"設定Quorum Disk(仲裁磁碟)\"></a>設定Quorum Disk(仲裁磁碟)</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816546.png\" alt=\"image-20230219222207793\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816583.png\" alt=\"image-20230219222254144\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816669.png\" alt=\"image-20230219222429300\"></p>\n<p>選擇那個硬碟要當仲裁磁碟</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816710.png\" alt=\"image-20230219222509987\"></p>\n<p>沒錯誤的話，應該會是Disk Witness in Quorum</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230219_1676816796.png\" alt=\"image-20230219222636220\"></p>\n<hr>\n<h2 id=\"SQL-FailOver-Cluster錯誤處理\"><a href=\"#SQL-FailOver-Cluster錯誤處理\" class=\"headerlink\" title=\"SQL FailOver Cluster錯誤處理\"></a>SQL FailOver Cluster錯誤處理</h2><h3 id=\"多張網卡\"><a href=\"#多張網卡\" class=\"headerlink\" title=\"多張網卡\"></a>多張網卡</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677078814.png\" alt=\"image-20230222231334277\"></p>\n<blockquote>\n<p>設定網卡只留一個cluster and client在除錯上會容易很多</p>\n</blockquote>\n<h3 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677079083.png\" alt=\"image-20230222231803452\"></p>\n<blockquote>\n<p>1.安裝windows failover cluster 的帳號要有異動dns和查詢node主機資源的權限，用較大的權限建立避免一些權限問題</p>\n<p>2.當windows/sql 的 failover cluster的vip無法自動建立在dns裏時，可手動補建。相對來說，如有產生錯誤的dns記錄的話，直接手動刪除就可以</p>\n<p>3.node主機網卡的第一個dns ip建議寫網域的</p>\n</blockquote>\n<h3 id=\"Remote-Registry-權限\"><a href=\"#Remote-Registry-權限\" class=\"headerlink\" title=\"Remote Registry 權限\"></a>Remote Registry 權限</h3><blockquote>\n<p>Run wmimgmt.msc</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677161946.png\" alt=\"image-20230223221906009\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162135.png\" alt=\"image-20230223222215469\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162243.png\" alt=\"image-20230223222403422\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162311.png\" alt=\"image-20230223222511496\"></p>\n<h3 id=\"DCOM-權限\"><a href=\"#DCOM-權限\" class=\"headerlink\" title=\"DCOM 權限\"></a>DCOM 權限</h3><blockquote>\n<p>Run dcomcnfg</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162648.png\" alt=\"image-20230223223048305\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162760.png\" alt=\"image-20230223223240744\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677162811.png\" alt=\"image-20230223223331758\"></p>\n<h3 id=\"WMI-權限\"><a href=\"#WMI-權限\" class=\"headerlink\" title=\"WMI 權限\"></a>WMI 權限</h3><blockquote>\n<p>Run dcomcnfg</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163154.png\" alt=\"image-20230223223914623\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163644.png\" alt=\"image-20230223224057210\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163396.png\" alt=\"image-20230223224316383\"></p>\n<h3 id=\"修正SQL-Server-Agent是null的情況\"><a href=\"#修正SQL-Server-Agent是null的情況\" class=\"headerlink\" title=\"修正SQL Server Agent是null的情況\"></a>修正SQL Server Agent是null的情況</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677164904.png\" alt=\"image-20230223230823870\"></p>\n<h4 id=\"PowerShell\"><a href=\"#PowerShell\" class=\"headerlink\" title=\"PowerShell\"></a>PowerShell</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ClusterName = &quot;sqlcluster&quot;</span><br><span class=\"line\">$FciClusterGroupName = &quot;SQL Server (MSSQLSERVER)&quot;</span><br><span class=\"line\">Add-ClusterResourceType -Name &quot;SQL Server Agent&quot; -Dll &quot;sqagtres.dll&quot; </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165290.png\" alt=\"image-20230223231450729\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677165408.png\" alt=\"image-20230223231647851\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166783.png\" alt=\"image-20230223233943452\"></p>\n<h4 id=\"SQL-Server-Agent進行配置\"><a href=\"#SQL-Server-Agent進行配置\" class=\"headerlink\" title=\"SQL Server Agent進行配置\"></a>SQL Server Agent進行配置</h4><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166824.png\" alt=\"image-20230223234023893\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677166863.png\" alt=\"image-20230223234103405\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167958.png\" alt=\"image-20230223235918061\"></p>\n<p>重起SQL FailOver Cluster後再用SSMS試看看能否正常登入DB</p>\n<h2 id=\"Add-Node-to-SQL-FailOver-Cluster不知的錯誤\"><a href=\"#Add-Node-to-SQL-FailOver-Cluster不知的錯誤\" class=\"headerlink\" title=\"Add Node to SQL FailOver Cluster不知的錯誤\"></a>Add Node to SQL FailOver Cluster不知的錯誤</h2><blockquote>\n<p>遇到該檢查和確認的都沒問題，但就是在安裝過程中出現錯誤，試的檢查 regedit : Primary DB主機，這些參數都要為1</p>\n</blockquote>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167755.png\" alt=\"image-20230223235555095\"></p>\n<hr>\n<h2 id=\"SQL-FailOver-Cluster安裝\"><a href=\"#SQL-FailOver-Cluster安裝\" class=\"headerlink\" title=\"SQL FailOver Cluster安裝\"></a>SQL FailOver Cluster安裝</h2><h3 id=\"Node-A\"><a href=\"#Node-A\" class=\"headerlink\" title=\"Node A\"></a>Node A</h3><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899515.png\" alt=\"image-20230220212455255\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899539.png\" alt=\"image-20230220212522748\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899554.png\" alt=\"image-20230220212553903\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676899600.png\" alt=\"image-20230220212640200\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903422.png\" alt=\"image-20230220223021981\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903495.png\" alt=\"image-20230220223135663\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903529.png\" alt=\"image-20230220223208973\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903611.png\" alt=\"image-20230220223331211\"></p>\n<p>我網卡沒配置好，不然應該是要設成固定IP較佳</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903634.png\" alt=\"image-20230220223353803\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903732.png\" alt=\"image-20230220223532356\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903783.png\" alt=\"image-20230220223623645\"></p>\n<p>Share Disk</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903833.png\" alt=\"image-20230220223713560\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903883.png\" alt=\"image-20230220223803736\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903936.png\" alt=\"image-20230220223856159\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676903969.png\" alt=\"image-20230220223929225\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230220_1676905003.png\" alt=\"image-20230220225643580\"></p>\n<blockquote>\n<p>可先建立起後，再進windows failover cluster manager進行重新檢查sql failover cluster無法起動的原因</p>\n<p>檢查:TLS支援度、各node、vip 主機名稱在DNS裏是不是正確、防火牆、起動sql服務的ad帳號權限是否有node主機的administrator權限</p>\n</blockquote>\n<h3 id=\"Node-B\"><a href=\"#Node-B\" class=\"headerlink\" title=\"Node B\"></a>Node B</h3><p>新增node到sql failover cluster</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080612.png\" alt=\"image-20230222234331936\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080642.png\" alt=\"image-20230222234401864\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080660.png\" alt=\"image-20230222234420672\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230222_1677080679.png\" alt=\"image-20230222234439731\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163709.png\" alt=\"image-20230223224829524\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163787.png\" alt=\"image-20230223224932838\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677163826.png\" alt=\"image-20230223225026687\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230223_1677167405.png\" alt=\"image-20230223235005122\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168121.png\" alt=\"image-20230224000200930\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168557.png\" alt=\"image-20230224000917091\"></p>\n<p>重起原本的primdy db主機後，可以在另一台主機看到已正確接手</p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168797.png\" alt=\"image-20230224001317302\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230224_1677168807.png\" alt=\"image-20230224001327038\"></p>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論:\"></a>結論:</h2><blockquote>\n<p>1.安裝SQL的主機權限要額外設定，不然就算用Administrator安裝也一樣報錯</p>\n<p>2.DCOM的權限是跟SSIS有關</p>\n<p>3.WMI和Reomte Registry的權限問題是有關連的，要一併處理</p>\n<p>4.FailOver Cluster的價錢比AlwaysOn便宜，並且無AlwaysOn切換時有資料不一致問題。如Storage有保護機制的，FailOver Cluster也不是無法使用的HA方案</p>\n</blockquote>"},{"title":"安裝多個MariaDB在同台主機上","date":"2023-02-07T15:02:36.000Z","_content":"\n安裝多個MariaDB在同台主機上\n\n<!--more-->\n\n待\n","source":"_posts/mariadb-multiple-install.md","raw":"---\ntitle: 安裝多個MariaDB在同台主機上\ndate: 2023-02-07 23:02:36\ntags:\n- [Install]\ncategories:\n- [MariaDB]\n---\n\n安裝多個MariaDB在同台主機上\n\n<!--more-->\n\n待\n","slug":"mariadb-multiple-install","published":1,"updated":"2023-02-19T14:31:48.281Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm6z0012rcu36a2a6han","content":"<p>安裝多個MariaDB在同台主機上</p>\n<span id=\"more\"></span>\n\n<p>待</p>\n","site":{"data":{}},"excerpt":"<p>安裝多個MariaDB在同台主機上</p>","more":"<p>待</p>"},{"title":"oracle19c_auto_index","date":"2023-02-12T10:39:02.000Z","_content":"\nOracle 19c 新功能 : index 自動建立 (SQL Server早就有.....)\n\n<!--more-->\n\n## Exadate的功能，一般Oracle要自行開起\n\n![image-20230212184248797](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200123.png)\n\n\n\n\n\n![image-20230212184342490](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200363.png)\n\n\n\n\n\n## 設定存放Index的Tablespace\n\n![image-20230212184445846](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200130.png)\n\n\n\n\n\n## 指定那個schema生效，預設是全帳的schema\n\n![image-20230212184520235](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200141.png)\n\n\n\n\n\n## 可設定index自動維護是否關畢、產出建議、立即生效\n\n![image-20230212184551105](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200146.png)\n\n> auto_index_retention_for_manual : 設定手動建立的index是否也要納入自動管理，也就手動建立的index可能因為很久沒有使用到，將會被自動刪除。預設是不納入自動管理\n\n\n\n\n\n## 相關的view\n\n![image-20230212184641019](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200151.png)\n\n\n\n\n\n## 查看report\n\n![image-20230212184706042](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200155.png)\n\n\n\n> SET SERVEROUTPUT ON SIZE 1000000\n> declare \n>   num number := 1;\n>   v_object_id number;\n> begin\n>   while num <= 500\n>   loop    \n>     select object_id into v_object_id from tts_binhu.auto_idx_test where object_id=trunc(dbms_random.value(0,10000));\n>     dbms_output.put_line('v_object_id:'||nvl(v_object_id,0));\n>     num := num + 1;\n>   end loop;\n> end;\n>\n> select * from dba_indexes where owner ='TTS_BINHU' and table_name='AUTO_IDX_TEST'\n\n\n\n------\n\n\n\n## 測試\n\n![image-20230212184812670](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200161.png)\n\n\n\n## SELECT DBMS_AUTO_INDEX.report_activity() FROM dual;\n\n```\nGENERAL INFORMATION\n-------------------------------------------------------------------------------\n Activity start               : 29-10月-2019 14:29:44 \n Activity end                 : 30-10月-2019 14:29:44 \n Executions completed         : 3                    \n Executions interrupted       : 0                    \n Executions with fatal error  : 0                    \n-------------------------------------------------------------------------------\n\nSUMMARY (AUTO INDEXES)\n-------------------------------------------------------------------------------\n Index candidates                              : 2                       \n Indexes created (visible / invisible)         : 2 (2 / 0)               \n Space used (visible / invisible)              : 7.34 MB (7.34 MB / 0 B) \n Indexes dropped                               : 0                       \n SQL statements verified                       : 6                       \n SQL statements improved (improvement factor)  : 5 (1419.1x)             \n SQL plan baselines created                    : 0                       \n Overall improvement factor                    : 1183x                   \n-------------------------------------------------------------------------------\n\nSUMMARY (MANUAL INDEXES)\n-------------------------------------------------------------------------------\n Unused indexes    : 0   \n Space used        : 0 B \n Unusable indexes  : 0   \n-------------------------------------------------------------------------------\n\nINDEX DETAILS\n-------------------------------------------------------------------------------\n1. The following indexes were created:\n-------------------------------------------------------------------------------\n----------------------------------------------------------------------------------------------------\n| Owner     | Table         | Index                | Key                     | Type   | Properties |\n----------------------------------------------------------------------------------------------------\n| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_0nfqz048chrwz | OBJECT_ID               | B-TREE | NONE       |\n| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_5afppmx4u3fjp | OBJECT_NAME,OBJECT_TYPE | B-TREE | NONE       |\n----------------------------------------------------------------------------------------------------\n-------------------------------------------------------------------------------\n\nVERIFICATION DETAILS\n-------------------------------------------------------------------------------\n1. The performance of the following statements improved:\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : 6h02v1c3jm99z                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where object_name \n                      = 'AUTO_IDX_TEST' and object_type='TABLE'                 \n Improvement Factor   : 1423.7x                                                 \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  715640                        36386                        \n CPU Time (s):      492167                        127                          \n Buffer Gets:       59872                         3                            \n Optimizer Cost:    395                           4                            \n Disk Reads:        1422                          2                            \n Direct Writes:     0                             0                            \n Rows Processed:    0                             0                            \n Executions:        42                            1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  395 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 1880695109 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    4 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    4 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_NAME\"='AUTO_IDX_TEST' AND \"OBJECT_TYPE\"='TABLE')\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : 6mmkppzn4pyd8                                           \n SQL Text             : SELECT OBJECT_ID FROM TTS_BINHU.AUTO_IDX_TEST WHERE     \n                      OBJECT_ID=TRUNC(DBMS_RANDOM.VALUE(0,10000))               \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  720172                        22908                        \n CPU Time (s):      717822                        9823                         \n Buffer Gets:       2838                          2                            \n Optimizer Cost:    412                           1                            \n Disk Reads:        0                             1                            \n Direct Writes:     0                             0                            \n Rows Processed:    1                             1                            \n Executions:        2                             1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  412 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |     5 |  412 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 252073491 \n\n------------------------------------------------------------------------------------\n| Id  | Operation          | Name                 | Rows | Bytes | Cost | Time     |\n------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT   |                      |    1 |     5 |    1 | 00:00:01 |\n| * 1 |   INDEX RANGE SCAN | SYS_AI_0nfqz048chrwz |    1 |     5 |    1 | 00:00:01 |\n------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 1 - access(\"OBJECT_ID\"=TRUNC(\"DBMS_RANDOM\".\"VALUE\"(0,10000)))\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : acdnsvfpdjnw0                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where object_name \n                      = 'MV_WH_COMPANY' and object_type='TABLE'                 \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  535958                        874                          \n CPU Time (s):      469385                        0                            \n Buffer Gets:       60976                         4                            \n Optimizer Cost:    395                           4                            \n Disk Reads:        0                             1                            \n Direct Writes:     0                             0                            \n Rows Processed:    43                            1                            \n Executions:        43                            1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  395 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 1880695109 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    2 |   264 |    4 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    2 |   264 |    4 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_NAME\"='MV_WH_COMPANY' AND \"OBJECT_TYPE\"='TABLE')\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : c3c69a1dkwucj                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where             \n                      object_id=trunc(dbms_random.value(0,10000))               \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  397948                        17176                        \n CPU Time (s):      397844                        158                          \n Buffer Gets:       1420                          3                            \n Optimizer Cost:    412                           2                            \n Disk Reads:        0                             7                            \n Direct Writes:     0                             0                            \n Rows Processed:    2                             1                            \n Executions:        1                             1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  412 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 3717726382 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_ID\"=TRUNC(\"DBMS_RANDOM\".\"VALUE\"(0,10000)))\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : dt1tymnjfa8m6                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where             \n                      object_id=trunc(dbms_random.value(0,10000))               \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  5006616                       190                          \n CPU Time (s):      4992671                       190                          \n Buffer Gets:       17018                         3                            \n Optimizer Cost:    412                           2                            \n Disk Reads:        0                             0                            \n Direct Writes:     0                             0                            \n Rows Processed:    9                             1                            \n Executions:        12                            1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  412 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 3717726382 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_ID\"=TRUNC(\"DBMS_RANDOM\".\"VALUE\"(0,10000)))\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n-------------------------------------------------------------------------------\n\nERRORS\n---------------------------------------------------------------------------------------------\nNo errors found.\n---------------------------------------------------------------------------------------------\n\n```\n\n\n\n\n\n## 刪除自動建立的index\n\n![image-20230212185015654](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200169.png)\n\n> 無法直接刪除\n\n\n\n\n\n## 更新狀態由Auto由Yes->No\n\n![image-20230212185212945](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200178.png)\n\n\n\n\n\n## 刪除Index Name有區分大小寫\n\n![image-20230212185256081](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200202.png)\n\n\n\n\n\n## 結論\n\n> 1.測試的DB版本:Oracle 19c\n>\n> 2.自動建立index不支援function/partition table\n","source":"_posts/oracle19c-auto-index.md","raw":"---\ntitle: oracle19c_auto_index\ndate: 2023-02-12 18:39:02\ntags:\n- [PerformanceTuning]\ncategories:\n- [Oracle]\n- [Oracle19c]\n---\n\nOracle 19c 新功能 : index 自動建立 (SQL Server早就有.....)\n\n<!--more-->\n\n## Exadate的功能，一般Oracle要自行開起\n\n![image-20230212184248797](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200123.png)\n\n\n\n\n\n![image-20230212184342490](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200363.png)\n\n\n\n\n\n## 設定存放Index的Tablespace\n\n![image-20230212184445846](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200130.png)\n\n\n\n\n\n## 指定那個schema生效，預設是全帳的schema\n\n![image-20230212184520235](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200141.png)\n\n\n\n\n\n## 可設定index自動維護是否關畢、產出建議、立即生效\n\n![image-20230212184551105](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200146.png)\n\n> auto_index_retention_for_manual : 設定手動建立的index是否也要納入自動管理，也就手動建立的index可能因為很久沒有使用到，將會被自動刪除。預設是不納入自動管理\n\n\n\n\n\n## 相關的view\n\n![image-20230212184641019](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200151.png)\n\n\n\n\n\n## 查看report\n\n![image-20230212184706042](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200155.png)\n\n\n\n> SET SERVEROUTPUT ON SIZE 1000000\n> declare \n>   num number := 1;\n>   v_object_id number;\n> begin\n>   while num <= 500\n>   loop    \n>     select object_id into v_object_id from tts_binhu.auto_idx_test where object_id=trunc(dbms_random.value(0,10000));\n>     dbms_output.put_line('v_object_id:'||nvl(v_object_id,0));\n>     num := num + 1;\n>   end loop;\n> end;\n>\n> select * from dba_indexes where owner ='TTS_BINHU' and table_name='AUTO_IDX_TEST'\n\n\n\n------\n\n\n\n## 測試\n\n![image-20230212184812670](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200161.png)\n\n\n\n## SELECT DBMS_AUTO_INDEX.report_activity() FROM dual;\n\n```\nGENERAL INFORMATION\n-------------------------------------------------------------------------------\n Activity start               : 29-10月-2019 14:29:44 \n Activity end                 : 30-10月-2019 14:29:44 \n Executions completed         : 3                    \n Executions interrupted       : 0                    \n Executions with fatal error  : 0                    \n-------------------------------------------------------------------------------\n\nSUMMARY (AUTO INDEXES)\n-------------------------------------------------------------------------------\n Index candidates                              : 2                       \n Indexes created (visible / invisible)         : 2 (2 / 0)               \n Space used (visible / invisible)              : 7.34 MB (7.34 MB / 0 B) \n Indexes dropped                               : 0                       \n SQL statements verified                       : 6                       \n SQL statements improved (improvement factor)  : 5 (1419.1x)             \n SQL plan baselines created                    : 0                       \n Overall improvement factor                    : 1183x                   \n-------------------------------------------------------------------------------\n\nSUMMARY (MANUAL INDEXES)\n-------------------------------------------------------------------------------\n Unused indexes    : 0   \n Space used        : 0 B \n Unusable indexes  : 0   \n-------------------------------------------------------------------------------\n\nINDEX DETAILS\n-------------------------------------------------------------------------------\n1. The following indexes were created:\n-------------------------------------------------------------------------------\n----------------------------------------------------------------------------------------------------\n| Owner     | Table         | Index                | Key                     | Type   | Properties |\n----------------------------------------------------------------------------------------------------\n| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_0nfqz048chrwz | OBJECT_ID               | B-TREE | NONE       |\n| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_5afppmx4u3fjp | OBJECT_NAME,OBJECT_TYPE | B-TREE | NONE       |\n----------------------------------------------------------------------------------------------------\n-------------------------------------------------------------------------------\n\nVERIFICATION DETAILS\n-------------------------------------------------------------------------------\n1. The performance of the following statements improved:\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : 6h02v1c3jm99z                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where object_name \n                      = 'AUTO_IDX_TEST' and object_type='TABLE'                 \n Improvement Factor   : 1423.7x                                                 \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  715640                        36386                        \n CPU Time (s):      492167                        127                          \n Buffer Gets:       59872                         3                            \n Optimizer Cost:    395                           4                            \n Disk Reads:        1422                          2                            \n Direct Writes:     0                             0                            \n Rows Processed:    0                             0                            \n Executions:        42                            1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  395 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 1880695109 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    4 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    4 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_NAME\"='AUTO_IDX_TEST' AND \"OBJECT_TYPE\"='TABLE')\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : 6mmkppzn4pyd8                                           \n SQL Text             : SELECT OBJECT_ID FROM TTS_BINHU.AUTO_IDX_TEST WHERE     \n                      OBJECT_ID=TRUNC(DBMS_RANDOM.VALUE(0,10000))               \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  720172                        22908                        \n CPU Time (s):      717822                        9823                         \n Buffer Gets:       2838                          2                            \n Optimizer Cost:    412                           1                            \n Disk Reads:        0                             1                            \n Direct Writes:     0                             0                            \n Rows Processed:    1                             1                            \n Executions:        2                             1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  412 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |     5 |  412 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 252073491 \n\n------------------------------------------------------------------------------------\n| Id  | Operation          | Name                 | Rows | Bytes | Cost | Time     |\n------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT   |                      |    1 |     5 |    1 | 00:00:01 |\n| * 1 |   INDEX RANGE SCAN | SYS_AI_0nfqz048chrwz |    1 |     5 |    1 | 00:00:01 |\n------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 1 - access(\"OBJECT_ID\"=TRUNC(\"DBMS_RANDOM\".\"VALUE\"(0,10000)))\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : acdnsvfpdjnw0                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where object_name \n                      = 'MV_WH_COMPANY' and object_type='TABLE'                 \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  535958                        874                          \n CPU Time (s):      469385                        0                            \n Buffer Gets:       60976                         4                            \n Optimizer Cost:    395                           4                            \n Disk Reads:        0                             1                            \n Direct Writes:     0                             0                            \n Rows Processed:    43                            1                            \n Executions:        43                            1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  395 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 1880695109 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    2 |   264 |    4 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    2 |   264 |    4 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_NAME\"='MV_WH_COMPANY' AND \"OBJECT_TYPE\"='TABLE')\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : c3c69a1dkwucj                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where             \n                      object_id=trunc(dbms_random.value(0,10000))               \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  397948                        17176                        \n CPU Time (s):      397844                        158                          \n Buffer Gets:       1420                          3                            \n Optimizer Cost:    412                           2                            \n Disk Reads:        0                             7                            \n Direct Writes:     0                             0                            \n Rows Processed:    2                             1                            \n Executions:        1                             1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  412 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 3717726382 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_ID\"=TRUNC(\"DBMS_RANDOM\".\"VALUE\"(0,10000)))\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n Parsing Schema Name  : SYS                                                     \n SQL ID               : dt1tymnjfa8m6                                           \n SQL Text             : select * from tts_binhu.auto_idx_test where             \n                      object_id=trunc(dbms_random.value(0,10000))               \n Improvement Factor   : 1418x                                                   \n\nExecution Statistics:\n-----------------------------\n                    Original Plan                 Auto Index Plan              \n                    ----------------------------  ---------------------------- \n Elapsed Time (s):  5006616                       190                          \n CPU Time (s):      4992671                       190                          \n Buffer Gets:       17018                         3                            \n Optimizer Cost:    412                           2                            \n Disk Reads:        0                             0                            \n Direct Writes:     0                             0                            \n Rows Processed:    9                             1                            \n Executions:        12                            1                            \n\n\nPLANS SECTION\n---------------------------------------------------------------------------------------------\n\n- Original\n-----------------------------\n Plan Hash Value  : 3956758376 \n\n-----------------------------------------------------------------------------\n| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |\n-----------------------------------------------------------------------------\n|  0 | SELECT STATEMENT    |               |      |       |  412 |          |\n|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |\n-----------------------------------------------------------------------------\n\n- With Auto Indexes\n-----------------------------\n Plan Hash Value  : 3717726382 \n\n-------------------------------------------------------------------------------------------------------\n| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |\n-------------------------------------------------------------------------------------------------------\n|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |\n|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |\n| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |\n-------------------------------------------------------------------------------------------------------\n\nPredicate Information (identified by operation id):\n------------------------------------------\n* 2 - access(\"OBJECT_ID\"=TRUNC(\"DBMS_RANDOM\".\"VALUE\"(0,10000)))\n\n\nNotes\n-----\n- Dynamic sampling used for this statement ( level = 11 )\n\n\n-------------------------------------------------------------------------------\n-------------------------------------------------------------------------------\n\nERRORS\n---------------------------------------------------------------------------------------------\nNo errors found.\n---------------------------------------------------------------------------------------------\n\n```\n\n\n\n\n\n## 刪除自動建立的index\n\n![image-20230212185015654](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200169.png)\n\n> 無法直接刪除\n\n\n\n\n\n## 更新狀態由Auto由Yes->No\n\n![image-20230212185212945](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200178.png)\n\n\n\n\n\n## 刪除Index Name有區分大小寫\n\n![image-20230212185256081](https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200202.png)\n\n\n\n\n\n## 結論\n\n> 1.測試的DB版本:Oracle 19c\n>\n> 2.自動建立index不支援function/partition table\n","slug":"oracle19c-auto-index","published":1,"updated":"2023-02-19T14:32:58.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm700015rcu3gp5hfwr9","content":"<p>Oracle 19c 新功能 : index 自動建立 (SQL Server早就有…..)</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Exadate的功能，一般Oracle要自行開起\"><a href=\"#Exadate的功能，一般Oracle要自行開起\" class=\"headerlink\" title=\"Exadate的功能，一般Oracle要自行開起\"></a>Exadate的功能，一般Oracle要自行開起</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200123.png\" alt=\"image-20230212184248797\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200363.png\" alt=\"image-20230212184342490\"></p>\n<h2 id=\"設定存放Index的Tablespace\"><a href=\"#設定存放Index的Tablespace\" class=\"headerlink\" title=\"設定存放Index的Tablespace\"></a>設定存放Index的Tablespace</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200130.png\" alt=\"image-20230212184445846\"></p>\n<h2 id=\"指定那個schema生效，預設是全帳的schema\"><a href=\"#指定那個schema生效，預設是全帳的schema\" class=\"headerlink\" title=\"指定那個schema生效，預設是全帳的schema\"></a>指定那個schema生效，預設是全帳的schema</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200141.png\" alt=\"image-20230212184520235\"></p>\n<h2 id=\"可設定index自動維護是否關畢、產出建議、立即生效\"><a href=\"#可設定index自動維護是否關畢、產出建議、立即生效\" class=\"headerlink\" title=\"可設定index自動維護是否關畢、產出建議、立即生效\"></a>可設定index自動維護是否關畢、產出建議、立即生效</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200146.png\" alt=\"image-20230212184551105\"></p>\n<blockquote>\n<p>auto_index_retention_for_manual : 設定手動建立的index是否也要納入自動管理，也就手動建立的index可能因為很久沒有使用到，將會被自動刪除。預設是不納入自動管理</p>\n</blockquote>\n<h2 id=\"相關的view\"><a href=\"#相關的view\" class=\"headerlink\" title=\"相關的view\"></a>相關的view</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200151.png\" alt=\"image-20230212184641019\"></p>\n<h2 id=\"查看report\"><a href=\"#查看report\" class=\"headerlink\" title=\"查看report\"></a>查看report</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200155.png\" alt=\"image-20230212184706042\"></p>\n<blockquote>\n<p>SET SERVEROUTPUT ON SIZE 1000000<br>declare<br>  num number := 1;<br>  v_object_id number;<br>begin<br>  while num &lt;= 500<br>  loop<br>    select object_id into v_object_id from tts_binhu.auto_idx_test where object_id=trunc(dbms_random.value(0,10000));<br>    dbms_output.put_line(‘v_object_id:’||nvl(v_object_id,0));<br>    num := num + 1;<br>  end loop;<br>end;</p>\n<p>select * from dba_indexes where owner =’TTS_BINHU’ and table_name=’AUTO_IDX_TEST’</p>\n</blockquote>\n<hr>\n<h2 id=\"測試\"><a href=\"#測試\" class=\"headerlink\" title=\"測試\"></a>測試</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200161.png\" alt=\"image-20230212184812670\"></p>\n<h2 id=\"SELECT-DBMS-AUTO-INDEX-report-activity-FROM-dual\"><a href=\"#SELECT-DBMS-AUTO-INDEX-report-activity-FROM-dual\" class=\"headerlink\" title=\"SELECT DBMS_AUTO_INDEX.report_activity() FROM dual;\"></a>SELECT DBMS_AUTO_INDEX.report_activity() FROM dual;</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GENERAL INFORMATION</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Activity start               : 29-10月-2019 14:29:44 </span><br><span class=\"line\"> Activity end                 : 30-10月-2019 14:29:44 </span><br><span class=\"line\"> Executions completed         : 3                    </span><br><span class=\"line\"> Executions interrupted       : 0                    </span><br><span class=\"line\"> Executions with fatal error  : 0                    </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">SUMMARY (AUTO INDEXES)</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Index candidates                              : 2                       </span><br><span class=\"line\"> Indexes created (visible / invisible)         : 2 (2 / 0)               </span><br><span class=\"line\"> Space used (visible / invisible)              : 7.34 MB (7.34 MB / 0 B) </span><br><span class=\"line\"> Indexes dropped                               : 0                       </span><br><span class=\"line\"> SQL statements verified                       : 6                       </span><br><span class=\"line\"> SQL statements improved (improvement factor)  : 5 (1419.1x)             </span><br><span class=\"line\"> SQL plan baselines created                    : 0                       </span><br><span class=\"line\"> Overall improvement factor                    : 1183x                   </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">SUMMARY (MANUAL INDEXES)</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Unused indexes    : 0   </span><br><span class=\"line\"> Space used        : 0 B </span><br><span class=\"line\"> Unusable indexes  : 0   </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">INDEX DETAILS</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">1. The following indexes were created:</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">----------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Owner     | Table         | Index                | Key                     | Type   | Properties |</span><br><span class=\"line\">----------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_0nfqz048chrwz | OBJECT_ID               | B-TREE | NONE       |</span><br><span class=\"line\">| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_5afppmx4u3fjp | OBJECT_NAME,OBJECT_TYPE | B-TREE | NONE       |</span><br><span class=\"line\">----------------------------------------------------------------------------------------------------</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">VERIFICATION DETAILS</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">1. The performance of the following statements improved:</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : 6h02v1c3jm99z                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where object_name </span><br><span class=\"line\">                      = &#x27;AUTO_IDX_TEST&#x27; and object_type=&#x27;TABLE&#x27;                 </span><br><span class=\"line\"> Improvement Factor   : 1423.7x                                                 </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  715640                        36386                        </span><br><span class=\"line\"> CPU Time (s):      492167                        127                          </span><br><span class=\"line\"> Buffer Gets:       59872                         3                            </span><br><span class=\"line\"> Optimizer Cost:    395                           4                            </span><br><span class=\"line\"> Disk Reads:        1422                          2                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    0                             0                            </span><br><span class=\"line\"> Executions:        42                            1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  395 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 1880695109 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    4 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    4 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_NAME&quot;=&#x27;AUTO_IDX_TEST&#x27; AND &quot;OBJECT_TYPE&quot;=&#x27;TABLE&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : 6mmkppzn4pyd8                                           </span><br><span class=\"line\"> SQL Text             : SELECT OBJECT_ID FROM TTS_BINHU.AUTO_IDX_TEST WHERE     </span><br><span class=\"line\">                      OBJECT_ID=TRUNC(DBMS_RANDOM.VALUE(0,10000))               </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  720172                        22908                        </span><br><span class=\"line\"> CPU Time (s):      717822                        9823                         </span><br><span class=\"line\"> Buffer Gets:       2838                          2                            </span><br><span class=\"line\"> Optimizer Cost:    412                           1                            </span><br><span class=\"line\"> Disk Reads:        0                             1                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    1                             1                            </span><br><span class=\"line\"> Executions:        2                             1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  412 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |     5 |  412 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 252073491 </span><br><span class=\"line\"></span><br><span class=\"line\">------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation          | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT   |                      |    1 |     5 |    1 | 00:00:01 |</span><br><span class=\"line\">| * 1 |   INDEX RANGE SCAN | SYS_AI_0nfqz048chrwz |    1 |     5 |    1 | 00:00:01 |</span><br><span class=\"line\">------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 1 - access(&quot;OBJECT_ID&quot;=TRUNC(&quot;DBMS_RANDOM&quot;.&quot;VALUE&quot;(0,10000)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : acdnsvfpdjnw0                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where object_name </span><br><span class=\"line\">                      = &#x27;MV_WH_COMPANY&#x27; and object_type=&#x27;TABLE&#x27;                 </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  535958                        874                          </span><br><span class=\"line\"> CPU Time (s):      469385                        0                            </span><br><span class=\"line\"> Buffer Gets:       60976                         4                            </span><br><span class=\"line\"> Optimizer Cost:    395                           4                            </span><br><span class=\"line\"> Disk Reads:        0                             1                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    43                            1                            </span><br><span class=\"line\"> Executions:        43                            1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  395 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 1880695109 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    2 |   264 |    4 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    2 |   264 |    4 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_NAME&quot;=&#x27;MV_WH_COMPANY&#x27; AND &quot;OBJECT_TYPE&quot;=&#x27;TABLE&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : c3c69a1dkwucj                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where             </span><br><span class=\"line\">                      object_id=trunc(dbms_random.value(0,10000))               </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  397948                        17176                        </span><br><span class=\"line\"> CPU Time (s):      397844                        158                          </span><br><span class=\"line\"> Buffer Gets:       1420                          3                            </span><br><span class=\"line\"> Optimizer Cost:    412                           2                            </span><br><span class=\"line\"> Disk Reads:        0                             7                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    2                             1                            </span><br><span class=\"line\"> Executions:        1                             1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  412 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3717726382 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_ID&quot;=TRUNC(&quot;DBMS_RANDOM&quot;.&quot;VALUE&quot;(0,10000)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : dt1tymnjfa8m6                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where             </span><br><span class=\"line\">                      object_id=trunc(dbms_random.value(0,10000))               </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  5006616                       190                          </span><br><span class=\"line\"> CPU Time (s):      4992671                       190                          </span><br><span class=\"line\"> Buffer Gets:       17018                         3                            </span><br><span class=\"line\"> Optimizer Cost:    412                           2                            </span><br><span class=\"line\"> Disk Reads:        0                             0                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    9                             1                            </span><br><span class=\"line\"> Executions:        12                            1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  412 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3717726382 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_ID&quot;=TRUNC(&quot;DBMS_RANDOM&quot;.&quot;VALUE&quot;(0,10000)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">ERRORS</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\">No errors found.</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"刪除自動建立的index\"><a href=\"#刪除自動建立的index\" class=\"headerlink\" title=\"刪除自動建立的index\"></a>刪除自動建立的index</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200169.png\" alt=\"image-20230212185015654\"></p>\n<blockquote>\n<p>無法直接刪除</p>\n</blockquote>\n<h2 id=\"更新狀態由Auto由Yes-gt-No\"><a href=\"#更新狀態由Auto由Yes-gt-No\" class=\"headerlink\" title=\"更新狀態由Auto由Yes-&gt;No\"></a>更新狀態由Auto由Yes-&gt;No</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200178.png\" alt=\"image-20230212185212945\"></p>\n<h2 id=\"刪除Index-Name有區分大小寫\"><a href=\"#刪除Index-Name有區分大小寫\" class=\"headerlink\" title=\"刪除Index Name有區分大小寫\"></a>刪除Index Name有區分大小寫</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200202.png\" alt=\"image-20230212185256081\"></p>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.測試的DB版本:Oracle 19c</p>\n<p>2.自動建立index不支援function/partition table</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>Oracle 19c 新功能 : index 自動建立 (SQL Server早就有…..)</p>","more":"<h2 id=\"Exadate的功能，一般Oracle要自行開起\"><a href=\"#Exadate的功能，一般Oracle要自行開起\" class=\"headerlink\" title=\"Exadate的功能，一般Oracle要自行開起\"></a>Exadate的功能，一般Oracle要自行開起</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200123.png\" alt=\"image-20230212184248797\"></p>\n<p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200363.png\" alt=\"image-20230212184342490\"></p>\n<h2 id=\"設定存放Index的Tablespace\"><a href=\"#設定存放Index的Tablespace\" class=\"headerlink\" title=\"設定存放Index的Tablespace\"></a>設定存放Index的Tablespace</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200130.png\" alt=\"image-20230212184445846\"></p>\n<h2 id=\"指定那個schema生效，預設是全帳的schema\"><a href=\"#指定那個schema生效，預設是全帳的schema\" class=\"headerlink\" title=\"指定那個schema生效，預設是全帳的schema\"></a>指定那個schema生效，預設是全帳的schema</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200141.png\" alt=\"image-20230212184520235\"></p>\n<h2 id=\"可設定index自動維護是否關畢、產出建議、立即生效\"><a href=\"#可設定index自動維護是否關畢、產出建議、立即生效\" class=\"headerlink\" title=\"可設定index自動維護是否關畢、產出建議、立即生效\"></a>可設定index自動維護是否關畢、產出建議、立即生效</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200146.png\" alt=\"image-20230212184551105\"></p>\n<blockquote>\n<p>auto_index_retention_for_manual : 設定手動建立的index是否也要納入自動管理，也就手動建立的index可能因為很久沒有使用到，將會被自動刪除。預設是不納入自動管理</p>\n</blockquote>\n<h2 id=\"相關的view\"><a href=\"#相關的view\" class=\"headerlink\" title=\"相關的view\"></a>相關的view</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200151.png\" alt=\"image-20230212184641019\"></p>\n<h2 id=\"查看report\"><a href=\"#查看report\" class=\"headerlink\" title=\"查看report\"></a>查看report</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200155.png\" alt=\"image-20230212184706042\"></p>\n<blockquote>\n<p>SET SERVEROUTPUT ON SIZE 1000000<br>declare<br>  num number := 1;<br>  v_object_id number;<br>begin<br>  while num &lt;= 500<br>  loop<br>    select object_id into v_object_id from tts_binhu.auto_idx_test where object_id=trunc(dbms_random.value(0,10000));<br>    dbms_output.put_line(‘v_object_id:’||nvl(v_object_id,0));<br>    num := num + 1;<br>  end loop;<br>end;</p>\n<p>select * from dba_indexes where owner =’TTS_BINHU’ and table_name=’AUTO_IDX_TEST’</p>\n</blockquote>\n<hr>\n<h2 id=\"測試\"><a href=\"#測試\" class=\"headerlink\" title=\"測試\"></a>測試</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200161.png\" alt=\"image-20230212184812670\"></p>\n<h2 id=\"SELECT-DBMS-AUTO-INDEX-report-activity-FROM-dual\"><a href=\"#SELECT-DBMS-AUTO-INDEX-report-activity-FROM-dual\" class=\"headerlink\" title=\"SELECT DBMS_AUTO_INDEX.report_activity() FROM dual;\"></a>SELECT DBMS_AUTO_INDEX.report_activity() FROM dual;</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GENERAL INFORMATION</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Activity start               : 29-10月-2019 14:29:44 </span><br><span class=\"line\"> Activity end                 : 30-10月-2019 14:29:44 </span><br><span class=\"line\"> Executions completed         : 3                    </span><br><span class=\"line\"> Executions interrupted       : 0                    </span><br><span class=\"line\"> Executions with fatal error  : 0                    </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">SUMMARY (AUTO INDEXES)</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Index candidates                              : 2                       </span><br><span class=\"line\"> Indexes created (visible / invisible)         : 2 (2 / 0)               </span><br><span class=\"line\"> Space used (visible / invisible)              : 7.34 MB (7.34 MB / 0 B) </span><br><span class=\"line\"> Indexes dropped                               : 0                       </span><br><span class=\"line\"> SQL statements verified                       : 6                       </span><br><span class=\"line\"> SQL statements improved (improvement factor)  : 5 (1419.1x)             </span><br><span class=\"line\"> SQL plan baselines created                    : 0                       </span><br><span class=\"line\"> Overall improvement factor                    : 1183x                   </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">SUMMARY (MANUAL INDEXES)</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Unused indexes    : 0   </span><br><span class=\"line\"> Space used        : 0 B </span><br><span class=\"line\"> Unusable indexes  : 0   </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">INDEX DETAILS</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">1. The following indexes were created:</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">----------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Owner     | Table         | Index                | Key                     | Type   | Properties |</span><br><span class=\"line\">----------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_0nfqz048chrwz | OBJECT_ID               | B-TREE | NONE       |</span><br><span class=\"line\">| TTS_BINHU | AUTO_IDX_TEST | SYS_AI_5afppmx4u3fjp | OBJECT_NAME,OBJECT_TYPE | B-TREE | NONE       |</span><br><span class=\"line\">----------------------------------------------------------------------------------------------------</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">VERIFICATION DETAILS</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">1. The performance of the following statements improved:</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : 6h02v1c3jm99z                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where object_name </span><br><span class=\"line\">                      = &#x27;AUTO_IDX_TEST&#x27; and object_type=&#x27;TABLE&#x27;                 </span><br><span class=\"line\"> Improvement Factor   : 1423.7x                                                 </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  715640                        36386                        </span><br><span class=\"line\"> CPU Time (s):      492167                        127                          </span><br><span class=\"line\"> Buffer Gets:       59872                         3                            </span><br><span class=\"line\"> Optimizer Cost:    395                           4                            </span><br><span class=\"line\"> Disk Reads:        1422                          2                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    0                             0                            </span><br><span class=\"line\"> Executions:        42                            1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  395 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 1880695109 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    4 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    4 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_NAME&quot;=&#x27;AUTO_IDX_TEST&#x27; AND &quot;OBJECT_TYPE&quot;=&#x27;TABLE&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : 6mmkppzn4pyd8                                           </span><br><span class=\"line\"> SQL Text             : SELECT OBJECT_ID FROM TTS_BINHU.AUTO_IDX_TEST WHERE     </span><br><span class=\"line\">                      OBJECT_ID=TRUNC(DBMS_RANDOM.VALUE(0,10000))               </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  720172                        22908                        </span><br><span class=\"line\"> CPU Time (s):      717822                        9823                         </span><br><span class=\"line\"> Buffer Gets:       2838                          2                            </span><br><span class=\"line\"> Optimizer Cost:    412                           1                            </span><br><span class=\"line\"> Disk Reads:        0                             1                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    1                             1                            </span><br><span class=\"line\"> Executions:        2                             1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  412 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |     5 |  412 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 252073491 </span><br><span class=\"line\"></span><br><span class=\"line\">------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation          | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT   |                      |    1 |     5 |    1 | 00:00:01 |</span><br><span class=\"line\">| * 1 |   INDEX RANGE SCAN | SYS_AI_0nfqz048chrwz |    1 |     5 |    1 | 00:00:01 |</span><br><span class=\"line\">------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 1 - access(&quot;OBJECT_ID&quot;=TRUNC(&quot;DBMS_RANDOM&quot;.&quot;VALUE&quot;(0,10000)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : acdnsvfpdjnw0                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where object_name </span><br><span class=\"line\">                      = &#x27;MV_WH_COMPANY&#x27; and object_type=&#x27;TABLE&#x27;                 </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  535958                        874                          </span><br><span class=\"line\"> CPU Time (s):      469385                        0                            </span><br><span class=\"line\"> Buffer Gets:       60976                         4                            </span><br><span class=\"line\"> Optimizer Cost:    395                           4                            </span><br><span class=\"line\"> Disk Reads:        0                             1                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    43                            1                            </span><br><span class=\"line\"> Executions:        43                            1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  395 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  395 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 1880695109 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    2 |   264 |    4 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    2 |   264 |    4 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_5afppmx4u3fjp |    1 |       |    3 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_NAME&quot;=&#x27;MV_WH_COMPANY&#x27; AND &quot;OBJECT_TYPE&quot;=&#x27;TABLE&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : c3c69a1dkwucj                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where             </span><br><span class=\"line\">                      object_id=trunc(dbms_random.value(0,10000))               </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  397948                        17176                        </span><br><span class=\"line\"> CPU Time (s):      397844                        158                          </span><br><span class=\"line\"> Buffer Gets:       1420                          3                            </span><br><span class=\"line\"> Optimizer Cost:    412                           2                            </span><br><span class=\"line\"> Disk Reads:        0                             7                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    2                             1                            </span><br><span class=\"line\"> Executions:        1                             1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  412 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3717726382 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_ID&quot;=TRUNC(&quot;DBMS_RANDOM&quot;.&quot;VALUE&quot;(0,10000)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"> Parsing Schema Name  : SYS                                                     </span><br><span class=\"line\"> SQL ID               : dt1tymnjfa8m6                                           </span><br><span class=\"line\"> SQL Text             : select * from tts_binhu.auto_idx_test where             </span><br><span class=\"line\">                      object_id=trunc(dbms_random.value(0,10000))               </span><br><span class=\"line\"> Improvement Factor   : 1418x                                                   </span><br><span class=\"line\"></span><br><span class=\"line\">Execution Statistics:</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\">                    Original Plan                 Auto Index Plan              </span><br><span class=\"line\">                    ----------------------------  ---------------------------- </span><br><span class=\"line\"> Elapsed Time (s):  5006616                       190                          </span><br><span class=\"line\"> CPU Time (s):      4992671                       190                          </span><br><span class=\"line\"> Buffer Gets:       17018                         3                            </span><br><span class=\"line\"> Optimizer Cost:    412                           2                            </span><br><span class=\"line\"> Disk Reads:        0                             0                            </span><br><span class=\"line\"> Direct Writes:     0                             0                            </span><br><span class=\"line\"> Rows Processed:    9                             1                            </span><br><span class=\"line\"> Executions:        12                            1                            </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PLANS SECTION</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- Original</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3956758376 </span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">| Id | Operation           | Name          | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|  0 | SELECT STATEMENT    |               |      |       |  412 |          |</span><br><span class=\"line\">|  1 |   TABLE ACCESS FULL | AUTO_IDX_TEST |    1 |   132 |  412 | 00:00:01 |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">- With Auto Indexes</span><br><span class=\"line\">-----------------------------</span><br><span class=\"line\"> Plan Hash Value  : 3717726382 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">| Id  | Operation                             | Name                 | Rows | Bytes | Cost | Time     |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">|   0 | SELECT STATEMENT                      |                      |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">|   1 |   TABLE ACCESS BY INDEX ROWID BATCHED | AUTO_IDX_TEST        |    1 |   132 |    2 | 00:00:01 |</span><br><span class=\"line\">| * 2 |    INDEX RANGE SCAN                   | SYS_AI_0nfqz048chrwz |    1 |       |    1 | 00:00:01 |</span><br><span class=\"line\">-------------------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Predicate Information (identified by operation id):</span><br><span class=\"line\">------------------------------------------</span><br><span class=\"line\">* 2 - access(&quot;OBJECT_ID&quot;=TRUNC(&quot;DBMS_RANDOM&quot;.&quot;VALUE&quot;(0,10000)))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Notes</span><br><span class=\"line\">-----</span><br><span class=\"line\">- Dynamic sampling used for this statement ( level = 11 )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">ERRORS</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\">No errors found.</span><br><span class=\"line\">---------------------------------------------------------------------------------------------</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"刪除自動建立的index\"><a href=\"#刪除自動建立的index\" class=\"headerlink\" title=\"刪除自動建立的index\"></a>刪除自動建立的index</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200169.png\" alt=\"image-20230212185015654\"></p>\n<blockquote>\n<p>無法直接刪除</p>\n</blockquote>\n<h2 id=\"更新狀態由Auto由Yes-gt-No\"><a href=\"#更新狀態由Auto由Yes-gt-No\" class=\"headerlink\" title=\"更新狀態由Auto由Yes-&gt;No\"></a>更新狀態由Auto由Yes-&gt;No</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200178.png\" alt=\"image-20230212185212945\"></p>\n<h2 id=\"刪除Index-Name有區分大小寫\"><a href=\"#刪除Index-Name有區分大小寫\" class=\"headerlink\" title=\"刪除Index Name有區分大小寫\"></a>刪除Index Name有區分大小寫</h2><p><img src=\"https://raw.githubusercontent.com/binhu831open/image/master/2023/02/upgit_20230212_1676200202.png\" alt=\"image-20230212185256081\"></p>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><blockquote>\n<p>1.測試的DB版本:Oracle 19c</p>\n<p>2.自動建立index不支援function/partition table</p>\n</blockquote>"},{"title":"rman_info","date":"2023-02-12T09:22:46.000Z","_content":"\nrman限制I/O和檢查datafile\n\n<!--more-->\n\n```bash\n@echo off\n\n@For /F \"tokens=1,2,3 delims=:. \" %%A in ('echo %time%') do @(\nSet Hour=%%A\nSet Min=%%B\nSet Sec=%%C\nSet p_time=%%A_%%B_%%C\n)\nrem: xp @For /f \"tokens=1-3 delims=/ \" %%a in ('date /t') do (set p_date=%%c-%%b-%%a)\nrem: windows 2003 /f \"tokens=1-4 delims=/ \" %%a in ('date /t') do (set p_date=%%c-%%b-%%d)\n@For /f \"tokens=1-4 delims=/ \" %%a in ('date /t') do (set p_date=%%b-%%c)\nset DateString=%p_date%-%p_time%\n\n@For /F \"tokens=1,2,3 delims=:. \" %%A in ('echo %time%') do @(\nSet Hour=%%A\nSet Min=%%B\nSet Sec=%%C\nSet mail_time=%%A:%%B:%%C\n)\nset ScriptHome=f:\\dba\nset ORACLE_SID=xxxx\nset RmanBackupsetFolder=F:\\Backup_RMAN_history\\%ORACLE_SID%\nset RmanRcvFile=%ScriptHome%\\Rman\\Log\\rman_full_db_archivelog_%ORACLE_SID%.rcv\nset RmanLogFile=%ScriptHome%\\Rman\\Log\\rman_full_db_and_archivelog-%DateString%_%ORACLE_SID%.log\n\nset GetDateSql=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.sql\nset GetDateTxt=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.txt\n\nping 1.1.1.1 -n 1 -w 5000>nul\necho run > %RmanRcvFile%\necho { >> %RmanRcvFile%\necho CONFIGURE RETENTION POLICY TO REDUNDANCY 3; >> %RmanRcvFile%\necho CONFIGURE BACKUP OPTIMIZATION OFF; >> %RmanRcvFile%\necho SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%%F'; >> %RmanRcvFile%\necho CONFIGURE CONTROLFILE AUTOBACKUP ON; >> %RmanRcvFile%\necho crosscheck backup; >> %RmanRcvFile%\necho crosscheck archivelog all; >> %RmanRcvFile%\necho delete noprompt expired backup; >> %RmanRcvFile%\necho delete noprompt expired archivelog all; >> %RmanRcvFile%\necho allocate channel t1 type disk rate 30M; >> %RmanRcvFile%\necho allocate channel t2 type disk rate 30M; >> %RmanRcvFile%\necho allocate channel t3 type disk rate 30M; >> %RmanRcvFile%\necho backup as compressed backupset format '%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_DB_FULL_%%U' database include current controlfile; >> %RmanRcvFile%\necho backup as compressed backupset format '%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U' archivelog all not backed up 1 times; >> %RmanRcvFile%\necho backup as compressed backupset format '%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U' archivelog until time 'sysdate-1' delete input not backed up 1 times; >> %RmanRcvFile%\necho backup as copy current controlfile format '%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%DateString%_%%U'; >> %RmanRcvFile%\necho delete noprompt obsolete; >>  %RmanRcvFile%\necho backup validate check logical database; >>  %RmanRcvFile%\necho } >> %RmanRcvFile%\n\nping 1.1.1.1 -n 1 -w 5000>nul\nrman target / @%RmanRcvFile% > %RmanLogFile%\nping 1.1.1.1 -n 1 -w 5000>nul\n```\n\n","source":"_posts/rman-info.md","raw":"---\ntitle: rman_info\ndate: 2023-02-12 17:22:46\ntags:\n- [Rman]\n- [Script]\ncategories:\n- [Oracle]\n---\n\nrman限制I/O和檢查datafile\n\n<!--more-->\n\n```bash\n@echo off\n\n@For /F \"tokens=1,2,3 delims=:. \" %%A in ('echo %time%') do @(\nSet Hour=%%A\nSet Min=%%B\nSet Sec=%%C\nSet p_time=%%A_%%B_%%C\n)\nrem: xp @For /f \"tokens=1-3 delims=/ \" %%a in ('date /t') do (set p_date=%%c-%%b-%%a)\nrem: windows 2003 /f \"tokens=1-4 delims=/ \" %%a in ('date /t') do (set p_date=%%c-%%b-%%d)\n@For /f \"tokens=1-4 delims=/ \" %%a in ('date /t') do (set p_date=%%b-%%c)\nset DateString=%p_date%-%p_time%\n\n@For /F \"tokens=1,2,3 delims=:. \" %%A in ('echo %time%') do @(\nSet Hour=%%A\nSet Min=%%B\nSet Sec=%%C\nSet mail_time=%%A:%%B:%%C\n)\nset ScriptHome=f:\\dba\nset ORACLE_SID=xxxx\nset RmanBackupsetFolder=F:\\Backup_RMAN_history\\%ORACLE_SID%\nset RmanRcvFile=%ScriptHome%\\Rman\\Log\\rman_full_db_archivelog_%ORACLE_SID%.rcv\nset RmanLogFile=%ScriptHome%\\Rman\\Log\\rman_full_db_and_archivelog-%DateString%_%ORACLE_SID%.log\n\nset GetDateSql=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.sql\nset GetDateTxt=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.txt\n\nping 1.1.1.1 -n 1 -w 5000>nul\necho run > %RmanRcvFile%\necho { >> %RmanRcvFile%\necho CONFIGURE RETENTION POLICY TO REDUNDANCY 3; >> %RmanRcvFile%\necho CONFIGURE BACKUP OPTIMIZATION OFF; >> %RmanRcvFile%\necho SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%%F'; >> %RmanRcvFile%\necho CONFIGURE CONTROLFILE AUTOBACKUP ON; >> %RmanRcvFile%\necho crosscheck backup; >> %RmanRcvFile%\necho crosscheck archivelog all; >> %RmanRcvFile%\necho delete noprompt expired backup; >> %RmanRcvFile%\necho delete noprompt expired archivelog all; >> %RmanRcvFile%\necho allocate channel t1 type disk rate 30M; >> %RmanRcvFile%\necho allocate channel t2 type disk rate 30M; >> %RmanRcvFile%\necho allocate channel t3 type disk rate 30M; >> %RmanRcvFile%\necho backup as compressed backupset format '%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_DB_FULL_%%U' database include current controlfile; >> %RmanRcvFile%\necho backup as compressed backupset format '%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U' archivelog all not backed up 1 times; >> %RmanRcvFile%\necho backup as compressed backupset format '%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U' archivelog until time 'sysdate-1' delete input not backed up 1 times; >> %RmanRcvFile%\necho backup as copy current controlfile format '%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%DateString%_%%U'; >> %RmanRcvFile%\necho delete noprompt obsolete; >>  %RmanRcvFile%\necho backup validate check logical database; >>  %RmanRcvFile%\necho } >> %RmanRcvFile%\n\nping 1.1.1.1 -n 1 -w 5000>nul\nrman target / @%RmanRcvFile% > %RmanLogFile%\nping 1.1.1.1 -n 1 -w 5000>nul\n```\n\n","slug":"rman-info","published":1,"updated":"2023-02-12T11:45:19.008Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm710019rcu37h6k5erv","content":"<p>rman限制I/O和檢查datafile</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"></span><br><span class=\"line\">@For /F <span class=\"string\">&quot;tokens=1,2,3 delims=:. &quot;</span> %%A <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;echo %time%&#x27;</span>) <span class=\"keyword\">do</span> @(</span><br><span class=\"line\">Set Hour=%%A</span><br><span class=\"line\">Set Min=%%B</span><br><span class=\"line\">Set Sec=%%C</span><br><span class=\"line\">Set p_time=%%A_%%B_%%C</span><br><span class=\"line\">)</span><br><span class=\"line\">rem: xp @For /f <span class=\"string\">&quot;tokens=1-3 delims=/ &quot;</span> %%a <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;date /t&#x27;</span>) <span class=\"keyword\">do</span> (<span class=\"built_in\">set</span> p_date=%%c-%%b-%%a)</span><br><span class=\"line\">rem: windows 2003 /f <span class=\"string\">&quot;tokens=1-4 delims=/ &quot;</span> %%a <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;date /t&#x27;</span>) <span class=\"keyword\">do</span> (<span class=\"built_in\">set</span> p_date=%%c-%%b-%%d)</span><br><span class=\"line\">@For /f <span class=\"string\">&quot;tokens=1-4 delims=/ &quot;</span> %%a <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;date /t&#x27;</span>) <span class=\"keyword\">do</span> (<span class=\"built_in\">set</span> p_date=%%b-%%c)</span><br><span class=\"line\"><span class=\"built_in\">set</span> DateString=%p_date%-%p_time%</span><br><span class=\"line\"></span><br><span class=\"line\">@For /F <span class=\"string\">&quot;tokens=1,2,3 delims=:. &quot;</span> %%A <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;echo %time%&#x27;</span>) <span class=\"keyword\">do</span> @(</span><br><span class=\"line\">Set Hour=%%A</span><br><span class=\"line\">Set Min=%%B</span><br><span class=\"line\">Set Sec=%%C</span><br><span class=\"line\">Set mail_time=%%A:%%B:%%C</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"built_in\">set</span> ScriptHome=f:\\dba</span><br><span class=\"line\"><span class=\"built_in\">set</span> ORACLE_SID=xxxx</span><br><span class=\"line\"><span class=\"built_in\">set</span> RmanBackupsetFolder=F:\\Backup_RMAN_history\\%ORACLE_SID%</span><br><span class=\"line\"><span class=\"built_in\">set</span> RmanRcvFile=%ScriptHome%\\Rman\\Log\\rman_full_db_archivelog_%ORACLE_SID%.rcv</span><br><span class=\"line\"><span class=\"built_in\">set</span> RmanLogFile=%ScriptHome%\\Rman\\Log\\rman_full_db_and_archivelog-%DateString%_%ORACLE_SID%.<span class=\"built_in\">log</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> GetDateSql=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.sql</span><br><span class=\"line\"><span class=\"built_in\">set</span> GetDateTxt=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.txt</span><br><span class=\"line\"></span><br><span class=\"line\">ping 1.1.1.1 -n 1 -w 5000&gt;nul</span><br><span class=\"line\"><span class=\"built_in\">echo</span> run &gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> &#123; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> CONFIGURE RETENTION POLICY TO REDUNDANCY 3; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> CONFIGURE BACKUP OPTIMIZATION OFF; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%%F&#x27;</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> CONFIGURE CONTROLFILE AUTOBACKUP ON; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> crosscheck backup; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> crosscheck archivelog all; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> delete noprompt expired backup; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> delete noprompt expired archivelog all; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> allocate channel t1 <span class=\"built_in\">type</span> disk rate 30M; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> allocate channel t2 <span class=\"built_in\">type</span> disk rate 30M; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> allocate channel t3 <span class=\"built_in\">type</span> disk rate 30M; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as compressed backupset format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_DB_FULL_%%U&#x27;</span> database include current controlfile; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as compressed backupset format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U&#x27;</span> archivelog all not backed up 1 <span class=\"built_in\">times</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as compressed backupset format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U&#x27;</span> archivelog until time <span class=\"string\">&#x27;sysdate-1&#x27;</span> delete input not backed up 1 <span class=\"built_in\">times</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as copy current controlfile format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%DateString%_%%U&#x27;</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> delete noprompt obsolete; &gt;&gt;  %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup validate check logical database; &gt;&gt;  %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> &#125; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"></span><br><span class=\"line\">ping 1.1.1.1 -n 1 -w 5000&gt;nul</span><br><span class=\"line\">rman target / @%RmanRcvFile% &gt; %RmanLogFile%</span><br><span class=\"line\">ping 1.1.1.1 -n 1 -w 5000&gt;nul</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>rman限制I/O和檢查datafile</p>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"></span><br><span class=\"line\">@For /F <span class=\"string\">&quot;tokens=1,2,3 delims=:. &quot;</span> %%A <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;echo %time%&#x27;</span>) <span class=\"keyword\">do</span> @(</span><br><span class=\"line\">Set Hour=%%A</span><br><span class=\"line\">Set Min=%%B</span><br><span class=\"line\">Set Sec=%%C</span><br><span class=\"line\">Set p_time=%%A_%%B_%%C</span><br><span class=\"line\">)</span><br><span class=\"line\">rem: xp @For /f <span class=\"string\">&quot;tokens=1-3 delims=/ &quot;</span> %%a <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;date /t&#x27;</span>) <span class=\"keyword\">do</span> (<span class=\"built_in\">set</span> p_date=%%c-%%b-%%a)</span><br><span class=\"line\">rem: windows 2003 /f <span class=\"string\">&quot;tokens=1-4 delims=/ &quot;</span> %%a <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;date /t&#x27;</span>) <span class=\"keyword\">do</span> (<span class=\"built_in\">set</span> p_date=%%c-%%b-%%d)</span><br><span class=\"line\">@For /f <span class=\"string\">&quot;tokens=1-4 delims=/ &quot;</span> %%a <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;date /t&#x27;</span>) <span class=\"keyword\">do</span> (<span class=\"built_in\">set</span> p_date=%%b-%%c)</span><br><span class=\"line\"><span class=\"built_in\">set</span> DateString=%p_date%-%p_time%</span><br><span class=\"line\"></span><br><span class=\"line\">@For /F <span class=\"string\">&quot;tokens=1,2,3 delims=:. &quot;</span> %%A <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;echo %time%&#x27;</span>) <span class=\"keyword\">do</span> @(</span><br><span class=\"line\">Set Hour=%%A</span><br><span class=\"line\">Set Min=%%B</span><br><span class=\"line\">Set Sec=%%C</span><br><span class=\"line\">Set mail_time=%%A:%%B:%%C</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"built_in\">set</span> ScriptHome=f:\\dba</span><br><span class=\"line\"><span class=\"built_in\">set</span> ORACLE_SID=xxxx</span><br><span class=\"line\"><span class=\"built_in\">set</span> RmanBackupsetFolder=F:\\Backup_RMAN_history\\%ORACLE_SID%</span><br><span class=\"line\"><span class=\"built_in\">set</span> RmanRcvFile=%ScriptHome%\\Rman\\Log\\rman_full_db_archivelog_%ORACLE_SID%.rcv</span><br><span class=\"line\"><span class=\"built_in\">set</span> RmanLogFile=%ScriptHome%\\Rman\\Log\\rman_full_db_and_archivelog-%DateString%_%ORACLE_SID%.<span class=\"built_in\">log</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> GetDateSql=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.sql</span><br><span class=\"line\"><span class=\"built_in\">set</span> GetDateTxt=%ScriptHome%\\Rman\\Log\\GetDateString_for_rman_fbrhist.txt</span><br><span class=\"line\"></span><br><span class=\"line\">ping 1.1.1.1 -n 1 -w 5000&gt;nul</span><br><span class=\"line\"><span class=\"built_in\">echo</span> run &gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> &#123; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> CONFIGURE RETENTION POLICY TO REDUNDANCY 3; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> CONFIGURE BACKUP OPTIMIZATION OFF; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%%F&#x27;</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> CONFIGURE CONTROLFILE AUTOBACKUP ON; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> crosscheck backup; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> crosscheck archivelog all; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> delete noprompt expired backup; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> delete noprompt expired archivelog all; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> allocate channel t1 <span class=\"built_in\">type</span> disk rate 30M; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> allocate channel t2 <span class=\"built_in\">type</span> disk rate 30M; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> allocate channel t3 <span class=\"built_in\">type</span> disk rate 30M; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as compressed backupset format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_DB_FULL_%%U&#x27;</span> database include current controlfile; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as compressed backupset format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U&#x27;</span> archivelog all not backed up 1 <span class=\"built_in\">times</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as compressed backupset format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_%DateString%_ARCH_%%U&#x27;</span> archivelog until time <span class=\"string\">&#x27;sysdate-1&#x27;</span> delete input not backed up 1 <span class=\"built_in\">times</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup as copy current controlfile format <span class=\"string\">&#x27;%RmanBackupsetFolder%\\%ORACLE_SID%_CONTROLFILE_%DateString%_%%U&#x27;</span>; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> delete noprompt obsolete; &gt;&gt;  %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> backup validate check logical database; &gt;&gt;  %RmanRcvFile%</span><br><span class=\"line\"><span class=\"built_in\">echo</span> &#125; &gt;&gt; %RmanRcvFile%</span><br><span class=\"line\"></span><br><span class=\"line\">ping 1.1.1.1 -n 1 -w 5000&gt;nul</span><br><span class=\"line\">rman target / @%RmanRcvFile% &gt; %RmanLogFile%</span><br><span class=\"line\">ping 1.1.1.1 -n 1 -w 5000&gt;nul</span><br></pre></td></tr></table></figure>"},{"title":"sqlldr_hdsize","date":"2023-02-12T10:15:32.000Z","_content":"\nsqlldr傳硬碟資訊到table\n\n<!--more-->\n\n```\nrem: @echo off\nset ORACLE_SID=xxxx\nset ScriptHome=F:\\dba_for_primary_role\\Os\nset LogFolder=%ScriptHome%\\Log\nset OS_HDSize_Info_File=%LogFolder%\\OS_HDSize.csv\nset SQLLDR_BADFILE=%LogFolder%\\OS_HDSize.bad\nset SQLLDR_DISCARDFILE=%LogFolder%\\OS_HDSize.dsc\nset TableName=binhu.dba_HDSIZE_LOG\nset SQLLDR_CTL_File=%ScriptHome%\\Log\\LoadHDSize.ctl\nset SQLLDR_CTL_Log=%ScriptHome%\\Log\\LoadHDSize.log\nset GetHOSTIPSql=%ScriptHome%\\Log\\GetHOSTIP.sql\nset GetHOSTIPTxt=%ScriptHome%\\Log\\GetHOSTIP.txt\n\n\nset IP=xxx.xxx.xxx.xxx\n\nwmic.exe /OUTPUT:%OS_HDSize_Info_File%  logicaldisk where \"drivetype=3\" get name,freespace,size \n\nrem: for windows 2008\nset GET_COMPUTERNAME=%COMPUTERNAME%\n\necho LOAD DATA > %SQLLDR_CTL_File%\necho CHARACTERSET 'AL16UTF16' >> %SQLLDR_CTL_File%\necho INFILE '%OS_HDSize_Info_File%' >> %SQLLDR_CTL_File%\necho BADFILE '%SQLLDR_BADFILE%' >> %SQLLDR_CTL_File%\necho DISCARDFILE '%SQLLDR_DISCARDFILE%' >> %SQLLDR_CTL_File%\necho INTO TABLE %TableName% >> %SQLLDR_CTL_File%\necho APPEND >> %SQLLDR_CTL_File%\necho FIELDS TERMINATED BY WHITESPACE >> %SQLLDR_CTL_File%\necho TRAILING NULLCOLS >> %SQLLDR_CTL_File%\necho (HOSTNAME CONSTANT \"%GET_COMPUTERNAME%\", >> %SQLLDR_CTL_File%\necho FREE_SIZE_BYTE, >> %SQLLDR_CTL_File%\necho MOUNT_POINT_NAME, >> %SQLLDR_CTL_File%\necho MOUNT_POINT_SIZE_BYTE, >> %SQLLDR_CTL_File%\necho HOSTIP CONSTANT  \"%IP%\") >> %SQLLDR_CTL_File%\n\nsqlldr / control=%SQLLDR_CTL_File%  log=%SQLLDR_CTL_Log%\n```\n\n","source":"_posts/sqlldr-hdsize.md","raw":"---\ntitle: sqlldr_hdsize\ndate: 2023-02-12 18:15:32\ntags:\n- [Script]\ncategories:\n- [Oracle]\n---\n\nsqlldr傳硬碟資訊到table\n\n<!--more-->\n\n```\nrem: @echo off\nset ORACLE_SID=xxxx\nset ScriptHome=F:\\dba_for_primary_role\\Os\nset LogFolder=%ScriptHome%\\Log\nset OS_HDSize_Info_File=%LogFolder%\\OS_HDSize.csv\nset SQLLDR_BADFILE=%LogFolder%\\OS_HDSize.bad\nset SQLLDR_DISCARDFILE=%LogFolder%\\OS_HDSize.dsc\nset TableName=binhu.dba_HDSIZE_LOG\nset SQLLDR_CTL_File=%ScriptHome%\\Log\\LoadHDSize.ctl\nset SQLLDR_CTL_Log=%ScriptHome%\\Log\\LoadHDSize.log\nset GetHOSTIPSql=%ScriptHome%\\Log\\GetHOSTIP.sql\nset GetHOSTIPTxt=%ScriptHome%\\Log\\GetHOSTIP.txt\n\n\nset IP=xxx.xxx.xxx.xxx\n\nwmic.exe /OUTPUT:%OS_HDSize_Info_File%  logicaldisk where \"drivetype=3\" get name,freespace,size \n\nrem: for windows 2008\nset GET_COMPUTERNAME=%COMPUTERNAME%\n\necho LOAD DATA > %SQLLDR_CTL_File%\necho CHARACTERSET 'AL16UTF16' >> %SQLLDR_CTL_File%\necho INFILE '%OS_HDSize_Info_File%' >> %SQLLDR_CTL_File%\necho BADFILE '%SQLLDR_BADFILE%' >> %SQLLDR_CTL_File%\necho DISCARDFILE '%SQLLDR_DISCARDFILE%' >> %SQLLDR_CTL_File%\necho INTO TABLE %TableName% >> %SQLLDR_CTL_File%\necho APPEND >> %SQLLDR_CTL_File%\necho FIELDS TERMINATED BY WHITESPACE >> %SQLLDR_CTL_File%\necho TRAILING NULLCOLS >> %SQLLDR_CTL_File%\necho (HOSTNAME CONSTANT \"%GET_COMPUTERNAME%\", >> %SQLLDR_CTL_File%\necho FREE_SIZE_BYTE, >> %SQLLDR_CTL_File%\necho MOUNT_POINT_NAME, >> %SQLLDR_CTL_File%\necho MOUNT_POINT_SIZE_BYTE, >> %SQLLDR_CTL_File%\necho HOSTIP CONSTANT  \"%IP%\") >> %SQLLDR_CTL_File%\n\nsqlldr / control=%SQLLDR_CTL_File%  log=%SQLLDR_CTL_Log%\n```\n\n","slug":"sqlldr-hdsize","published":1,"updated":"2023-02-13T15:41:36.662Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm72001drcu33clg9kd6","content":"<p>sqlldr傳硬碟資訊到table</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rem: @echo off</span><br><span class=\"line\">set ORACLE_SID=xxxx</span><br><span class=\"line\">set ScriptHome=F:\\dba_for_primary_role\\Os</span><br><span class=\"line\">set LogFolder=%ScriptHome%\\Log</span><br><span class=\"line\">set OS_HDSize_Info_File=%LogFolder%\\OS_HDSize.csv</span><br><span class=\"line\">set SQLLDR_BADFILE=%LogFolder%\\OS_HDSize.bad</span><br><span class=\"line\">set SQLLDR_DISCARDFILE=%LogFolder%\\OS_HDSize.dsc</span><br><span class=\"line\">set TableName=binhu.dba_HDSIZE_LOG</span><br><span class=\"line\">set SQLLDR_CTL_File=%ScriptHome%\\Log\\LoadHDSize.ctl</span><br><span class=\"line\">set SQLLDR_CTL_Log=%ScriptHome%\\Log\\LoadHDSize.log</span><br><span class=\"line\">set GetHOSTIPSql=%ScriptHome%\\Log\\GetHOSTIP.sql</span><br><span class=\"line\">set GetHOSTIPTxt=%ScriptHome%\\Log\\GetHOSTIP.txt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">set IP=xxx.xxx.xxx.xxx</span><br><span class=\"line\"></span><br><span class=\"line\">wmic.exe /OUTPUT:%OS_HDSize_Info_File%  logicaldisk where &quot;drivetype=3&quot; get name,freespace,size </span><br><span class=\"line\"></span><br><span class=\"line\">rem: for windows 2008</span><br><span class=\"line\">set GET_COMPUTERNAME=%COMPUTERNAME%</span><br><span class=\"line\"></span><br><span class=\"line\">echo LOAD DATA &gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo CHARACTERSET &#x27;AL16UTF16&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo INFILE &#x27;%OS_HDSize_Info_File%&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo BADFILE &#x27;%SQLLDR_BADFILE%&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo DISCARDFILE &#x27;%SQLLDR_DISCARDFILE%&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo INTO TABLE %TableName% &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo APPEND &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo FIELDS TERMINATED BY WHITESPACE &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo TRAILING NULLCOLS &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo (HOSTNAME CONSTANT &quot;%GET_COMPUTERNAME%&quot;, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo FREE_SIZE_BYTE, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo MOUNT_POINT_NAME, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo MOUNT_POINT_SIZE_BYTE, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo HOSTIP CONSTANT  &quot;%IP%&quot;) &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\"></span><br><span class=\"line\">sqlldr / control=%SQLLDR_CTL_File%  log=%SQLLDR_CTL_Log%</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>sqlldr傳硬碟資訊到table</p>","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rem: @echo off</span><br><span class=\"line\">set ORACLE_SID=xxxx</span><br><span class=\"line\">set ScriptHome=F:\\dba_for_primary_role\\Os</span><br><span class=\"line\">set LogFolder=%ScriptHome%\\Log</span><br><span class=\"line\">set OS_HDSize_Info_File=%LogFolder%\\OS_HDSize.csv</span><br><span class=\"line\">set SQLLDR_BADFILE=%LogFolder%\\OS_HDSize.bad</span><br><span class=\"line\">set SQLLDR_DISCARDFILE=%LogFolder%\\OS_HDSize.dsc</span><br><span class=\"line\">set TableName=binhu.dba_HDSIZE_LOG</span><br><span class=\"line\">set SQLLDR_CTL_File=%ScriptHome%\\Log\\LoadHDSize.ctl</span><br><span class=\"line\">set SQLLDR_CTL_Log=%ScriptHome%\\Log\\LoadHDSize.log</span><br><span class=\"line\">set GetHOSTIPSql=%ScriptHome%\\Log\\GetHOSTIP.sql</span><br><span class=\"line\">set GetHOSTIPTxt=%ScriptHome%\\Log\\GetHOSTIP.txt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">set IP=xxx.xxx.xxx.xxx</span><br><span class=\"line\"></span><br><span class=\"line\">wmic.exe /OUTPUT:%OS_HDSize_Info_File%  logicaldisk where &quot;drivetype=3&quot; get name,freespace,size </span><br><span class=\"line\"></span><br><span class=\"line\">rem: for windows 2008</span><br><span class=\"line\">set GET_COMPUTERNAME=%COMPUTERNAME%</span><br><span class=\"line\"></span><br><span class=\"line\">echo LOAD DATA &gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo CHARACTERSET &#x27;AL16UTF16&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo INFILE &#x27;%OS_HDSize_Info_File%&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo BADFILE &#x27;%SQLLDR_BADFILE%&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo DISCARDFILE &#x27;%SQLLDR_DISCARDFILE%&#x27; &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo INTO TABLE %TableName% &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo APPEND &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo FIELDS TERMINATED BY WHITESPACE &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo TRAILING NULLCOLS &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo (HOSTNAME CONSTANT &quot;%GET_COMPUTERNAME%&quot;, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo FREE_SIZE_BYTE, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo MOUNT_POINT_NAME, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo MOUNT_POINT_SIZE_BYTE, &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\">echo HOSTIP CONSTANT  &quot;%IP%&quot;) &gt;&gt; %SQLLDR_CTL_File%</span><br><span class=\"line\"></span><br><span class=\"line\">sqlldr / control=%SQLLDR_CTL_File%  log=%SQLLDR_CTL_Log%</span><br></pre></td></tr></table></figure>"},{"title":"windows_update","date":"2023-02-13T15:31:03.000Z","_content":"\nUpdate失敗時解決方案1\n\n<!--more-->\n\n```bash\nnet stop wuauserv\n--停止update服務\n\nC:\\Windows\\SoftwareDistribution\n--將目錄更名後，再重建一個SoftwareDistribution\n\nnet start wuauserv\n--起動update服務\n\n再試看看了~\n```\n\n","source":"_posts/windows-update.md","raw":"---\ntitle: windows_update\ndate: 2023-02-13 23:31:03\ntags:\n- [Script]\ncategories:\n- [Windows]\n---\n\nUpdate失敗時解決方案1\n\n<!--more-->\n\n```bash\nnet stop wuauserv\n--停止update服務\n\nC:\\Windows\\SoftwareDistribution\n--將目錄更名後，再重建一個SoftwareDistribution\n\nnet start wuauserv\n--起動update服務\n\n再試看看了~\n```\n\n","slug":"windows-update","published":1,"updated":"2023-02-13T15:41:54.435Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm7a002trcu39yuu8frr","content":"<p>Update失敗時解決方案1</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net stop wuauserv</span><br><span class=\"line\">--停止update服務</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\Windows\\SoftwareDistribution</span><br><span class=\"line\">--將目錄更名後，再重建一個SoftwareDistribution</span><br><span class=\"line\"></span><br><span class=\"line\">net start wuauserv</span><br><span class=\"line\">--起動update服務</span><br><span class=\"line\"></span><br><span class=\"line\">再試看看了~</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>Update失敗時解決方案1</p>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net stop wuauserv</span><br><span class=\"line\">--停止update服務</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\Windows\\SoftwareDistribution</span><br><span class=\"line\">--將目錄更名後，再重建一個SoftwareDistribution</span><br><span class=\"line\"></span><br><span class=\"line\">net start wuauserv</span><br><span class=\"line\">--起動update服務</span><br><span class=\"line\"></span><br><span class=\"line\">再試看看了~</span><br></pre></td></tr></table></figure>"},{"title":"script_ftp_restart","date":"2023-04-16T06:56:30.000Z","_content":"\nFtp檢查檔案Size不相同，執行續傳\n\n<!--more-->\n\n\n\n```bash\n#!/usr/bin/bash\n\nzip_passwd=`date +%b%d%Y`\ndump_folder=/dbback/data_pump\nftp_name=/oradata/schedule/log/dba_ftp_\nftp_name_list=${ftp_name}_list\nftp_ck_name=/oradata/schedule/log/dba_ftp_ck_\nftp_size_name=/oradata/schedule/log/dba_ftp_size_\nftp_reput_name=/oradata/schedule/log/dba_ftp_reput_\n\nls -ltr ${dump_folder} | grep ${zip_passwd} | tr -s ' ' | cut -d ' ' -f9 > ${ftp_name_list}\n\ncat ${ftp_name_list} | while read line\ndo\n   echo 'user ftpuser ftppasswd' > ${ftp_name}${line};\n   echo 'bi' >> ${ftp_name}${line};\n   echo 'prompt' >> ${ftp_name}${line};\n   echo lcd ${dump_folder} >> ${ftp_name}${line};\n   echo put ${line} >> ${ftp_name}${line};\n   echo 'bye' >> ${ftp_name}${line};\ndone\n\ncat ${ftp_name_list} | while read line\ndo\n  echo 'user ftpuser ftppasswd' > ${ftp_ck_name}${line};\n  echo dir ${line} >> ${ftp_ck_name}${line};\n  echo 'bye' >> ${ftp_ck_name}${line};\ndone\n\n\ncat ${ftp_name_list} | while read line\ndo\n  ftp -n FTP_IP < ${ftp_name}${line};\n  ftp -n FTP_IP < ${ftp_ck_name}${line} > ${ftp_size_name}${line};\ndone\n\n\ncat ${ftp_name_list} | while read line\ndo\n  ftp_sfile=`cat ${ftp_size_name}${line} | grep ${zip_passwd} | tr -s ' ' | cut -d ' ' -f5`\n  local_sfile=`ls -ltr ${dump_folder} | grep ${line} | tr -s ' ' | cut -d ' ' -f5`\n  if [ ${ftp_sfile} -gt 0 ] && [ ${ftp_sfile} -ne ${local_sfile} ]; then\n     echo 'user ftpuser ftppasswd' > ${ftp_reput_name}${line};\n     echo 'bi' >> ${ftp_reput_name}${line};\n     echo 'prompt' >> ${ftp_reput_name}${line};\n     echo lcd ${dump_folder} >> ${ftp_reput_name}${line};\n     echo restart ${ftp_sfile} >> ${ftp_reput_name}${line};\n     echo put ${line} >> ${ftp_reput_name}${line};\n     echo 'bye' >> ${ftp_reput_name}${line};\n     ftp -n FTP_IP < ${ftp_reput_name}${line} ;\n  fi\ndone\n```\n\n","source":"_posts/script-ftp-restart.md","raw":"---\ntitle: script_ftp_restart\ndate: 2023-04-16 14:56:30\ntags:\n- [Script]\ncategories:\n- [OS]\n---\n\nFtp檢查檔案Size不相同，執行續傳\n\n<!--more-->\n\n\n\n```bash\n#!/usr/bin/bash\n\nzip_passwd=`date +%b%d%Y`\ndump_folder=/dbback/data_pump\nftp_name=/oradata/schedule/log/dba_ftp_\nftp_name_list=${ftp_name}_list\nftp_ck_name=/oradata/schedule/log/dba_ftp_ck_\nftp_size_name=/oradata/schedule/log/dba_ftp_size_\nftp_reput_name=/oradata/schedule/log/dba_ftp_reput_\n\nls -ltr ${dump_folder} | grep ${zip_passwd} | tr -s ' ' | cut -d ' ' -f9 > ${ftp_name_list}\n\ncat ${ftp_name_list} | while read line\ndo\n   echo 'user ftpuser ftppasswd' > ${ftp_name}${line};\n   echo 'bi' >> ${ftp_name}${line};\n   echo 'prompt' >> ${ftp_name}${line};\n   echo lcd ${dump_folder} >> ${ftp_name}${line};\n   echo put ${line} >> ${ftp_name}${line};\n   echo 'bye' >> ${ftp_name}${line};\ndone\n\ncat ${ftp_name_list} | while read line\ndo\n  echo 'user ftpuser ftppasswd' > ${ftp_ck_name}${line};\n  echo dir ${line} >> ${ftp_ck_name}${line};\n  echo 'bye' >> ${ftp_ck_name}${line};\ndone\n\n\ncat ${ftp_name_list} | while read line\ndo\n  ftp -n FTP_IP < ${ftp_name}${line};\n  ftp -n FTP_IP < ${ftp_ck_name}${line} > ${ftp_size_name}${line};\ndone\n\n\ncat ${ftp_name_list} | while read line\ndo\n  ftp_sfile=`cat ${ftp_size_name}${line} | grep ${zip_passwd} | tr -s ' ' | cut -d ' ' -f5`\n  local_sfile=`ls -ltr ${dump_folder} | grep ${line} | tr -s ' ' | cut -d ' ' -f5`\n  if [ ${ftp_sfile} -gt 0 ] && [ ${ftp_sfile} -ne ${local_sfile} ]; then\n     echo 'user ftpuser ftppasswd' > ${ftp_reput_name}${line};\n     echo 'bi' >> ${ftp_reput_name}${line};\n     echo 'prompt' >> ${ftp_reput_name}${line};\n     echo lcd ${dump_folder} >> ${ftp_reput_name}${line};\n     echo restart ${ftp_sfile} >> ${ftp_reput_name}${line};\n     echo put ${line} >> ${ftp_reput_name}${line};\n     echo 'bye' >> ${ftp_reput_name}${line};\n     ftp -n FTP_IP < ${ftp_reput_name}${line} ;\n  fi\ndone\n```\n\n","slug":"script-ftp-restart","published":1,"updated":"2023-04-16T06:59:28.016Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clgj2lm7a002urcu335cy41i6","content":"<p>Ftp檢查檔案Size不相同，執行續傳</p>\n<span id=\"more\"></span>\n\n\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">zip_passwd=`<span class=\"built_in\">date</span> +%b%d%Y`</span><br><span class=\"line\">dump_folder=/dbback/data_pump</span><br><span class=\"line\">ftp_name=/oradata/schedule/log/dba_ftp_</span><br><span class=\"line\">ftp_name_list=<span class=\"variable\">$&#123;ftp_name&#125;</span>_list</span><br><span class=\"line\">ftp_ck_name=/oradata/schedule/log/dba_ftp_ck_</span><br><span class=\"line\">ftp_size_name=/oradata/schedule/log/dba_ftp_size_</span><br><span class=\"line\">ftp_reput_name=/oradata/schedule/log/dba_ftp_reput_</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -ltr <span class=\"variable\">$&#123;dump_folder&#125;</span> | grep <span class=\"variable\">$&#123;zip_passwd&#125;</span> | <span class=\"built_in\">tr</span> -s <span class=\"string\">&#x27; &#x27;</span> | <span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27; &#x27;</span> -f9 &gt; <span class=\"variable\">$&#123;ftp_name_list&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;user ftpuser ftppasswd&#x27;</span> &gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bi&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;prompt&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> lcd <span class=\"variable\">$&#123;dump_folder&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> put <span class=\"variable\">$&#123;line&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bye&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;user ftpuser ftppasswd&#x27;</span> &gt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"built_in\">dir</span> <span class=\"variable\">$&#123;line&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bye&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  ftp -n FTP_IP &lt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">  ftp -n FTP_IP &lt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span> &gt; <span class=\"variable\">$&#123;ftp_size_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  ftp_sfile=`<span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_size_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span> | grep <span class=\"variable\">$&#123;zip_passwd&#125;</span> | <span class=\"built_in\">tr</span> -s <span class=\"string\">&#x27; &#x27;</span> | <span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27; &#x27;</span> -f5`</span><br><span class=\"line\">  local_sfile=`<span class=\"built_in\">ls</span> -ltr <span class=\"variable\">$&#123;dump_folder&#125;</span> | grep <span class=\"variable\">$&#123;line&#125;</span> | <span class=\"built_in\">tr</span> -s <span class=\"string\">&#x27; &#x27;</span> | <span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27; &#x27;</span> -f5`</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;ftp_sfile&#125;</span> -gt 0 ] &amp;&amp; [ <span class=\"variable\">$&#123;ftp_sfile&#125;</span> -ne <span class=\"variable\">$&#123;local_sfile&#125;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;user ftpuser ftppasswd&#x27;</span> &gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bi&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;prompt&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> lcd <span class=\"variable\">$&#123;dump_folder&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> restart <span class=\"variable\">$&#123;ftp_sfile&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> put <span class=\"variable\">$&#123;line&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bye&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     ftp -n FTP_IP &lt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span> ;</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>Ftp檢查檔案Size不相同，執行續傳</p>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">zip_passwd=`<span class=\"built_in\">date</span> +%b%d%Y`</span><br><span class=\"line\">dump_folder=/dbback/data_pump</span><br><span class=\"line\">ftp_name=/oradata/schedule/log/dba_ftp_</span><br><span class=\"line\">ftp_name_list=<span class=\"variable\">$&#123;ftp_name&#125;</span>_list</span><br><span class=\"line\">ftp_ck_name=/oradata/schedule/log/dba_ftp_ck_</span><br><span class=\"line\">ftp_size_name=/oradata/schedule/log/dba_ftp_size_</span><br><span class=\"line\">ftp_reput_name=/oradata/schedule/log/dba_ftp_reput_</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -ltr <span class=\"variable\">$&#123;dump_folder&#125;</span> | grep <span class=\"variable\">$&#123;zip_passwd&#125;</span> | <span class=\"built_in\">tr</span> -s <span class=\"string\">&#x27; &#x27;</span> | <span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27; &#x27;</span> -f9 &gt; <span class=\"variable\">$&#123;ftp_name_list&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;user ftpuser ftppasswd&#x27;</span> &gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bi&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;prompt&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> lcd <span class=\"variable\">$&#123;dump_folder&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> put <span class=\"variable\">$&#123;line&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bye&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;user ftpuser ftppasswd&#x27;</span> &gt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"built_in\">dir</span> <span class=\"variable\">$&#123;line&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bye&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  ftp -n FTP_IP &lt; <span class=\"variable\">$&#123;ftp_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">  ftp -n FTP_IP &lt; <span class=\"variable\">$&#123;ftp_ck_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span> &gt; <span class=\"variable\">$&#123;ftp_size_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_name_list&#125;</span> | <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  ftp_sfile=`<span class=\"built_in\">cat</span> <span class=\"variable\">$&#123;ftp_size_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span> | grep <span class=\"variable\">$&#123;zip_passwd&#125;</span> | <span class=\"built_in\">tr</span> -s <span class=\"string\">&#x27; &#x27;</span> | <span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27; &#x27;</span> -f5`</span><br><span class=\"line\">  local_sfile=`<span class=\"built_in\">ls</span> -ltr <span class=\"variable\">$&#123;dump_folder&#125;</span> | grep <span class=\"variable\">$&#123;line&#125;</span> | <span class=\"built_in\">tr</span> -s <span class=\"string\">&#x27; &#x27;</span> | <span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27; &#x27;</span> -f5`</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;ftp_sfile&#125;</span> -gt 0 ] &amp;&amp; [ <span class=\"variable\">$&#123;ftp_sfile&#125;</span> -ne <span class=\"variable\">$&#123;local_sfile&#125;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;user ftpuser ftppasswd&#x27;</span> &gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bi&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;prompt&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> lcd <span class=\"variable\">$&#123;dump_folder&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> restart <span class=\"variable\">$&#123;ftp_sfile&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> put <span class=\"variable\">$&#123;line&#125;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;bye&#x27;</span> &gt;&gt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span>;</span><br><span class=\"line\">     ftp -n FTP_IP &lt; <span class=\"variable\">$&#123;ftp_reput_name&#125;</span><span class=\"variable\">$&#123;line&#125;</span> ;</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[{"post_id":"clgj2lm6g0001rcu32fat42wf","category_id":"clgj2lm6n0007rcu35sev9b5k","_id":"clgj2lm6t000hrcu3cr58hgc2"},{"post_id":"clgj2lm6j0003rcu330elfp22","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm6v000prcu36c9f18vo"},{"post_id":"clgj2lm6s000grcu3hagvbe0s","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm6x000vrcu351av90j1"},{"post_id":"clgj2lm6o0008rcu3bwflecbj","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm6z0010rcu32enybjot"},{"post_id":"clgj2lm6o0009rcu3fn133ppw","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm710017rcu39p9z9qg9"},{"post_id":"clgj2lm6x000wrcu3d11e1wfa","category_id":"clgj2lm6n0007rcu35sev9b5k","_id":"clgj2lm71001arcu30z1f1v8i"},{"post_id":"clgj2lm6q000crcu3h40i61sh","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm72001frcu355h00iin"},{"post_id":"clgj2lm6q000crcu3h40i61sh","category_id":"clgj2lm6y000xrcu35in62u4y","_id":"clgj2lm73001hrcu3e1ul44qw"},{"post_id":"clgj2lm6q000drcu379jqhmfy","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm73001lrcu31n127pmj"},{"post_id":"clgj2lm6q000drcu379jqhmfy","category_id":"clgj2lm6y000xrcu35in62u4y","_id":"clgj2lm74001nrcu32l332lrx"},{"post_id":"clgj2lm710019rcu37h6k5erv","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm74001qrcu370zx4zuo"},{"post_id":"clgj2lm72001drcu33clg9kd6","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm74001trcu36rqb5z31"},{"post_id":"clgj2lm6m0006rcu3fk4h4wvt","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm75001wrcu3721h6i2p"},{"post_id":"clgj2lm6m0006rcu3fk4h4wvt","category_id":"clgj2lm6y000xrcu35in62u4y","_id":"clgj2lm75001yrcu348vw3mhj"},{"post_id":"clgj2lm6u000nrcu33zki5mmb","category_id":"clgj2lm73001jrcu36cfmbuyb","_id":"clgj2lm750021rcu3gm4n409d"},{"post_id":"clgj2lm6t000jrcu39j3d4td7","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm760024rcu3fsrfh4al"},{"post_id":"clgj2lm6t000jrcu39j3d4td7","category_id":"clgj2lm6y000xrcu35in62u4y","_id":"clgj2lm760027rcu3ak5y8qj2"},{"post_id":"clgj2lm6w000urcu3cpub6lnn","category_id":"clgj2lm75001vrcu3bgfdbols","_id":"clgj2lm760029rcu3cjq651a2"},{"post_id":"clgj2lm6v000qrcu39raueyvn","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm77002crcu31wiq2e63"},{"post_id":"clgj2lm6v000qrcu39raueyvn","category_id":"clgj2lm750020rcu31fw47clg","_id":"clgj2lm77002frcu39rime0m0"},{"post_id":"clgj2lm6z0012rcu36a2a6han","category_id":"clgj2lm73001jrcu36cfmbuyb","_id":"clgj2lm78002lrcu3c1620k9m"},{"post_id":"clgj2lm700015rcu3gp5hfwr9","category_id":"clgj2lm6p000brcu31q85bhcz","_id":"clgj2lm79002nrcu3ah5fa276"},{"post_id":"clgj2lm700015rcu3gp5hfwr9","category_id":"clgj2lm750020rcu31fw47clg","_id":"clgj2lm79002prcu3b0bhdpx2"},{"post_id":"clgj2lm6y000zrcu3g73rh8vy","category_id":"clgj2lm760026rcu3ej5qb1bx","_id":"clgj2lm79002rrcu3fy7rdb0l"},{"post_id":"clgj2lm6y000zrcu3g73rh8vy","category_id":"clgj2lm78002jrcu31nzugv4m","_id":"clgj2lm79002srcu37lb4dkmp"},{"post_id":"clgj2lm7a002urcu335cy41i6","category_id":"clgj2lm6n0007rcu35sev9b5k","_id":"clgj2lm7b002yrcu32az6b5n8"},{"post_id":"clgj2lm7a002trcu39yuu8frr","category_id":"clgj2lm7b002wrcu3fafh3x81","_id":"clgj2lm7b002zrcu30d2h386g"}],"PostTag":[{"post_id":"clgj2lm6g0001rcu32fat42wf","tag_id":"clgj2lm6k0004rcu35mbshlup","_id":"clgj2lm6t000ircu33xqyf9rh"},{"post_id":"clgj2lm6g0001rcu32fat42wf","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm6u000krcu397qmbgx4"},{"post_id":"clgj2lm6q000drcu379jqhmfy","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm6v000orcu39kdh3oui"},{"post_id":"clgj2lm6t000jrcu39j3d4td7","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm6w000rrcu3aq5q059w"},{"post_id":"clgj2lm6j0003rcu330elfp22","tag_id":"clgj2lm6r000ercu3360bfgam","_id":"clgj2lm6z0011rcu3009s9uwf"},{"post_id":"clgj2lm6j0003rcu330elfp22","tag_id":"clgj2lm6u000mrcu3h0nh3lct","_id":"clgj2lm700013rcu391jk7sv6"},{"post_id":"clgj2lm6j0003rcu330elfp22","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm710018rcu3ekynavnk"},{"post_id":"clgj2lm6x000wrcu3d11e1wfa","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm71001brcu39uz37gil"},{"post_id":"clgj2lm6z0012rcu36a2a6han","tag_id":"clgj2lm6y000yrcu37zx9fuxl","_id":"clgj2lm72001grcu36wsg79t5"},{"post_id":"clgj2lm6m0006rcu3fk4h4wvt","tag_id":"clgj2lm6y000yrcu37zx9fuxl","_id":"clgj2lm73001ircu34zr03nmb"},{"post_id":"clgj2lm6o0008rcu3bwflecbj","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm73001mrcu30r6wgszt"},{"post_id":"clgj2lm72001drcu33clg9kd6","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm74001orcu39tru6tcc"},{"post_id":"clgj2lm6o0009rcu3fn133ppw","tag_id":"clgj2lm72001ercu3h2iw6wm8","_id":"clgj2lm74001srcu3hitdfa0o"},{"post_id":"clgj2lm6q000crcu3h40i61sh","tag_id":"clgj2lm73001krcu386iv0yk3","_id":"clgj2lm74001urcu38ic54g6n"},{"post_id":"clgj2lm6s000grcu3hagvbe0s","tag_id":"clgj2lm74001rrcu36dqeabrm","_id":"clgj2lm75001zrcu366jodgz2"},{"post_id":"clgj2lm6s000grcu3hagvbe0s","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm750022rcu33ggdhgw2"},{"post_id":"clgj2lm6u000nrcu33zki5mmb","tag_id":"clgj2lm6y000yrcu37zx9fuxl","_id":"clgj2lm760025rcu3e6hthcs5"},{"post_id":"clgj2lm6v000qrcu39raueyvn","tag_id":"clgj2lm750023rcu3e5tcc004","_id":"clgj2lm76002arcu37ys9aww0"},{"post_id":"clgj2lm6w000urcu3cpub6lnn","tag_id":"clgj2lm760028rcu38cvn3yzl","_id":"clgj2lm77002ercu38new5ct7"},{"post_id":"clgj2lm6y000zrcu3g73rh8vy","tag_id":"clgj2lm6y000yrcu37zx9fuxl","_id":"clgj2lm78002ircu36rl49r5m"},{"post_id":"clgj2lm700015rcu3gp5hfwr9","tag_id":"clgj2lm72001ercu3h2iw6wm8","_id":"clgj2lm79002mrcu30fzw4h47"},{"post_id":"clgj2lm710019rcu37h6k5erv","tag_id":"clgj2lm750023rcu3e5tcc004","_id":"clgj2lm79002orcu3dz3c82qj"},{"post_id":"clgj2lm710019rcu37h6k5erv","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm79002qrcu3fagsbw5h"},{"post_id":"clgj2lm7a002trcu39yuu8frr","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm7b002vrcu3bzyi0gd8"},{"post_id":"clgj2lm7a002urcu335cy41i6","tag_id":"clgj2lm6p000arcu3clyfg6xk","_id":"clgj2lm7b002xrcu31adza9aw"}],"Tag":[{"name":"Monitor","_id":"clgj2lm6k0004rcu35mbshlup"},{"name":"Script","_id":"clgj2lm6p000arcu3clyfg6xk"},{"name":"ACL","_id":"clgj2lm6r000ercu3360bfgam"},{"name":"Email","_id":"clgj2lm6u000mrcu3h0nh3lct"},{"name":"Install","_id":"clgj2lm6y000yrcu37zx9fuxl"},{"name":"PerformanceTuning","_id":"clgj2lm72001ercu3h2iw6wm8"},{"name":"ORA-","_id":"clgj2lm73001krcu386iv0yk3"},{"name":"Zip","_id":"clgj2lm74001rrcu36dqeabrm"},{"name":"Rman","_id":"clgj2lm750023rcu3e5tcc004"},{"name":"Hexo","_id":"clgj2lm760028rcu38cvn3yzl"}]}}